"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[839],{50906:function(e,t,n){n.d(t,{r:function(){return l}});var a,r,s=n(72791),o=["title","titleId"];function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c.apply(this,arguments)}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function u(e,t){var n=e.title,u=e.titleId,l=i(e,o);return s.createElement("svg",c({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":u},l),n?s.createElement("title",{id:u},n):null,a||(a=s.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),r||(r=s.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}var l=s.forwardRef(u);n.p},59839:function(e,t,n){n.r(t);var a=n(1413),r=n(93433),s=n(15861),o=n(29439),c=n(64687),i=n.n(c),u=n(74569),l=n.n(u),d=n(16030),_=n(16871),f=n(72791),h=n(54270),p=n(40696),b=n(44643),k=n(29316),v=n(4127),y=n(88952),m=n(75454),g=n(40354),x=n(65248),w=n(50639),j=n(56759),Z=n(72808),E=n(15602),O=n(50906),N=n(95899),R=n(298),S=n(80184);t.default=function(e){var t=(0,R.dD)(),n=t.connect,c=t.address,u=t.provider,T=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"},{key:"decayscore",value:null,type:"range"}],I=(0,_.TH)(),L=(0,_.s0)(),C=(0,d.I0)(),A=(0,d.v9)((function(e){return e.UserState})),P=(0,d.v9)((function(e){return e.BWalletState})),G=(0,f.useState)([]),D=(0,o.Z)(G,2),H=D[0],B=D[1],M=(0,f.useState)([]),W=(0,o.Z)(M,2),F=W[0],z=W[1],q=(0,f.useState)(T),U=(0,o.Z)(q,2),J=U[0],K=U[1],V=(0,f.useState)(!1),Y=(0,o.Z)(V,2),Q=Y[0],X=Y[1],$=(0,f.useState)(0),ee=(0,o.Z)($,2),te=ee[0],ne=ee[1],ae=(0,f.useState)(null),re=(0,o.Z)(ae,2),se=re[0],oe=re[1],ce=(0,f.useState)(!1),ie=(0,o.Z)(ce,2),ue=ie[0],le=ie[1],de=(0,f.useState)(window.innerWidth<600?"LIST":"GRID"),_e=(0,o.Z)(de,2),fe=_e[0],he=_e[1],pe=(0,f.useState)(100),be=(0,o.Z)(pe,2),ke=be[0],ve=be[1];(0,f.useEffect)((function(){(0,N.Z)("page_view_account")}),[]),(0,f.useEffect)((function(){0===te?(0,N.Z)("tab_view_account_owned"):(0,N.Z)("tab_view_account_published")}),[te]);var ye=function(){var e=(0,s.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),me=(0,f.useCallback)((function(){c||ye(),(0,p.Z)(u,C)}),[C]);(0,f.useEffect)((function(){(0,N.Z)("event_library_filter");var e=F;(0,k.fb)(e)&&(J.forEach((function(t){switch(t.type){case"range":(0,k.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,k.vd)(t.value)){var n=[];t.value.forEach((function(a){return e.forEach((function(e){e[t.key].indexOf(a)>-1&&n.filter((function(t){return t.id===e.id})).length<1&&n.push(e)}))})),e=n}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),B(e))}),[J,F]),(0,f.useEffect)((function(){if((0,k.fb)(I.state)){var e=I.state.tab;ne("published"===e?1:0)}}),[I]),(0,f.useEffect)((function(){X(!0),(0,k.fb)(P.smartAccount)?oe(P.smartAccount.address):me(),X(!1)}),[P,me]),(0,f.useEffect)((function(){C(Q?(0,v.yh)():(0,v.v3)())}),[Q,C]),(0,f.useEffect)((function(){(0,k.Pc)(A)&&(X(!0),0===te?l()({url:x._+"/api/user/books/owned",method:"GET",headers:{"user-id":A.user.uid,authorization:"Bearer ".concat(A.tokens.acsTkn.tkn)},params:{userAddress:se}}).then((function(e){200===e.status?z(e.data):C((0,b.e1)("NOT200"))})).catch((function(e){C((0,b.e1)("ERROR"))})).finally((function(){return X(!1)})):1===te&&l()({url:x._+"/api/user/books/published",method:"GET",headers:{"user-id":A.user.uid,authorization:"Bearer ".concat(A.tokens.acsTkn.tkn)},params:{userAddress:se}}).then((function(e){200===e.status?z(e.data):C((0,b.e1)("NOT200"))})).catch((function(e){C((0,b.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[te,se,C,A]),(0,f.useEffect)((function(){if((0,k.vd)(F)){var e=Math.max.apply(Math,(0,r.Z)(F.map((function(e){return e.price}))));e=10*Math.ceil(e/10),ve(e||100)}}),[F]);var ge=function(){var e=(0,s.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X(!0);try{l()({url:"".concat(x._,"/api/verify"),method:"GET",params:{bookAddress:t.book_address,ownerAddress:se}}).then((function(e){if(200===e.status){var n=e.data;p.Z.signMessage(P.smartAccount.signer,JSON.stringify(n)).then((function(e){!0===e.isValid?l()({url:x._+"/api/verify",method:"POST",data:{accountAddress:se,bookAddress:t.book_address,signedData:e.signedData,cid:t.book.slice(t.book.lastIndexOf("/")+1)}}).then((function(e){200===e.status?((0,N.Z)("navigate_book_reader"),L("/library/reader",{state:{book:(0,a.Z)((0,a.Z)({},t),{},{submarineURL:e.data.url}),preview:!1}})):C((0,b.e1)({show:!0,message:"Error",type:4}))})).catch((function(e){})).finally((function(){return X(!1)})):C((0,b.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else C((0,b.e1)("NOT200"))}))}catch(n){X(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(h.q,{children:(0,S.jsx)("meta",{name:"Library",content:"Explore library of  books"})}),(0,S.jsx)(y.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,S.jsxs)("div",{className:"account__data",children:[(0,S.jsx)("div",{className:"account__data__filter-panel-container","data-filter-open":ue,children:(0,S.jsx)(g.Z,{maxPrice:ke,setFiltersPanelOpen:le,config:w.K,defaults:T,filters:J,setFilters:K})}),(0,S.jsxs)("div",{className:"account__data__books","data-filter-open":ue,children:[(0,S.jsxs)("div",{className:"account__data__books__header",children:[(0,S.jsxs)("div",{className:"account__data__books__header__filter",children:[(0,S.jsx)(m.Z,{type:"icon",onClick:function(){return le((function(e){return!e}))},children:(0,S.jsx)(Z.r,{fill:ue?"currentColor":"transparent"})}),(0,S.jsxs)("div",{className:"account__data__books__header__filter__tabs",children:[(0,S.jsx)("div",{onClick:function(){return ne(0)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":0===te,children:"Library"}),(0,S.jsx)("div",{onClick:function(){return ne(1)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":1===te,children:"Published"})]})]}),(0,S.jsxs)("div",{className:"account__data__books__header__layout",children:[(0,S.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return he("LIST")},children:[(0,S.jsx)(O.r,{}),(0,S.jsx)("span",{children:"List"})]}),(0,S.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return he("GRID")},children:[(0,S.jsx)(E.r,{}),(0,S.jsx)("span",{children:"GRID"})]})]})]}),(0,S.jsx)("div",{className:"account__data__books__wrapper","data-layout":fe,children:(0,k.fb)(H)&&H.length>0?function(){var e=[];return H.forEach((function(t){e.push((0,S.jsx)(j.Z,{state:t.publisher_address===se?"publisher":"owned",layout:fe,book:t,onRead:function(){return ge(t)},onOpen:function(){return function(e){(0,N.Z)("navigate_account_book"),L("/book/".concat(e.id))}(t)}},t.id))})),e}():(0,S.jsxs)("div",{className:"account__data__books__wrapper__empty",children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"account__data__books__wrapper__image",loading:"lazy"}),(0,S.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]})})]})}}}]);
//# sourceMappingURL=839.5998d051.chunk.js.map