"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[839],{906:function(e,t,a){a.d(t,{r:function(){return l}});var n,r,s=a(2791),o=["title","titleId"];function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i.apply(this,arguments)}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function u(e,t){var a=e.title,u=e.titleId,l=c(e,o);return s.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":u},l),a?s.createElement("title",{id:u},a):null,n||(n=s.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),r||(r=s.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}var l=s.forwardRef(u);a.p},9839:function(e,t,a){a.r(t);var n=a(1413),r=a(5861),s=a(2982),o=a(885),i=a(7757),c=a.n(i),u=a(4569),l=a.n(u),d=a(6030),_=a(6871),f=a(2791),h=a(2043),p=a(6026),b=a(4643),k=a(9316),v=a(4127),y=a(1634),m=a(5454),g=a(354),w=a(5248),x=a(639),j=a(6759),Z=a(3930),E=a(5602),O=a(906),N=a(5899),R=a(184);t.default=function(e){var t=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"},{key:"decayscore",value:null,type:"range"}],a=(0,_.TH)(),i=(0,_.s0)(),u=(0,d.I0)(),S=(0,d.v9)((function(e){return e.UserState})),T=(0,d.v9)((function(e){return e.WalletState})),I=(0,f.useState)([]),C=(0,o.Z)(I,2),L=C[0],P=C[1],A=(0,f.useState)([]),G=(0,o.Z)(A,2),H=G[0],W=G[1],D=(0,f.useState)(t),M=(0,o.Z)(D,2),B=M[0],z=M[1],F=(0,f.useState)(!1),U=(0,o.Z)(F,2),q=U[0],J=U[1],K=(0,f.useState)(0),V=(0,o.Z)(K,2),Y=V[0],Q=V[1],X=(0,f.useState)(null),$=(0,o.Z)(X,2),ee=$[0],te=$[1],ae=(0,f.useState)(!1),ne=(0,o.Z)(ae,2),re=ne[0],se=ne[1],oe=(0,f.useState)(window.innerWidth<600?"LIST":"GRID"),ie=(0,o.Z)(oe,2),ce=ie[0],ue=ie[1],le=(0,f.useState)(100),de=(0,o.Z)(le,2),_e=de[0],fe=de[1];(0,f.useEffect)((function(){(0,N.Z)("page_view_account")}),[]),(0,f.useEffect)((function(){0===Y?(0,N.Z)("tab_view_account_owned"):(0,N.Z)("tab_view_account_published")}),[Y]);var he=(0,f.useCallback)((function(){h.Z.connectWallet().then((function(e){u((0,p.kH)({wallet:e.wallet,provider:e.provider,signer:e.signer,address:e.address}))})).catch((function(e){u((0,b.e1)({show:!0,message:"Error while connecting to wallet",type:4}))})).finally((function(){return J(!1)}))}),[u]);(0,f.useEffect)((function(){(0,N.Z)("event_library_filter");var e=H;(0,k.fb)(e)&&(B.forEach((function(t){switch(t.type){case"range":(0,k.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,k.vd)(t.value)){var a=[];t.value.forEach((function(n){return e.forEach((function(e){e[t.key].indexOf(n)>-1&&a.filter((function(t){return t.id===e.id})).length<1&&a.push(e)}))})),e=a}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),P(e))}),[B,H]),(0,f.useEffect)((function(){if((0,k.fb)(a.state)){var e=a.state.tab;Q("published"===e?1:0)}}),[a]),(0,f.useEffect)((function(){J(!0),(0,k.fb)(T.wallet.provider)?te(T.wallet.address):he(),J(!1)}),[T,he]),(0,f.useEffect)((function(){u(q?(0,v.yh)():(0,v.v3)())}),[q,u]),(0,f.useEffect)((function(){(0,k.Pc)(S)&&(J(!0),0===Y?l()({url:w._+"/api/user/books/owned",method:"GET",headers:{"user-id":S.user.uid,authorization:"Bearer ".concat(S.tokens.acsTkn.tkn)},params:{userAddress:ee}}).then((function(e){200===e.status?W(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return J(!1)})):1===Y&&l()({url:w._+"/api/user/books/published",method:"GET",headers:{"user-id":S.user.uid,authorization:"Bearer ".concat(S.tokens.acsTkn.tkn)},params:{userAddress:ee}}).then((function(e){200===e.status?W(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return J(!1)})))}),[Y,ee,u,S]),(0,f.useEffect)((function(){if((0,k.vd)(H)){var e=Math.max.apply(Math,(0,s.Z)(H.map((function(e){return e.price}))));e=10*Math.ceil(e/10),fe(e||100)}}),[H]);var pe=function(){var e=(0,r.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J(!0);try{l()({url:"".concat(w._,"/api/verify"),method:"GET",params:{bookAddress:t.book_address,ownerAddress:ee}}).then((function(e){if(200===e.status){var a=e.data;h.Z.signMessage(T.wallet.signer,JSON.stringify(a)).then((function(e){!0===e.isValid?l()({url:w._+"/api/verify",method:"POST",data:{accountAddress:ee,bookAddress:t.book_address,signedData:e.signedData,cid:t.book.slice(t.book.lastIndexOf("/")+1)}}).then((function(e){200===e.status?((0,N.Z)("navigate_book_reader"),i("/library/reader",{state:{book:(0,n.Z)((0,n.Z)({},t),{},{submarineURL:e.data.url}),preview:!1}})):u((0,b.e1)({show:!0,message:"Error",type:4}))})).catch((function(e){})).finally((function(){return J(!1)})):u((0,b.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else u((0,b.e1)("NOT200"))}))}catch(a){J(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,R.jsx)(y.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,R.jsxs)("div",{className:"account__data",children:[(0,R.jsx)("div",{className:"account__data__filter-panel-container","data-filter-open":re,children:(0,R.jsx)(g.Z,{maxPrice:_e,setFiltersPanelOpen:se,config:x.K,defaults:t,filters:B,setFilters:z})}),(0,R.jsxs)("div",{className:"account__data__books","data-filter-open":re,children:[(0,R.jsxs)("div",{className:"account__data__books__header",children:[(0,R.jsxs)("div",{className:"account__data__books__header__filter",children:[(0,R.jsx)(m.Z,{type:"icon",onClick:function(){return se((function(e){return!e}))},children:(0,R.jsx)(Z.r,{fill:re?"currentColor":"transparent"})}),(0,R.jsxs)("div",{className:"account__data__books__header__filter__tabs",children:[(0,R.jsx)("div",{onClick:function(){return Q(0)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":0===Y,children:"Library"}),(0,R.jsx)("div",{onClick:function(){return Q(1)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":1===Y,children:"Published"})]})]}),(0,R.jsxs)("div",{className:"account__data__books__header__layout",children:[(0,R.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return ue("LIST")},children:[(0,R.jsx)(O.r,{}),(0,R.jsx)("span",{children:"List"})]}),(0,R.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return ue("GRID")},children:[(0,R.jsx)(E.r,{}),(0,R.jsx)("span",{children:"GRID"})]})]})]}),(0,R.jsx)("div",{className:"account__data__books__wrapper","data-layout":ce,children:(0,k.fb)(L)&&L.length>0?function(){var e=[];return L.forEach((function(t){e.push((0,R.jsx)(j.Z,{state:t.publisher_address===ee?"publisher":"owned",layout:ce,book:t,onRead:function(){return pe(t)},onOpen:function(){return function(e){(0,N.Z)("navigate_account_book"),i("/book/".concat(e.id))}(t)}},t.id))})),e}():(0,R.jsxs)("div",{className:"account__data__books__wrapper__empty",children:[(0,R.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"account__data__books__wrapper__image",loading:"lazy"}),(0,R.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]})})}}}]);
//# sourceMappingURL=839.ce889e04.chunk.js.map