"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[953],{55953:(e,a,s)=>{s.r(a),s.d(a,{default:()=>X});var t=s(74569),_=s.n(t),o=s(72426),r=s.n(o),d=s(16030),c=s(16871),i=s(72791),n=s(54270),l=s(17303),h=s(6222),m=s(88062),u=s(83374),b=s(88952),p=s(43935),k=s(4254),y=s(75454),v=s(90709),f=s(85807),x=s(46472),j=s(89018),w=s(95899),g=s(4127),N=s(87928),R=s(9135),E=s(40867),A=s(29316),O=s(80184);const T=e=>{let{label:a,price:s}=e;return(0,O.jsxs)("div",{className:"tag__price",children:[a,":\xa0",(0,A.fb)(s)?0===s?"FREE":(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:24,height:24,objectFit:"contain"},alt:"USDC"}),parseFloat(s)]}):"loading..."]})};var S=s(55169);const Z=e=>{let{onOldBookPurchase:a,onNewBookPurchase:s,data:t}=e;const _=(0,d.I0)(),o=((0,d.v9)((e=>e.UserState)),(0,d.v9)((e=>e.ModalState))),r=(0,d.v9)((e=>e.BWalletState)),[c,n]=(0,i.useState)(!1),[l,m]=(0,i.useState)(!1),[u,b]=(0,i.useState)(null),p=(0,i.useCallback)((async()=>{const e={chainId:E.ChainId.POLYGON_MUMBAI,eoaAddress:r.smartAccount.address,tokenAddresses:[S.ZZ]},a=(await r.smartAccount.getAlltokenBalances(e)).data.filter((e=>e.contract_address===S.ZZ))[0];a.balance=h.formatUnits(null===a||void 0===a?void 0:a.balance,"mwei"),b(a)}),[r.smartAccount]);return(0,i.useEffect)((()=>{window.document.documentElement.style.overflowY=c?"hidden":"auto"}),[c]),(0,i.useEffect)((()=>{_(l?(0,g.yh)():(0,g.v3)())}),[l,_]),(0,i.useEffect)((()=>{!0===o.show&&o.type===N.m0?((0,w.Z)("modal_view_purchase"),n(!0),p()):n(!1)}),[o,r,p]),(0,O.jsx)(j.Z,{show:c,children:(0,O.jsxs)("div",{className:(()=>{let e=["purchase purchase__wrapper"];return c?e.push("purchase__wrapper--open"):e.push("purchase__wrapper--close"),e.join(" ")})(),children:[(0,O.jsxs)("div",{className:"purchase__wrapper__header",children:[(0,O.jsx)("div",{className:"purchase__wrapper__header__title typo__head--6 typo__transform--capital",children:"Checkout"}),(0,O.jsx)("div",{className:"purchase__wrapper__header__close-button",children:(0,O.jsx)("div",{onClick:()=>n(!1),children:(0,O.jsx)(R.r,{width:20,height:20})})})]}),(0,O.jsxs)("div",{className:"purchase__wrapper__content",children:[(0,O.jsxs)("div",{className:"",children:["Title: ",t.title]}),(0,O.jsx)(T,{label:"price",price:t.price}),(0,O.jsx)(T,{label:"your balance",price:null===u||void 0===u?void 0:u.balance}),(0,O.jsx)(T,{label:"balance after purchase",price:parseFloat((null===u||void 0===u?void 0:u.balance)-t.price).toFixed(6)}),(0,O.jsx)("br",{}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>s(),children:"Purchase"})]})]})})};var B=s(77107),C=s(40696),P=s(65248),G=s(44643),F=s(37793),$=s(25897),M=s(23358),I=s(40116),q=s(88465),U=s(33653),Y=s(70476),D=s(7445),L=s(96744),z=s(1692),W=s(14998),K=s(7215),Q=s(88079),V=s(65748),H=s(298),J=s(59319);const X=e=>{const a=[{id:"TAB01",label:"Synopsis",icon:(0,O.jsx)(L.r,{})},{id:"TAB02",label:"reviews",icon:(0,O.jsx)(D.r,{})},{id:"TAB03",label:"quotes",icon:(0,O.jsx)(W.r,{})}],s=(0,c.UO)(),t=(0,d.I0)(),o=(0,c.s0)(),j=(0,F.Z)(),{getWalletBalance:R}=(0,J.an)(),{address:E,connect:T,provider:X}=(0,H.dD)(),ee=(0,d.v9)((e=>e.UserState)),ae=(0,d.v9)((e=>e.BWalletState)),[se,te]=(0,i.useState)(null),[_e,oe]=(0,i.useState)(!1),[re,de]=(0,i.useState)("TAB01"),[ce,ie]=(0,i.useState)(null),[ne,le]=(0,i.useState)(null),[he,me]=(0,i.useState)(null),[ue,be]=(0,i.useState)(null),[pe,ke]=(0,i.useState)(null),[ye,ve]=(0,i.useState)(null),[fe,xe]=(0,i.useState)(0),[je,we]=(0,i.useState)(!1),[ge,Ne]=(0,i.useState)(0),[Re,Ee]=(0,i.useState)(null),[Ae,Oe]=(0,i.useState)([]),[Te,Se]=(0,i.useState)(0),[Ze,Be]=(0,i.useState)({title:"",body:"",rating:0}),[Ce,Pe]=(0,i.useState)(null),[Ge,Fe]=(0,i.useState)([]),[$e,Me]=(0,i.useState)({quote:""}),[Ie,qe]=(0,i.useState)(0),[Ue,Ye]=(0,i.useState)(0),[De,Le]=(0,i.useState)(0),ze=(0,i.useRef)();(0,i.useEffect)((()=>{(0,w.Z)("page_view_book")}),[]),(0,i.useEffect)((()=>{"TAB01"===re?(0,w.Z)("tab_view_book_synopsis"):"TAB02"===re?(0,w.Z)("tab_view_book_reviews"):(0,w.Z)("tab_view_book_quotes")}),[re]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&me(1===ce.listed)}),[ce]);const We=(0,i.useCallback)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/book/reviews`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status?(Oe(e.data.reviews),Ne(e.data.rating),Se(e.data.total)):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),Ke=(0,i.useCallback)((()=>{(0,A.fb)(ce)&&(0,A.fb)(se)&&(oe(!0),_()({url:`${P._}/api/book/reviewed`,method:"GET",params:{bookAddress:ce.book_address,ownerAddress:se}}).then((e=>{200===e.status&&(0,A.UE)(e.data)&&Ee(e.data)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,se,t]),Qe=(0,i.useCallback)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/book/quotes`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status?Fe(e.data):204===e.status||t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),Ve=(0,i.useCallback)((()=>{(0,A.fb)(ce)&&(0,A.fb)(se)&&(oe(!0),_()({url:`${P._}/api/book/quoted`,method:"GET",params:{bookAddress:ce.book_address,ownerAddress:se}}).then((e=>{200===e.status&&(0,A.UE)(e.data)&&Pe(e.data)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,se,t]);(0,i.useEffect)((()=>{We()}),[We]),(0,i.useEffect)((()=>{Ke()}),[Ke]),(0,i.useEffect)((()=>{Qe()}),[Qe]),(0,i.useEffect)((()=>{Ve()}),[Ve]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/book/likes`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status?xe(e.data.likes):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(0,A.fb)(se)&&(oe(!0),_()({url:`${P._}/api/book/liked`,method:"GET",params:{bookAddress:ce.book_address,ownerAddress:se}}).then((e=>{200===e.status&&we(e.data.liked)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,se,t]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/reader/total-reader-count`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status&&qe(e.data.total_readers)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/reader/count`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status&&Ye(e.data.reader_count)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(oe(!0),_()({url:`${P._}/api/reader/total-read-time`,method:"GET",params:{bookAddress:ce.book_address}}).then((e=>{200===e.status&&Le(e.data.total_read_time)})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))}),[ce,t]),(0,i.useEffect)((()=>{oe(!0),(0,A.fb)(ae.smartAccount)&&te(ae.smartAccount.address),oe(!1)}),[ae]),(0,i.useEffect)((()=>{(0,A.fb)(Re)&&Be({title:Re.title,body:Re.body,rating:Re.rating})}),[Re]),(0,i.useEffect)((()=>{const e=s.bookID;_()({url:`${P._}/api/book`,method:"GET",params:{id:e}}).then((e=>{ie(e.data[0])}))}),[s]),(0,i.useEffect)((()=>{if((0,A.fb)(se)&&(0,A.fb)(ce)){oe(!0);const e=ce;e.new_owner===se?le(!0):le(!1),e.publisher_address===se?ke(!0):ke(!1),_()({url:P._+"/api/book/owner",method:"GET",params:{ownerAddress:se,bookAddress:e.book_address}}).then((e=>{200===e.status&&le(!0)})).catch((e=>{})).finally((()=>oe(!1)))}}),[ce,s,t,se]),(0,i.useEffect)((()=>{(0,A.fb)(ce)&&(0,A.fb)(pe)&&(0,A.fb)(ne)&&oe(!1)}),[ce,pe,ne]),(0,i.useEffect)((()=>{t(_e?(0,g.yh)():(0,g.v3)())}),[_e,t]),(0,i.useEffect)((()=>{let e=document.getElementById("BOOK_PAGE_"+re);(0,A.fb)(e)&&(0,A.fb)(ze.current)&&ze.current.style.setProperty("--marker-x",e.offsetLeft)}),[re]),(0,i.useEffect)((()=>{ne&&_()({url:`${P._}/api/user/book`,method:"GET",headers:{"user-id":ee.user.uid,address:ae.smartAccount.address,authorization:`Bearer ${ee.tokens.acsTkn.tkn}`},params:{walletAddress:ae.smartAccount.address,bookAddress:ce.book_address}}).then((e=>{200===e.status?(be(e.data),me(e.data.listed)):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))}))}),[ne,ee,ae,t,ce]);const He=()=>{if((0,A.fb)(ae.smartAccount))return te(ae.smartAccount.address),!0;E||(async()=>{T()})(),(0,C.Z)(X,t)},Je=async()=>{(0,w.Z)("event_book_read"),oe(!0);try{_()({url:`${P._}/api/verify/mobile`,method:"POST",headers:{address:ae.smartAccount.address,"user-id":ee.user.uid,authorization:`Bearer ${ee.tokens.acsTkn.tkn}`},data:{bookAddress:ce.book_address,ownerAddress:ae.smartAccount.address}}).then((e=>{200===e.status&&((0,w.Z)("navigate_book_reader"),o("/library/reader",{state:{book:{...ce,url:`${e.data.base}?token=${e.data.token}&cid=${e.data.cid}&fileName=${e.data.fileName}`}}}))}))}catch(e){oe(!1)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.q,{children:(0,O.jsx)("meta",{name:"Book's Page",content:"Buy & Read the book you like"})}),(0,O.jsxs)(b.Z,{children:[(0,O.jsx)("div",{className:"book__bg",children:(0,O.jsx)("img",{src:$.Z,alt:"background",loading:"lazy"})}),(0,A.fb)(ce)?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:"book__data",children:[(0,O.jsx)("div",{className:"book__data__background"}),(0,O.jsxs)("div",{className:"book__data__container",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"book__data__container__cover",children:(0,O.jsx)("img",{className:"book__data__container__cover__image",src:ce.cover_display_url?ce.cover_display_url:ce.cover_public_url?ce.cover_public_url:ce.cover,alt:ce.name})}),(0,O.jsxs)("div",{className:"book__data__container__meta",children:[(0,O.jsx)("h3",{className:"typo__color--n700 typo__head typo__head--3 typo__transform--capital",children:ce.title}),(0,O.jsx)("h5",{className:"typo__color--n500 typo__head typo__head--6 typo__transform--upper",children:ce.author}),ne||pe?null:(0,O.jsx)("div",{className:"book__data__container__meta__price typo-head--6 typo__act typo__color--success",children:0===ce.price?"FREE":(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",ce.price]})}),(0,O.jsxs)("div",{className:"book__data__container__meta__rating",children:[(0,O.jsx)("div",{className:"book__data__container__meta__rating__stars",children:(0,O.jsx)(k.Z,{size:"small",rating:ge})}),(0,O.jsxs)("div",{className:"book__data__container__meta__rating__count typo__body",children:[Te," reviews"]})]}),(0,O.jsx)("div",{className:"book__data__container__meta__cta",children:he?(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>((0,w.Z)("event_book_unlist"),void((0,A.fb)(se)&&(oe(!0),_()({url:P._+"/api/user/book/listed",method:"GET",headers:{"user-id":ee.user.uid,authorization:`Bearer ${ee.tokens.acsTkn.tkn}`},params:{ownerAddress:se,tokenId:ue.token_id,bookAddress:ce.book_address}}).then((e=>{if(200===e.status){oe(!0);const a=e.data.order_id;p.Z.unlistBookFromMarketplace(a,ae.smartAccount.signer).then((e=>{oe(!0),_()({url:P._+"/api/book/unlist",method:"POST",data:{ownerAddress:se,bookAddress:ce.book_address}}).then((e=>{200===e.status?(me(!1),t((0,N.VG)()),t((0,G.e1)({show:!0,message:"Book unlisted from marketplace.",type:1}))):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>{oe(!1)}))})).catch((e=>{oe(!1),(0,A.fb)(e.reason)?e.reason.includes("NFT not yet listed / already sold")&&t((0,G.e1)({show:!0,message:"eBook already sold or not listed.",type:3})):t((0,G.e1)("ERROR"))}))}else t((0,G.e1)("NOT200"))})).catch((e=>{oe(!1),t((0,G.e1)("ERROR"))}))))),children:"Unlist"}):pe?(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>Je(),children:"Read"})}):ne?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>Je(),children:"Read"}),(0,O.jsx)(y.Z,{onClick:()=>(t((0,N.K4)(N.gG)),void(r()(ce.secondary_sales_from).isSame(r()())||r()(ce.secondary_sales_from).isBefore(r()())?t((0,N.K4)(N.gG)):r()(ce.secondary_sales_from).isAfter(r()())&&t((0,G.e1)({show:!0,message:`Secondary Sales will open only after ${r()(ce.secondary_sales_from).format("D MMM, YYYY")}.`,type:2})))),children:"List"})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>(console.log({getWalletBalance:R()}),void t(j?(0,N.K4)(N.m0):(0,G.e1)("NOT_LOGGED_IN"))),children:"Buy Now"}),(0,O.jsx)(y.Z,{onClick:()=>((0,w.Z)("navigate_book_preview"),void o("/book/preview",{state:{book:ce,preview:!0}})),children:"Preview"})]})})]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc",children:[(0,O.jsx)("div",{className:"book__data__container__desc__left",children:(0,O.jsxs)("div",{className:"book__data__container__desc__summary",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract",onClick:()=>window.open(`https://mumbai.polygonscan.com/address/${ce.book_address}`,"_blank"),children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract__data",children:[(0,O.jsx)("div",{className:"book__data__container__desc__summary__contract__label typo__color--n700",children:"Contract Address"}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract__value typo__color--n500",children:[(ce.book_address||"").slice(0,12),"\u2026",(ce.book_address||"").slice((ce.contract||"").length-10)]})]}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__contract__icon",children:(0,O.jsx)(Q.r,{width:24,height:24})})]}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Genres"}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ce.genres).map((e=>(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Prefered Age Group"}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ce.age_group).map((e=>(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid typo__color--n700",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(z.r,{}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__grid__item__data",children:ce.language})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(Y.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Ie," readers"]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(K.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Ue," people reading"]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(V.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Math.ceil(De/60)," minutes"]})]})]})]})}),(0,O.jsxs)("div",{className:"book__data__container__desc__right",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__interacts",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Likes"}),(0,O.jsx)(M.r,{width:24,height:24,className:"book__data__container__desc__interacts__item__icon",stroke:je?"#ff5722":"currentColor",fill:je?"#ff5722":"transparent",onClick:()=>{He()?ne?(je?(xe((e=>e-1)),(0,w.Z)("event_book_unlike")):(xe((e=>e+1)),(0,w.Z)("event_book_like")),_()({url:`${P._}/api/book/likes`,method:"POST",data:{bookAddress:ce.book_address,ownerAddress:se,likedState:!je}}).then((e=>{200===e.status?we((e=>!e)):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1)))):t((0,G.e1)({show:!0,message:"Only owners can like a book.",type:3})):t((0,G.e1)({show:!0,message:"Please login first.",type:3}))}}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:fe||"0"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Reviews"}),(0,O.jsx)(D.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:Te||"0"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Pages"}),(0,O.jsx)(q.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ce.print||"00"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Sold"}),(0,O.jsx)(I.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ce.copies||"00"})]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs",children:[(0,O.jsx)("div",{ref:ze,className:"book__data__container__desc__tabs__container",children:(()=>{let e=[];return a.forEach((a=>{e.push((0,O.jsxs)("div",{onClick:()=>de(a.id),id:"BOOK_PAGE_"+a.id,className:a.id===re?"book__data__container__desc__tabs__container__item book__data__container__desc__tabs__container__item--active":"book__data__container__desc__tabs__container__item utils__cursor--pointer",children:[(0,A.fb)(a.icon)&&a.icon,(0,O.jsx)("h5",{className:"typo__head typo__head--6 typo__transform--capital",children:a.label})]},a.id))})),e})()}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data",children:(()=>{switch(re){case"TAB01":return(0,O.jsx)("p",{className:"typo--break-spaces typo__body typo__color--n600",children:ce.synopsis});case"TAB02":const e=e=>{let a=[];return(0,A.vd)(e)&&e.forEach((e=>a.push((0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__head typo__head typo__head--6",children:e.title}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header",children:[(0,O.jsx)(k.Z,{rating:e.rating,size:"small"}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__time typo__color--n500",children:r()(e.reviewed_at).format("D MMM, YYYY")})]}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__body typo__body typo__body--2",children:e.body})]})))),a};return(0,O.jsxs)(i.Fragment,{children:[!(0,A.fb)(Re)&&ne?(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,O.jsx)(D.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Review"}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>t(j?(0,N.K4)(N.wW):(0,G.e1)("NOT_LOGGED_IN")),children:"Review"})]}):null,(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews",children:[e(Ae),0===(null===Ae||void 0===Ae?void 0:Ae.length)?(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Reviews"}):""]})]});case"TAB03":const a=e=>{let a=[];return e.forEach(((e,s)=>{a.push((0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes__item",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__icon",children:(0,O.jsx)(U.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__body typo__body",children:e.body}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__time typo__cap typo__cap--2",children:r()(e.created_at).format("D MMM, YYYY")||"-"})]},s))})),a};return(0,O.jsxs)(i.Fragment,{children:[(0,A.fb)(Ce)||!pe&&!ne?null:(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,O.jsx)(W.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Quote"}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>t(j?(0,N.K4)(N.D4):(0,G.e1)("NOT_LOGGED_IN")),children:"Quote"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes",children:[a(Ge),0===(null===Ge||void 0===Ge?void 0:Ge.length)?(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Quotes"}):""]})]})}})()})]})]})]})]})]}),(0,O.jsx)(Z,{data:ce,onNewBookPurchase:()=>((0,w.Z)("event_book_purchase_new"),oe(!0),void((0,A.fb)(se)?(async()=>{try{const e=new l.vU(["function approve(address spender, uint256 amount)"]),a=ae.smartAccount.address,s=e.encodeFunctionData("approve",[ce.book_address,h.parseUnits(ce.price.toString(),6)]),o={to:S.ZZ,data:s},r=new l.vU(["function safeMint(address to)"]).encodeFunctionData("safeMint",[a]),d={to:ce.book_address,data:r};ae.smartAccount.on("txMined",(e=>{const s=e.receipt.logs.filter((e=>e.address===ce.book_address&&4===e.topics.length&&(0,A.vd)(e.topics.filter((a=>a===(0,m.keccak256)((0,u.Y0)("Transfer(address,address,uint256)"))&&(0,A.vd)(e.topics[e.topics.length-1]))))));if((0,A.vd)(s)){const e=parseInt(s[0].topics[s[0].topics.length-1]);_()({url:P._+"/api/book/purchase",method:"POST",data:{ownerAddress:a,bookAddress:ce.book_address,tokenId:e,purchasePrice:ce.price}}).then((e=>{200===e.status?(le(!0),t((0,N.VG)())):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))),_()({url:P._+"/api/book/copies",method:"POST",data:{bookAddress:ce.book_address,copies:e}}).then((e=>{200!==e.status&&t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))}))}})),ae.smartAccount.on("error",(e=>{oe(!1),t((0,G.e1)("ERROR")),console.error({error:e})}));const c=[o,d],i=await ae.smartAccount.prepareRefundTransactionBatch({transactions:c}),n=await ae.smartAccount.createRefundTransactionBatch({transactions:c,feeQuote:i[1]});await ae.smartAccount.sendTransaction({tx:n,gasLimit:{hex:S.Lw,type:"hex"}})}catch(e){oe(!1),console.error({error:e}),t((0,G.e1)("ERROR"))}})():t((0,G.e1)({show:!0,message:"Please connect your WEB3 wallet.",type:3})))),onOldBookPurchase:e=>(e=>{(0,w.Z)("event_book_purchase_old"),He()&&(oe(!0),p.Z.buyListedCover(e.order_id,e.price,ae.smartAccount.signer).then((a=>{_()({url:P._+"/api/book/purchase/secondary",method:"POST",data:{newOwnerAddress:se,previousOwnerAddress:e.previous_owner,bookAddress:e.book_address,tokenId:e.token_id,purchasePrice:e.price,orderId:e.order_id,daScore:e.da_score}}).then((e=>{200===e.status?(t((0,N.VG)()),le(!0)):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>oe(!1)))})).catch((e=>{oe(!1)})))})(e)}),(0,O.jsx)(v.Z,{book:ce,userCopy:ue,onListHandler:e=>(e=>{(0,w.Z)("event_book_list"),(0,A.fb)(se)&&(oe(!0),p.Z.listBookToMarketplace(ce.book_address,ue.token_id,e,ae.smartAccount.signer).then((a=>{oe(!0);const s=parseInt(a.events.filter((e=>"CoverListed"===e.event))[0].args[0]._hex);_()({url:P._+"/api/book/list",method:"POST",data:{ownerAddress:se,bookAddress:ce.book_address,bookPrice:e,bookOrderId:s,bookTokenId:ue.token_id}}).then((e=>{200===e.status?(me(!0),t((0,N.VG)()),t((0,G.e1)({show:!0,message:"Book listed on marketplace.",type:1})),e.data&&(ve(e.data),t((0,N.K4)(N.Sh)))):t((0,G.e1)("NOT200"))})).catch((e=>{t((0,G.e1)("ERROR"))})).finally((()=>{oe(!1)}))})).catch((e=>{(0,A.fb)(e.reason)?e.reason.includes("Can't list the cover at this time")?t((0,G.e1)({show:!0,message:"Please wait for some more time before listing the book.",type:3})):e.reason.includes("Listing for this book is disabled")?t((0,G.e1)({show:!0,message:"Listing this book is not allowed right now. Please try again later.",type:3})):e.reason.includes("Seller should own the NFT to list")&&t((0,G.e1)({show:!0,message:"Book is already listed. Please contact us on support@nalnda.com",type:3})):t((0,G.e1)("ERROR"))})).finally((()=>oe(!1))))})(e)}),(0,O.jsx)(x.Z,{ReviewForm:Ze,setReviewForm:Be,reviewHandler:()=>{(0,w.Z)("event_book_review"),(0,A.fb)(se)?(0,A.UE)(Ze.body)&&(0,A.UE)(Ze.rating)&&(0,A.UE)(Ze.title)?(oe(!0),_()({url:`${P._}/api/book/reviews`,method:"POST",data:{review:{...Ze},bookAddress:ce.book_address,ownerAddress:se}}).then((e=>{200===e.status?(t((0,N.VG)()),Ke(),We()):t((0,G.e1)("NOT200"))})).catch((e=>{oe(!1),t((0,G.e1)("ERROR"))}))):t((0,G.e1)({show:!0,message:"Please fill the review.",type:3})):t((0,G.e1)({show:!0,message:"Please login first",type:3}))}}),(0,O.jsx)(f.Z,{QuotesForm:$e,setQuotesForm:Me,quoteHandler:()=>{(0,w.Z)("event_book_quote"),(0,A.fb)(se)?(0,A.UE)($e.quote)?(oe(!0),_()({url:`${P._}/api/book/quotes`,method:"POST",data:{quote:{body:$e.quote},bookAddress:ce.book_address,ownerAddress:se}}).then((e=>{200===e.status?(t((0,N.VG)()),Ve(),Qe()):t((0,G.e1)("NOT200"))})).catch((e=>{oe(!1),t((0,G.e1)("ERROR"))}))):t((0,G.e1)({show:!0,message:"Please enter the quote.",type:3})):t((0,G.e1)({show:!0,message:"Please login first",type:3}))}}),(0,O.jsx)(B.Z,{bookID:ye})]}):null]})]})}}}]);
//# sourceMappingURL=953.dbf63b25.chunk.js.map