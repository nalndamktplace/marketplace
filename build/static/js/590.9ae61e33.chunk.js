"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[590],{45972:(e,a,t)=>{t.d(a,{r:()=>p});var s,o,r,i,n=t(72791);function l(){return l=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},l.apply(this,arguments)}function _(e,a){let{title:t,titleId:_,...p}=e;return n.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:a,"aria-labelledby":_},p),t?n.createElement("title",{id:_},t):null,s||(s=n.createElement("line",{x2:.02,transform:"translate(30 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),o||(o=n.createElement("rect",{width:32,height:32,rx:3,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),r||(r=n.createElement("path",{d:"M4,19.67l8-8a4.029,4.029,0,0,1,6,0l10,10",transform:"translate(4 10.33)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),i||(i=n.createElement("path",{d:"M14,15.67l2-2a4.029,4.029,0,0,1,6,0l4,4",transform:"translate(14 12.33)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const p=n.forwardRef(_);t.p},7018:(e,a,t)=>{t.d(a,{Z:()=>r});var s=t(72791),o=t(80184);const r=e=>{let{progress:a}=e;const t=(0,s.useRef)();return(0,s.useEffect)((()=>{var e;null===t||void 0===t||null===(e=t.current)||void 0===e||e.style.setProperty("--progress",a)}),[a]),(0,o.jsx)("div",{className:"progressbar",children:(0,o.jsx)("div",{ref:t,className:"progressbar__value"})})}},46332:(e,a,t)=>{t.d(a,{d:()=>s});const s=["Children (0-14 years)","Youth (15-24 years)","Adults (25-64 years)","Seniors 65+"]},14605:(e,a,t)=>{t.d(a,{Hb:()=>o,iV:()=>s});const s="0xdA5289fCAAF71d52a80A254da614a192b693e977",o="0xCcCABe37d0bDec98628860C69895092340de07B0"},83483:(e,a,t)=>{t.d(a,{x:()=>s});const s=["Adventure","Art","Autobiography","Biography","Business","Children's","Children's History","Classics","Comics","Contemporary Fiction","Cookbooks","Crime Fiction","Drama","Dystopian","Essays","Family","Fantasy","Fiction","Food & Drink","Graphic Novels","Guide / How-To","Health","Historical Fiction","History","Horror","Humanities & Social Sciences","Humor","LGBTQ+","Literary Fiction","Magical Realism","Management","Memoir","Music","Mystery","New Adult","Parenting & Families","Personal Development","Philosophy","Photography","Poetry","Politics","Psychological Thrillers","Psychology","Relationships","Religion & Spirituality","Romance","Science","Science & Technology","Science Fiction","Self Help","Short Story","Society & Culture","Sports","Thriller","Travel","Women's Fiction","Young Adult"]},35771:(e,a,t)=>{t.d(a,{a:()=>s});const s=["EN - English","ZH - Chinese","DE - German","ES - Spanish","JA - Japanese","RU - Russian","FR - French","KO - Korean","IT - Italian","NL - Dutch","PT - Portugese","HI - Hindi","PL - Polish","DA - Danish","BN - Bangla"]},85590:(e,a,t)=>{t.r(a),t.d(a,{default:()=>T});var s=t(74569),o=t.n(s),r=t(72426),i=t.n(r),n=t(16871),l=t(72791),_=t(16030),p=t(54270),c=t(17303),d=t(6222),u=t(88062),h=t(83374),b=t(88952),m=t(61199),g=t(95899),v=t(98669),y=t(44643),f=t(29316),k=t(4127),x=t(75454),w=t(7018),j=t(45972),S=t(83483),N=t(65248),E=t(35771),F=t(46332),C=t(14605),P=t(55169),L=t(80184);const T=e=>{const a=(0,_.I0)(),t=(0,n.s0)(),s=(0,_.v9)((e=>e.UserState)),r=(0,_.v9)((e=>e.BWalletState)),[T,A]=(0,l.useState)(!1),[I,R]=(0,l.useState)(null),[Z,O]=(0,l.useState)(null),[D,B]=(0,l.useState)({name:"",author:"",cover:null,preview:null,book:null,genres:[],ageGroup:[],price:"",pages:"",publication:"",isbn:"",synopsis:"",language:"",published:"",secondarySalesDate:"",primarySales:"",secondaryFrom:i()().add(1,"days")}),[H,G]=(0,l.useState)(0),[U,M]=(0,l.useState)(!0);return(0,l.useEffect)((()=>{(0,g.Z)("page_view_publish")}),[]),(0,l.useEffect)((()=>{(0,f.fb)(D.cover)&&R(URL.createObjectURL(D.cover))}),[D]),(0,l.useEffect)((()=>{a(T?(0,k.yh)():(0,k.v3)())}),[T,a]),(0,l.useEffect)((()=>{A(!0),(0,f.fb)(r.smartAccount)&&O(r.smartAccount.address),A(!1)}),[r]),(0,l.useEffect)((()=>{const e=["publication","isbn","primarySales","secondarySalesDate"];let a=0,t=Object.keys(D).length;Object.keys(D).forEach((s=>{var o;if(e.includes(s))return t--;""!==D[s]&&0!==(null===(o=D[s])||void 0===o?void 0:o.length)&&null!==D[s]&&a++})),G(a/t)}),[D]),(0,l.useEffect)((()=>{if(window.localStorage)try{(0,g.Z)("event_publish_load_data");let e=JSON.parse(window.localStorage.getItem("publish-book-form-data"));if(!(0,f.fb)(e))return void M(!1);B({...D,name:e.name,author:e.author,genres:e.genres,ageGroup:e.ageGroup,price:e.price,pages:e.pages,publication:e.publication,synopsis:e.synopsis,language:e.language}),M(!1)}catch(e){M(!1)}}),[]),(0,l.useEffect)((()=>{(0,g.Z)("event_publish_save_data"),U||window.localStorage&&window.localStorage.setItem("publish-book-form-data",JSON.stringify(D))}),[D,U]),(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(p.q,{children:(0,L.jsx)("meta",{name:"Publish",content:""})}),(0,L.jsx)(b.Z,{noFooter:!0,containerClass:"publish publish__bg",children:(0,L.jsxs)("div",{className:"publish__data",children:[(0,L.jsxs)("div",{className:"publish__data__form utils__padding__bottom--s",children:[(0,L.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Publish eBook"}),(0,L.jsx)(m.Z,{type:"string",label:"book name",value:D.name,onChange:e=>B({...D,name:e.target.value}),description:"Enter name of the book"}),(0,L.jsx)(m.Z,{type:"string",label:"book author",value:D.author,onChange:e=>B({...D,author:e.target.value}),description:"Enter name of the author"}),(0,L.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Upload Files"}),(0,L.jsx)(m.Z,{type:"file",label:"cover",accept:"image/*",onChange:e=>B({...D,cover:e.target.files[0]}),description:"Upload a picture of book cover. File types supported: JPG, PNG, GIF, SVG, WEBP"}),(0,L.jsx)(m.Z,{type:"file",label:"preview",accept:"application/epub+zip",onChange:e=>B({...D,preview:e.target.files[0]}),description:"Upload a sample of book for preview. File types supported: EPUB"}),(0,L.jsx)(m.Z,{type:"file",label:"book",accept:"application/epub+zip",onChange:e=>B({...D,book:e.target.files[0]}),description:"Upload a book. File types supported: EPUB"}),(0,L.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Meta Data"}),(0,L.jsx)(m.Z,{type:"number",label:"price in USDC",value:D.price,onChange:e=>B({...D,price:e.target.value}),description:"Price of book in USDC"}),(0,L.jsx)(m.Z,{type:"list",label:"genres",listType:"multiple",minLimit:1,maxLimit:5,values:S.x,value:D.genres,onSave:e=>B({...D,genres:e}),placeholder:"e.g., Action, Adventure",description:"Select genres for the book. Max 5 genres can be selected"}),(0,L.jsx)(m.Z,{type:"list",label:"age group",listType:"multiple",minLimit:1,maxLimit:F.d.length,values:F.d,value:D.ageGroup,onSave:e=>B({...D,ageGroup:e}),placeholder:"e.g., Youth (15-24 years)",description:"Select the most appropriate age group for the book."}),(0,L.jsx)(m.Z,{type:"number",label:"number of print pages",value:D.pages,onChange:e=>B({...D,pages:e.target.value}),description:"Enter number of pages in the book"}),(0,L.jsx)(m.Z,{type:"string",label:"publication",value:D.publication,onChange:e=>B({...D,publication:e.target.value}),description:"Enter name of the publisher",required:!1}),(0,L.jsx)(m.Z,{type:"text",label:"synopsis",lines:8,value:D.synopsis,onChange:e=>B({...D,synopsis:e.target.value}),description:"Write a brief description about the book"}),(0,L.jsx)(m.Z,{type:"list",label:"language",listType:"single",values:E.a,value:D.language,onSave:e=>B({...D,language:e}),description:"Select the language of the book"}),(0,L.jsx)(m.Z,{type:"date",label:"published",onChange:e=>B({...D,published:e.target.value}),description:"Enter when book was published"}),(0,L.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Secondary Sales Conditions"}),(0,L.jsx)(m.Z,{type:"date",label:"open on",min:i()().add(1,"days"),max:i()().add(150,"days"),onChange:e=>B({...D,secondaryFrom:e.target.value}),description:"From when to start secondary sales"})]}),(0,L.jsx)("div",{className:"publish__data__preview",children:(0,L.jsxs)("div",{className:"publish__data__preview__container",children:[(0,L.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--n",children:"Preview"}),(0,L.jsxs)("div",{className:"publish__data__preview__book",onClick:()=>{},children:[(0,L.jsx)("div",{className:"publish__data__preview__book__cover",children:(0,f.fb)(I)?(0,L.jsx)("img",{className:"publish__data__preview__book__cover__img",src:I,alt:D.name+" cover"}):(0,L.jsxs)("div",{className:"publish__data__preview__book__cover__placeholder",children:[(0,L.jsx)(j.r,{stroke:"currentColor"}),(0,L.jsx)("span",{className:"utils__margin__top--m",children:"Book Cover"})]})}),(0,L.jsxs)("div",{className:"publish__data__preview__book__data",children:[(0,L.jsx)("div",{className:"publish__data__preview__book__data__title  typo__head--5",children:D.name}),(0,L.jsx)("div",{className:"publish__data__preview__book__data__author typo__subtitle typo__color--n500",children:D.author}),D.price&&(0,L.jsx)("div",{className:"publish__data__preview__book__data__price typo__color--success",children:0===parseFloat(D.price)?"FREE":(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",D.price]})}),D.language&&(0,L.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Language"}),(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__value typo__body typo__color--n500",children:D.language})]}),(0,f.vd)(D.genres)&&(0,L.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Genres"}),(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__chips",children:D.genres.map((e=>(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__chips__item typo__body",children:e},e)))})]}),D.publication&&(0,L.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Publication"}),(0,L.jsx)("div",{className:"publish__data__preview__book__data__field__value typo__body typo__color--n500",children:D.publication})]})]})]}),(0,L.jsxs)("div",{className:"publish__data__preview__progress",children:[(0,L.jsxs)("div",{className:"publish__data__preview__progress__container",children:[(0,L.jsxs)("div",{className:"publish__data__preview__progress__container__value typo__color--n700",children:[Math.round(100*H),"%"]}),(0,L.jsx)(w.Z,{progress:H})]}),(0,L.jsx)(x.Z,{type:"primary",disabled:!1,size:"lg",onClick:()=>async function(){const{name:e,author:n,cover:l,book:_,genres:p,ageGroup:b,price:m,pages:k,publication:x,synopsis:w,language:j,published:F,secondaryFrom:L}=D;if((0,f.fb)(e)&&(0,f.vd)(n)&&(0,f.fb)(l)&&(0,f.fb)(_)&&(0,f.fb)(p)&&(0,f.fb)(b)&&(0,f.fb)(m)&&(0,f.fb)(k)&&(0,f.fb)(w)&&(0,f.fb)(j)&&(0,f.fb)(F)&&(0,f.fb)(L)){(0,g.Z)("event_publish_list"),A(!0);let T=new FormData;T.append("book",D.book),T.append("cover",D.cover),T.append("bookTitle",D.title),T.append("synopsis",D.synopsis),o()({url:N._+"/api/book/submarine",method:"POST",headers:{"user-id":s.user.uid,address:s.user.wallet,authorization:`Bearer ${s.tokens.acsTkn.tkn}`},data:T}).then((async s=>{const g=s.data.book.url,T=s.data.cover.url;let I=[];p.forEach((e=>I.push(S.x.indexOf(e).toString())));const R=E.a.indexOf(j).toString(),O=Math.round(i().duration(D.secondaryFrom-i()()).asDays());if((0,f.fb)(R)&&(0,f.fb)(I)&&!isNaN(O)&&(0,f.vd)(e)&&(0,f.vd)(n)&&(0,f.fb)(l)&&(0,f.fb)(_)&&(0,f.vd)(k))try{const s=new c.vU(["function createNewBook(address _author, string memory _coverURI, uint256 _initialPrice, uint256 _daysForSecondarySales, uint256 _lang, uint256[] memory _genre )"]),i=r.smartAccount.address,l=s.encodeFunctionData("createNewBook",[i,T,d.parseUnits(m,6),O,R,I]),_={to:C.Hb,data:l};r.smartAccount.on("txMined",(s=>{s.receipt.logs.forEach((r=>{r.topics.forEach((i=>{if(i===(0,u.keccak256)((0,h.Y0)("OwnershipTransferred(address,address)"))){const i=r.address,l=s.receipt.transactionHash,_=s.receipt.status;if((0,f.fb)(i)&&(0,f.fb)(_)&&1===_&&(0,f.fb)(l)){let s=new FormData;s.append("epub",D.preview),s.append("name",e),s.append("author",n),s.append("cover",T),s.append("coverFile",D.cover),s.append("book",g),s.append("genres",JSON.stringify(p.sort(((e,a)=>e>a)))),s.append("ageGroup",JSON.stringify(b.sort(((e,a)=>e>a)))),s.append("price",m),s.append("pages",k),s.append("publication",x),s.append("synopsis",w.replace(/<[^>]+>/g,"")),s.append("language",j),s.append("published",F),s.append("secondarySalesFrom",L),s.append("publisherAddress",Z),s.append("bookAddress",i),s.append("txHash",l),o()({url:N._+"/api/book/publish",method:"POST",data:s}).then((e=>{200===e.status?((0,v.SR)("publish-book-form-data"),A(!1),t("/library",{state:{tab:"published"}})):a((0,y.e1)("ERROR"))})).catch((e=>{(0,f.fb)(e.response)?413===e.response.status?a((0,y.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&a((0,y.e1)("INVALID_FILE_TYPE")):a((0,y.e1)("NOT200")),A(!1)}))}else A(!1),(0,f.fb)(l)?a((0,y.e1)({show:!0,message:`The transaction to mint eBook failed.\ntxhash: ${l}`,type:3})):a((0,y.e1)({show:!0,message:"The transaction to mint eBook failed.",type:3}))}}))}))})),r.smartAccount.on("error",(e=>{console.error({error:e}),A(!1),a((0,y.e1)("ERROR"))}));const S=await r.smartAccount.prepareRefundTransaction({transaction:_}),E=await r.smartAccount.createRefundTransaction({transaction:_,feeQuote:S[0]});await r.smartAccount.sendTransaction({tx:E,gasLimit:{hex:P.Lw,type:"hex"}})}catch(B){A(!1),console.error({error:B}),a((0,y.e1)("ERROR"))}else a((0,y.e1)({show:!0,message:"Incomplete details",type:3})),A(!1)})).catch((e=>{console.error({err:e}),(0,f.fb)(e.response)?413===e.response.status?a((0,y.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&a((0,y.e1)("INVALID_FILE_TYPE")):a((0,y.e1)("NOT200")),A(!1)}))}else a((0,y.e1)({show:!0,message:"Incomplete details",type:3}))}(),children:"Publish"})]})]})})]})})]})}}}]);
//# sourceMappingURL=590.9ae61e33.chunk.js.map