"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[472],{5472:function(e,t,a){a.r(t);var n=a(2982),r=a(885),s=a(4569),o=a.n(s),c=a(6871),i=a(2791),l=a(6030),u=a(4643),_=a(9316),d=a(4127),f=a(5248),p=a(639),h=a(8979),k=a(733),b=a(5454),y=a(6759),x=a(354),v=a(3930),m=a(5602),g=a(906),j=a(5899),N=a(184);t.default=function(){var e=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"}],t=(0,c.s0)(),a=(0,l.I0)(),s=(0,l.v9)((function(e){return e.WalletState})),R=(0,i.useState)([]),w=(0,r.Z)(R,2),Z=w[0],E=w[1],S=(0,i.useState)(null),O=(0,r.Z)(S,2),T=O[0],I=O[1],C=(0,i.useState)(e),L=(0,r.Z)(C,2),P=L[0],G=L[1],A=(0,i.useState)(!1),H=(0,r.Z)(A,2),F=H[0],M=H[1],W=(0,i.useState)(!1),B=(0,r.Z)(W,2),D=B[0],q=B[1],z=(0,i.useState)(window.innerWidth<600?"LIST":"GRID"),Y=(0,r.Z)(z,2),J=Y[0],K=Y[1],Q=(0,i.useState)([]),U=(0,r.Z)(Q,2),V=U[0],X=U[1],$=(0,i.useState)(100),ee=(0,r.Z)($,2),te=ee[0],ae=ee[1];return(0,i.useEffect)((function(){(0,j.Z)("page_view_explore")}),[]),(0,i.useEffect)((function(){a(F?(0,d.yh)():(0,d.v3)())}),[F,a]),(0,i.useEffect)((function(){M(!0),o()({url:f._+"/api/book/all",method:"GET"}).then((function(e){200===e.status?X(e.data):a((0,u.e1)("NOT200"))})).catch((function(e){a((0,u.e1)("ERROR"))})).finally((function(){return M(!1)}))}),[a]),(0,i.useEffect)((function(){M(!0),(0,_.fb)(s.wallet.provider)&&I(s.wallet.address),M(!1)}),[s]),(0,i.useEffect)((function(){var e=V;(0,_.fb)(e)&&(P.forEach((function(t){switch(t.type){case"range":(0,_.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,_.vd)(t.value)){var a=[];t.value.forEach((function(n){return e.forEach((function(e){e[t.key].indexOf(n)>-1&&a.filter((function(t){return t.id===e.id})).length<1&&a.push(e)}))})),e=a}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),E(e))}),[P,V]),(0,i.useEffect)((function(){if((0,_.vd)(V)){var e=Math.max.apply(Math,(0,n.Z)(V.map((function(e){return e.price}))));e=10*Math.ceil(e/10),ae(e||100)}}),[V]),(0,N.jsx)(h.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,N.jsxs)("div",{className:"explore__data",children:[(0,N.jsx)("div",{className:"explore__data__filter-panel-container","data-filter-open":D,children:(0,N.jsx)(x.Z,{maxPrice:te,setFiltersPanelOpen:q,config:p.j,defaults:e,filters:P,setFilters:G})}),(0,N.jsxs)("div",{className:"explore__data__books","data-filter-open":D,children:[(0,N.jsxs)("div",{className:"explore__data__books__header",children:[(0,N.jsxs)("div",{className:"explore__data__books__header__filter",children:[(0,N.jsx)(b.Z,{type:"icon",onClick:function(){return q((function(e){return!e}))},children:(0,N.jsx)(v.r,{fill:D?"currentColor":"transparent"})}),(0,N.jsxs)("div",{className:"typo__body typo__color--n500",children:["Found ",(0,N.jsx)("span",{className:"typo__color--n700",style:{fontWeight:"500"},children:Z.length})," results"]})]}),(0,N.jsxs)("div",{className:"explore__data__books__header__layout",children:[(0,N.jsxs)(b.Z,{className:"account__data__books__header__layout__button typo__act",onClick:function(){return K("LIST")},children:[(0,N.jsx)(g.r,{}),(0,N.jsx)("span",{children:"List"})]}),(0,N.jsxs)(b.Z,{className:"account__data__books__header__layout__button typo__act",onClick:function(){return K("GRID")},children:[(0,N.jsx)(m.r,{}),(0,N.jsx)("span",{children:"GRID"})]})]})]}),(0,N.jsx)("div",{className:"explore__data__books__wrapper","data-layout":J,children:(0,_.fb)(Z)&&Z.length>0?function(){var e=[];return Z.forEach((function(n){e.push((0,N.jsx)(y.Z,{layout:J,book:n,onBuy:function(){return function(e){(0,j.Z)("event_explore_purchase_new"),M(!0),k.Z.purchaseNft(T,e.book_address,e.price.toString(),s.wallet.signer).then((function(t){a((0,u.e1)({show:!0,message:"Book purchased.",type:1}));var n=Number(t.events.filter((function(e){return"Transfer(address,address,uint256)"===e.eventSignature}))[0].args[2]._hex);o()({url:f._+"/api/book/purchase",method:"POST",data:{ownerAddress:T,bookAddress:e.book_address,tokenId:n}}).then((function(e){200!==e.status&&a((0,u.e1)("NOT200"))})).catch((function(e){a((0,u.e1)("ERROR"))})).finally((function(){return M(!1)})),o()({url:f._+"/api/book/copies",method:"POST",data:{bookAddress:e.book_address,copies:n}}).then((function(e){200!==e.status&&a((0,u.e1)("NOT200"))})).catch((function(e){a((0,u.e1)("ERROR"))}))})).catch((function(e){M(!1),4001===e.code?a((0,u.e1)({show:!0,message:"Transaction denied by user.",type:3})):a((0,u.e1)("ERROR"))}))}(n)},onOpen:function(){return function(e){(0,j.Z)("navigate_explore_book"),t("/book",{state:e})}(n)}},n.id))})),e}():(0,N.jsxs)("div",{className:"explore__data__books__wrapper__empty",children:[(0,N.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"explore__data__books__wrapper__image",loading:"lazy"}),(0,N.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]})})}}}]);
//# sourceMappingURL=472.71b0de80.chunk.js.map