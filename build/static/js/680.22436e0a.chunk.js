"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[680],{91680:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var a=n(93433),r=n(29439),s=n(74569),o=n.n(s),c=n(16871),i=n(72791),l=n(16030),_=n(54270),u=n(44643),d=n(29316),h=n(4127),f=n(65248),p=n(50639),m=n(88952),x=n(43935),v=n(75454),y=n(56759),b=n(40354),j=n(87928),k=n(89018),g=n(9135),N=n(15054),w=n(80184),E=function(e){var t=e.title,n=void 0===t?"":t,a=e.open,r=void 0!==a&&a,s=(e.toggleModal,e.children),o=e.cancellable,c=(0,l.I0)();(0,i.useEffect)((function(){window.document.documentElement.style.overflowY=r?"hidden":"auto"}),[r]);return(0,w.jsx)(k.Z,{show:r,hideOnClick:!0,children:(0,w.jsxs)("div",{className:function(){var e=["modal_search__wrapper"];return r?e.push("modal__wrapper--open"):e.push("modal__wrapper--close"),e.join(" ")}(),children:[(0,w.jsxs)("div",{className:"modal_search__header",children:[(0,w.jsx)("div",{className:"modal__wrapper__header__title typo__head--6",children:n}),(0,w.jsx)("div",{className:"modal__wrapper__header__close-button",children:o?(0,w.jsx)(v.Z,{type:"icon",className:"modal_search__wrapper__close-icon",onClick:function(){return c((0,j.VG)())},children:(0,w.jsx)(g.r,{})}):null})]}),(0,w.jsx)("div",{className:"modal_search__content",children:s})]})})},Z=function(){var e=(0,l.I0)(),t=(0,c.s0)(),n=(0,l.v9)((function(e){return e.ModalState})),a=(0,i.useState)(!1),s=(0,r.Z)(a,2),_=s[0],p=s[1],m=(0,i.useState)(!1),x=(0,r.Z)(m,2),v=x[0],y=x[1],b=(0,i.useState)([]),g=(0,r.Z)(b,2),Z=g[0],R=g[1],S=(0,i.useState)(""),O=(0,r.Z)(S,2),T=O[0],C=O[1];(0,i.useEffect)((function(){T.length>3&&T.length<16&&(p(!0),o()({url:f._+"/api/book/search",method:"GET",params:{query:T}}).then((function(t){200===t.status?R(t.data):e((0,u.e1)("NOT200"))})).catch((function(t){e((0,u.e1)("ERROR"))})).finally((function(){return p(!1)})))}),[e,T]),(0,i.useEffect)((function(){!0===n.show&&n.type===j.ni?y(!0):y(!1)}),[n]),(0,i.useEffect)((function(){e(_?(0,h.yh)():(0,h.v3)())}),[_,e]);return(0,w.jsx)(k.Z,{show:v,children:(0,w.jsxs)(E,{title:"Search",open:v,toggleModal:function(t){!1===t&&e((0,j.VG)())},cancellable:!0,children:[(0,w.jsxs)("div",{className:"modal_search",children:[(0,w.jsx)("input",{value:T,onChange:function(e){return C(e.target.value)},type:"text",placeholder:"Search books and authors",className:"modal_search__input"}),(0,w.jsx)("div",{className:"modal_search__icon",children:(0,w.jsx)(N.r,{width:24,height:24,stroke:"currentColor"})})]}),(0,w.jsx)("div",{className:function(){var e=["modal_search__options"];return(0,d.vd)(T)&&T.length>3&&e.push("dropdown__options--open"),e.join(" ")}(),children:function(){var e=[];return(0,d.vd)(Z)&&Z.forEach((function(n){e.push((0,w.jsxs)("div",{onClick:function(){t("/book",{state:n}),C("")},className:"header__content__search__result",children:[(0,w.jsx)("img",{src:n.cover_public_url?n.cover_public_url:n.cover,alt:n.title+"'s Cover",className:"header__content__search__result__cover",loading:"lazy"}),(0,w.jsxs)("div",{className:"header__content__search__result__info",children:[(0,w.jsx)("div",{className:"header__content__search__result__info__name typo__head typo__subtitle typo__transform--capital",children:n.title}),(0,w.jsx)("div",{className:"header__content__search__result__info__author typo__subtitle typo__subtitle--2 typo__transform--upper",children:n.author}),(0,w.jsx)("div",{className:"index__collection__books__item__data__price typo__act typo__color--success",children:0===n.price?"FREE":(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",n.price]})})]})]},n.id))})),e}()})]})})},R=n(72808),S=n(95899),O=function(){var e=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"}],t=(0,c.s0)(),n=(0,l.I0)(),s=(0,l.v9)((function(e){return e.BWalletState})),k=(0,i.useState)([]),g=(0,r.Z)(k,2),E=g[0],O=g[1],T=(0,i.useState)(null),C=(0,r.Z)(T,2),I=C[0],A=C[1],F=(0,i.useState)(e),G=(0,r.Z)(F,2),M=G[0],P=G[1],W=(0,i.useState)(!1),H=(0,r.Z)(W,2),L=H[0],B=H[1],q=(0,i.useState)(!1),D=(0,r.Z)(q,2),Y=D[0],z=D[1],V=(0,i.useState)([]),K=(0,r.Z)(V,2),U=K[0],J=K[1],Q=(0,i.useState)(100),X=(0,r.Z)(Q,2),$=X[0],ee=X[1];(0,i.useEffect)((function(){(0,S.Z)("page_view_explore")}),[]),(0,i.useEffect)((function(){n(L?(0,h.yh)():(0,h.v3)())}),[L,n]),(0,i.useEffect)((function(){B(!0),o()({url:f._+"/api/book",method:"GET"}).then((function(e){200===e.status?J(e.data):n((0,u.e1)("NOT200"))})).catch((function(e){n((0,u.e1)("ERROR"))})).finally((function(){return B(!1)}))}),[n]),(0,i.useEffect)((function(){B(!0),(0,d.fb)(s.smartAccount)&&A(s.smartAccount.address),B(!1)}),[s]),(0,i.useEffect)((function(){var e=U;(0,d.fb)(e)&&(M.forEach((function(t){switch(t.type){case"range":(0,d.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,d.vd)(t.value)){var n=[];t.value.forEach((function(a){return e.forEach((function(e){e[t.key].indexOf(a)>-1&&n.filter((function(t){return t.id===e.id})).length<1&&n.push(e)}))})),e=n}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),O(e))}),[M,U]),(0,i.useEffect)((function(){if((0,d.vd)(U)){var e=Math.max.apply(Math,(0,a.Z)(U.map((function(e){return e.price}))));e=10*Math.ceil(e/10),ee(e||100)}}),[U]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(_.q,{children:(0,w.jsx)("meta",{name:"Explore",content:"Explore exciting books"})}),(0,w.jsxs)(m.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:[(0,w.jsxs)("div",{className:"explore__data",children:[(0,w.jsx)("div",{className:"explore__data__filter-panel-container","data-filter-open":Y,children:(0,w.jsx)(b.Z,{maxPrice:$,setFiltersPanelOpen:z,config:p.j,defaults:e,filters:M,setFilters:P})}),(0,w.jsxs)("div",{className:"explore__data__books","data-filter-open":Y,children:[(0,w.jsxs)("div",{className:"explore__data__books__header",children:[(0,w.jsxs)("div",{className:"explore__data__books__header__filter",children:[(0,w.jsx)(v.Z,{type:"icon",onClick:function(){return z((function(e){return!e}))},children:(0,w.jsx)(R.r,{fill:Y?"currentColor":"transparent"})}),(0,w.jsxs)("div",{className:"typo__body typo__color--n500",children:["Found ",(0,w.jsx)("span",{className:"typo__color--n700",style:{fontWeight:"500"},children:E.length})," results"]})]}),window.innerWidth<600?(0,w.jsx)("div",{className:"explore__data__books__header__layout",children:(0,w.jsx)(v.Z,{className:"account__data__books__header__layout__button typo__act",onClick:function(){n((0,j.K4)(j.ni))},children:(0,w.jsx)(N.r,{})})}):null]}),(0,w.jsx)("div",{className:"explore__data__books__wrapper","data-layout":window.innerWidth<600?"LIST":"GRID",children:(0,d.fb)(E)&&E.length>0?function(){var e=[];return E.forEach((function(a){e.push((0,w.jsx)(y.Z,{layout:window.innerWidth<600?"LIST":"GRID",book:a,onBuy:function(){return function(e){(0,S.Z)("event_explore_purchase_new"),B(!0),x.Z.purchaseNft(I,e.book_address,e.price.toString(),s.smartAccount.signer).then((function(t){n((0,u.e1)({show:!0,message:"Book purchased.",type:1}));var a=Number(t.events.filter((function(e){return"Transfer(address,address,uint256)"===e.eventSignature}))[0].args[2]._hex);o()({url:f._+"/api/book/purchase",method:"POST",data:{ownerAddress:I,bookAddress:e.book_address,tokenId:a}}).then((function(e){200!==e.status&&n((0,u.e1)("NOT200"))})).catch((function(e){n((0,u.e1)("ERROR"))})).finally((function(){return B(!1)})),o()({url:f._+"/api/book/copies",method:"POST",data:{bookAddress:e.book_address,copies:a}}).then((function(e){200!==e.status&&n((0,u.e1)("NOT200"))})).catch((function(e){n((0,u.e1)("ERROR"))}))})).catch((function(e){B(!1),4001===e.code?n((0,u.e1)({show:!0,message:"Transaction denied by user.",type:3})):n((0,u.e1)("ERROR"))}))}(a)},onOpen:function(){return function(e){(0,S.Z)("navigate_explore_book"),t("/book/".concat(e.id))}(a)}},a.id))})),e}():(0,w.jsxs)("div",{className:"explore__data__books__wrapper__empty",children:[(0,w.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"explore__data__books__wrapper__image",loading:"lazy"}),(0,w.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]}),(0,w.jsx)(Z,{})]})]})}}}]);
//# sourceMappingURL=680.22436e0a.chunk.js.map