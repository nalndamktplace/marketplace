"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[680],{1680:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var a=n(2982),r=n(885),s=n(4569),o=n.n(s),c=n(6871),i=n(2791),l=n(6030),_=n(4643),u=n(9316),d=n(4127),h=n(5248),f=n(639),p=n(1634),m=n(733),v=n(5454),x=n(6759),y=n(354),b=n(7928),k=n(9018),j=n(9135),g=n(7803),w=n(184),N=function(e){var t=e.title,n=void 0===t?"":t,a=e.open,r=void 0!==a&&a,s=(e.toggleModal,e.children),o=e.cancellable,c=(0,l.I0)();(0,i.useEffect)((function(){window.document.documentElement.style.overflowY=r?"hidden":"auto"}),[r]);return(0,w.jsx)(k.Z,{show:r,hideOnClick:!0,children:(0,w.jsxs)("div",{className:function(){var e=["modal_search__wrapper"];return r?e.push("modal__wrapper--open"):e.push("modal__wrapper--close"),e.join(" ")}(),children:[(0,w.jsxs)("div",{className:"modal_search__header",children:[(0,w.jsx)("div",{className:"modal__wrapper__header__title typo__head--6",children:n}),(0,w.jsx)("div",{className:"modal__wrapper__header__close-button",children:o?(0,w.jsx)(v.Z,{type:"icon",className:"modal_search__wrapper__close-icon",onClick:function(){return c((0,b.VG)())},children:(0,w.jsx)(j.r,{})}):null})]}),(0,w.jsx)("div",{className:"modal_search__content",children:s})]})})},E=function(){var e=(0,l.I0)(),t=(0,c.s0)(),n=(0,l.v9)((function(e){return e.ModalState})),a=(0,i.useState)(!1),s=(0,r.Z)(a,2),d=(s[0],s[1]),f=(0,i.useState)(!1),p=(0,r.Z)(f,2),m=p[0],v=p[1],x=(0,i.useState)([]),y=(0,r.Z)(x,2),j=y[0],E=y[1],Z=(0,i.useState)(""),R=(0,r.Z)(Z,2),S=R[0],O=R[1];(0,i.useEffect)((function(){S.length>3&&S.length<16&&(d(!0),o()({url:h._+"/api/book/search",method:"GET",params:{query:S}}).then((function(t){200===t.status?E(t.data):e((0,_.e1)("NOT200"))})).catch((function(t){e((0,_.e1)("ERROR"))})).finally((function(){return d(!1)})))}),[e,S]),(0,i.useEffect)((function(){!0===n.show&&n.type===b.ni?v(!0):v(!1)}),[n]);return(0,w.jsx)(k.Z,{show:m,children:(0,w.jsxs)(N,{title:"Search",open:m,toggleModal:function(t){!1===t&&e((0,b.VG)())},cancellable:!0,children:[(0,w.jsxs)("div",{className:"modal_search",children:[(0,w.jsx)("input",{value:S,onChange:function(e){return O(e.target.value)},type:"text",placeholder:"Search books and authors",className:"modal_search__input"}),(0,w.jsx)("div",{className:"modal_search__icon",children:(0,w.jsx)(g.r,{width:24,height:24,stroke:"currentColor"})})]}),(0,w.jsx)("div",{className:function(){var e=["modal_search__options"];return(0,u.vd)(S)&&S.length>3&&e.push("dropdown__options--open"),e.join(" ")}(),children:function(){var e=[];return(0,u.vd)(j)&&j.forEach((function(n){e.push((0,w.jsxs)("div",{onClick:function(){t("/book",{state:n}),O("")},className:"header__content__search__result",children:[(0,w.jsx)("img",{src:n.cover_public_url?n.cover_public_url:n.cover,alt:n.title+"'s Cover",className:"header__content__search__result__cover",loading:"lazy"}),(0,w.jsxs)("div",{className:"header__content__search__result__info",children:[(0,w.jsx)("div",{className:"header__content__search__result__info__name typo__head typo__subtitle typo__transform--capital",children:n.title}),(0,w.jsx)("div",{className:"header__content__search__result__info__author typo__subtitle typo__subtitle--2 typo__transform--upper",children:n.author}),(0,w.jsx)("div",{className:"index__collection__books__item__data__price typo__act typo__color--success",children:0===n.price?"FREE":(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",n.price]})})]})]},n.id))})),e}()})]})})},Z=n(3930),R=n(5899),S=function(){var e=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"}],t=(0,c.s0)(),n=(0,l.I0)(),s=(0,l.v9)((function(e){return e.WalletState})),k=(0,i.useState)([]),j=(0,r.Z)(k,2),N=j[0],S=j[1],O=(0,i.useState)(null),T=(0,r.Z)(O,2),C=T[0],I=T[1],G=(0,i.useState)(e),M=(0,r.Z)(G,2),F=M[0],P=M[1],W=(0,i.useState)(!1),H=(0,r.Z)(W,2),L=H[0],A=H[1],B=(0,i.useState)(!1),D=(0,r.Z)(B,2),Y=D[0],q=D[1],z=(0,i.useState)([]),V=(0,r.Z)(z,2),K=V[0],U=V[1],J=(0,i.useState)(100),Q=(0,r.Z)(J,2),X=Q[0],$=Q[1];(0,i.useEffect)((function(){(0,R.Z)("page_view_explore")}),[]),(0,i.useEffect)((function(){n(L?(0,d.yh)():(0,d.v3)())}),[L,n]),(0,i.useEffect)((function(){A(!0),o()({url:h._+"/api/book",method:"GET"}).then((function(e){200===e.status?U(e.data):n((0,_.e1)("NOT200"))})).catch((function(e){n((0,_.e1)("ERROR"))})).finally((function(){return A(!1)}))}),[n]),(0,i.useEffect)((function(){A(!0),(0,u.fb)(s.wallet.provider)&&I(s.wallet.address),A(!1)}),[s]),(0,i.useEffect)((function(){var e=K;(0,u.fb)(e)&&(F.forEach((function(t){switch(t.type){case"range":(0,u.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,u.vd)(t.value)){var n=[];t.value.forEach((function(a){return e.forEach((function(e){e[t.key].indexOf(a)>-1&&n.filter((function(t){return t.id===e.id})).length<1&&n.push(e)}))})),e=n}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),S(e))}),[F,K]),(0,i.useEffect)((function(){if((0,u.vd)(K)){var e=Math.max.apply(Math,(0,a.Z)(K.map((function(e){return e.price}))));e=10*Math.ceil(e/10),$(e||100)}}),[K]);return(0,w.jsxs)(p.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:[(0,w.jsxs)("div",{className:"explore__data",children:[(0,w.jsx)("div",{className:"explore__data__filter-panel-container","data-filter-open":Y,children:(0,w.jsx)(y.Z,{maxPrice:X,setFiltersPanelOpen:q,config:f.j,defaults:e,filters:F,setFilters:P})}),(0,w.jsxs)("div",{className:"explore__data__books","data-filter-open":Y,children:[(0,w.jsxs)("div",{className:"explore__data__books__header",children:[(0,w.jsxs)("div",{className:"explore__data__books__header__filter",children:[(0,w.jsx)(v.Z,{type:"icon",onClick:function(){return q((function(e){return!e}))},children:(0,w.jsx)(Z.r,{fill:Y?"currentColor":"transparent"})}),(0,w.jsxs)("div",{className:"typo__body typo__color--n500",children:["Found ",(0,w.jsx)("span",{className:"typo__color--n700",style:{fontWeight:"500"},children:N.length})," results"]})]}),window.innerWidth<600?(0,w.jsx)("div",{className:"explore__data__books__header__layout",children:(0,w.jsx)(v.Z,{className:"account__data__books__header__layout__button typo__act",onClick:function(){n((0,b.K4)(b.ni))},children:(0,w.jsx)(g.r,{})})}):null]}),(0,w.jsx)("div",{className:"explore__data__books__wrapper","data-layout":window.innerWidth<600?"LIST":"GRID",children:(0,u.fb)(N)&&N.length>0?function(){var e=[];return N.forEach((function(a){e.push((0,w.jsx)(x.Z,{layout:window.innerWidth<600?"LIST":"GRID",book:a,onBuy:function(){return function(e){(0,R.Z)("event_explore_purchase_new"),A(!0),m.Z.purchaseNft(C,e.book_address,e.price.toString(),s.wallet.signer).then((function(t){n((0,_.e1)({show:!0,message:"Book purchased.",type:1}));var a=Number(t.events.filter((function(e){return"Transfer(address,address,uint256)"===e.eventSignature}))[0].args[2]._hex);o()({url:h._+"/api/book/purchase",method:"POST",data:{ownerAddress:C,bookAddress:e.book_address,tokenId:a}}).then((function(e){200!==e.status&&n((0,_.e1)("NOT200"))})).catch((function(e){n((0,_.e1)("ERROR"))})).finally((function(){return A(!1)})),o()({url:h._+"/api/book/copies",method:"POST",data:{bookAddress:e.book_address,copies:a}}).then((function(e){200!==e.status&&n((0,_.e1)("NOT200"))})).catch((function(e){n((0,_.e1)("ERROR"))}))})).catch((function(e){A(!1),4001===e.code?n((0,_.e1)({show:!0,message:"Transaction denied by user.",type:3})):n((0,_.e1)("ERROR"))}))}(a)},onOpen:function(){return function(e){(0,R.Z)("navigate_explore_book"),t("/book/".concat(e.id))}(a)}},a.id))})),e}():(0,w.jsxs)("div",{className:"explore__data__books__wrapper__empty",children:[(0,w.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"explore__data__books__wrapper__image",loading:"lazy"}),(0,w.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]}),(0,w.jsx)(E,{})]})}}}]);
//# sourceMappingURL=680.777ef8a6.chunk.js.map