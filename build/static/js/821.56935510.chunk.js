"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[821],{8821:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});var s=a(1413),_=a(5861),o=a(885),n=a(7757),r=a.n(n),i=a(4569),c=a.n(i),d=a(2426),l=a.n(d),u=a(6030),h=a(6871),p=a(2791),f=a(1634),m=a(733),b=a(4254),k=a(5454),y=a(709),v=a(5807),x=a(6472),j=a(9018),g=a(5899),w=a(4643),N=a(9316),E=a(4127),R=a(7928),O=a(9135),Z=a(5843),T=a(5248),S=a(184),A=function(e){var t=e.onOldBookPurchase,a=e.onNewBookPurchase,s=e.data,_=(0,u.I0)(),n=(0,u.v9)((function(e){return e.UserState})),r=(0,u.v9)((function(e){return e.ModalState})),i=(0,p.useState)(!1),d=(0,o.Z)(i,2),l=d[0],h=d[1],f=(0,p.useState)([]),m=(0,o.Z)(f,2),b=m[0],y=m[1],v=(0,p.useState)(!1),x=(0,o.Z)(v,2),A=x[0],C=x[1],F=(0,p.useState)(0),P=(0,o.Z)(F,2),B=P[0],G=P[1],Y=(0,p.useState)(null),M=(0,o.Z)(Y,2),D=M[0],U=M[1],q=function(){if((0,N.vd)(b)){var e=b.sort((function(e,t){return e.price>t.price}));return parseFloat(e[0].price).toFixed(2)}};return(0,p.useEffect)((function(){window.document.documentElement.style.overflowY=l?"hidden":"auto"}),[l]),(0,p.useEffect)((function(){_(A?(0,E.yh)():(0,E.v3)())}),[A,_]),(0,p.useEffect)((function(){!0===r.show&&r.type===R.m0?((0,g.Z)("modal_view_purchase"),h(!0)):h(!1)}),[r]),(0,p.useEffect)((function(){!0===l&&(0,N.fb)(s)&&c()({url:T._+"/api/book/list",method:"GET",headers:{"user-id":n.user.uid,authorization:"Bearer ".concat(n.tokens.acsTkn.tkn)},params:{bookAddress:s.book_address}}).then((function(e){200===e.status?y(e.data):_((0,w.e1)("NOT200"))})).catch((function(e){_((0,w.e1)("ERROR"))})).finally((function(){return C(!1)}))}),[l,_,s,n]),(0,S.jsx)(j.Z,{show:l,children:(0,S.jsxs)("div",{className:function(){var e=["purchase purchase__wrapper"];return l?e.push("purchase__wrapper--open"):e.push("purchase__wrapper--close"),e.join(" ")}(),children:[(0,S.jsxs)("div",{className:"purchase__wrapper__header",children:[(0,S.jsx)("div",{className:"purchase__wrapper__header__title typo__head--6 typo__transform--capital",children:s.title.toLowerCase()}),(0,S.jsx)("div",{className:"purchase__wrapper__header__close-button",children:(0,S.jsx)("div",{onClick:function(){return h(!1)},children:(0,S.jsx)(O.r,{width:20,height:20})})})]}),(0,S.jsx)("div",{className:"purchase__wrapper__content",children:B?(0,S.jsxs)("div",{className:"purchase__wrapper__content__offers",children:[(0,S.jsxs)("div",{className:"typo__body typo__body--2 utils__d__flex purchase__wrapper__content__offers__count",children:[b.length," offer(s) starting from\xa0",0===s.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",q()]})]}),(0,S.jsx)("div",{className:"purchase__wrapper__content__offers__list",children:function(){var e=[];return(0,N.vd)(b)&&b.forEach((function(t){t.previous_owner===(null===D||void 0===D?void 0:D.previous_owner)?e.push((0,S.jsxs)("div",{className:"purchase__wrapper__content__offers__item purchase__wrapper__content__offers__item--active",children:[(0,S.jsxs)("p",{className:"utils__margin__bottom--n utils__d__flex utils__align__center",children:["Price:\xa0",0===t.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",(0,N.fb)(t.price)?parseFloat(t.price).toFixed(2):null]})]}),(0,S.jsxs)("p",{className:"utils__margin__bottom--n",children:["DA Score: ",(0,N.fb)(t.da_score)?parseFloat(t.da_score).toFixed(2):null]}),(0,S.jsxs)("p",{className:"utils__margin__bottom--n",children:["Seller: ",t.previous_owner]})]},t.book_address+"-"+t.order_id)):e.push((0,S.jsxs)("div",{onClick:function(){return U(t)},className:"purchase__wrapper__content__offers__item",children:[(0,S.jsxs)("p",{className:"utils__margin__bottom--n utils__d__flex utils__align__center",children:["Price:\xa0",0===t.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",(0,N.fb)(t.price)?parseFloat(t.price).toFixed(2):null]})]}),(0,S.jsxs)("p",{className:"utils__margin__bottom--n",children:["DA Score: ",(0,N.fb)(t.da_score)?parseFloat(t.da_score).toFixed(2):null]}),(0,S.jsxs)("p",{className:"utils__margin__bottom--n",children:["Seller: ",t.previous_owner]})]},t.book_address+"-"+t.order_id))})),0===e.length&&e.push((0,S.jsx)("div",{className:"typo__color--n600 utils__d__flex utils__justify__center",children:"No Offers"})),e}()}),(0,S.jsxs)("div",{className:"purchase__wrapper__content__offers__cta",children:[(0,S.jsx)(k.Z,{type:"secondary",onClick:function(){return G(!1)},className:"purchase__wrapper__content__offers__cta__button",children:"Back"}),(0,S.jsx)(k.Z,{type:"primary",onClick:function(){(0,N.fb)(D)?t(D):_((0,w.e1)({show:!0,message:"Please select an old copy.",type:3}))},className:"purchase__wrapper__content__offers__cta__button",children:"Purchase"})]})]}):(0,S.jsxs)("div",{className:"purchase__wrapper__content__options",children:[(0,S.jsxs)("div",{className:"purchase__wrapper__content__options__item",onClick:function(){return a()},children:[(0,S.jsx)("p",{className:"typo__body utils__d__flex typo__align--center",children:"Purchase new copy for"}),(0,S.jsx)("h5",{className:"typo__head typo__head--4 typo__transform--upper utils__d__flex utils__align__center",children:0===s.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:32,height:32,objectFit:"contain"},alt:"USDC"}),"\xa0",parseFloat(s.price).toFixed(2)]})})]}),(0,N.vd)(b)?(0,S.jsxs)("div",{className:"purchase__wrapper__content__options__item",onClick:function(){return G(!0)},children:[(0,S.jsx)("p",{className:"typo__body utils__d__flex typo__align--center",children:"Old copies start from"}),(0,S.jsx)("h5",{className:"typo__head typo__head--4 typo__transform--upper utils__d__flex utils__align__center",children:0===s.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:32,height:32,objectFit:"contain"},alt:"USDC"}),"\xa0",q()]})})]}):(0,S.jsxs)("div",{className:"purchase__wrapper__content__options__item",children:[(0,S.jsx)("p",{className:"typo__body utils__d__flex typo__align--center",children:"No old copies available yet."}),(0,S.jsxs)("h5",{className:"typo__head typo__head--4 typo__transform--upper utils__d__flex utils__align__center",children:["\xa0",(0,S.jsx)(Z.r,{height:32,width:32})]})]})]})})]})})},C=a(7107),F=a(2043),P=a(6026),B=a(7793),G=a(5897),Y=a(3358),M=a(8465),D=a(3653),U=a(116),q=a(6744),I=a(7445),L=a(4998),W=a(8079),z=function(e){var t=[{id:"TAB01",label:"Synopsis",icon:(0,S.jsx)(q.r,{})},{id:"TAB02",label:"reviews",icon:(0,S.jsx)(I.r,{})},{id:"TAB03",label:"quotes",icon:(0,S.jsx)(L.r,{})}],a=(0,h.UO)(),n=(0,u.I0)(),i=(0,h.s0)(),d=(0,B.Z)(),j=(0,u.v9)((function(e){return e.UserState})),O=(0,u.v9)((function(e){return e.WalletState})),Z=(0,p.useState)(null),z=(0,o.Z)(Z,2),H=z[0],K=z[1],V=(0,p.useState)(!1),Q=(0,o.Z)(V,2),J=Q[0],X=Q[1],$=(0,p.useState)("TAB01"),ee=(0,o.Z)($,2),te=ee[0],ae=ee[1],se=(0,p.useState)(null),_e=(0,o.Z)(se,2),oe=_e[0],ne=_e[1],re=(0,p.useState)(null),ie=(0,o.Z)(re,2),ce=ie[0],de=ie[1],le=(0,p.useState)(null),ue=(0,o.Z)(le,2),he=ue[0],pe=ue[1],fe=(0,p.useState)(null),me=(0,o.Z)(fe,2),be=me[0],ke=me[1],ye=(0,p.useState)(null),ve=(0,o.Z)(ye,2),xe=ve[0],je=ve[1],ge=(0,p.useState)(null),we=(0,o.Z)(ge,2),Ne=we[0],Ee=we[1],Re=(0,p.useState)(0),Oe=(0,o.Z)(Re,2),Ze=Oe[0],Te=Oe[1],Se=(0,p.useState)(!1),Ae=(0,o.Z)(Se,2),Ce=Ae[0],Fe=Ae[1],Pe=(0,p.useState)(0),Be=(0,o.Z)(Pe,2),Ge=Be[0],Ye=Be[1],Me=(0,p.useState)(null),De=(0,o.Z)(Me,2),Ue=De[0],qe=De[1],Ie=(0,p.useState)([]),Le=(0,o.Z)(Ie,2),We=Le[0],ze=Le[1],He=(0,p.useState)(0),Ke=(0,o.Z)(He,2),Ve=Ke[0],Qe=Ke[1],Je=(0,p.useState)({title:"",body:"",rating:0}),Xe=(0,o.Z)(Je,2),$e=Xe[0],et=Xe[1],tt=(0,p.useState)(null),at=(0,o.Z)(tt,2),st=at[0],_t=at[1],ot=(0,p.useState)([]),nt=(0,o.Z)(ot,2),rt=nt[0],it=nt[1],ct=(0,p.useState)({quote:""}),dt=(0,o.Z)(ct,2),lt=dt[0],ut=dt[1],ht=(0,p.useState)(0),pt=(0,o.Z)(ht,2),ft=pt[0],mt=pt[1],bt=(0,p.useState)(0),kt=(0,o.Z)(bt,2),yt=kt[0],vt=kt[1],xt=(0,p.useRef)();(0,p.useEffect)((function(){(0,g.Z)("page_view_book")}),[]),(0,p.useEffect)((function(){"TAB01"===te?(0,g.Z)("tab_view_book_synopsis"):"TAB02"===te?(0,g.Z)("tab_view_book_reviews"):(0,g.Z)("tab_view_book_quotes")}),[te]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&pe(1===oe.listed)}),[oe]);var jt=(0,p.useCallback)((function(){(0,N.fb)(oe)&&(X(!0),c()({url:"".concat(T._,"/api/book/reviews"),method:"GET",params:{bookAddress:oe.book_address}}).then((function(e){200===e.status?(ze(e.data.reviews),Ye(e.data.rating),Qe(e.data.total)):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,n]),gt=(0,p.useCallback)((function(){(0,N.fb)(oe)&&(0,N.fb)(H)&&(X(!0),c()({url:"".concat(T._,"/api/book/reviewed"),method:"GET",params:{bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){200===e.status&&(0,N.UE)(e.data)&&qe(e.data)})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,H,n]),wt=(0,p.useCallback)((function(){(0,N.fb)(oe)&&(X(!0),c()({url:"".concat(T._,"/api/book/quotes"),method:"GET",params:{bookAddress:oe.book_address}}).then((function(e){200===e.status?it(e.data):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,n]),Nt=(0,p.useCallback)((function(){(0,N.fb)(oe)&&(0,N.fb)(H)&&(X(!0),c()({url:"".concat(T._,"/api/book/quoted"),method:"GET",params:{bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){200===e.status&&(0,N.UE)(e.data)&&_t(e.data)})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,H,n]);(0,p.useEffect)((function(){jt()}),[jt]),(0,p.useEffect)((function(){gt()}),[gt]),(0,p.useEffect)((function(){wt()}),[wt]),(0,p.useEffect)((function(){Nt()}),[Nt]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&(X(!0),c()({url:"".concat(T._,"/api/book/likes"),method:"GET",params:{bookAddress:oe.book_address}}).then((function(e){200===e.status?Te(e.data.likes):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,n]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&(0,N.fb)(H)&&(X(!0),c()({url:"".concat(T._,"/api/book/liked"),method:"GET",params:{bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){200===e.status&&Fe(e.data.liked)})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,H,n]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&(X(!0),c()({url:"".concat(T._,"/api/reader/count"),method:"GET",params:{bookAddress:oe.book_address}}).then((function(e){200===e.status&&mt(e.data.reader_count)})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,n]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&(X(!0),c()({url:"".concat(T._,"/api/reader/total-read-time"),method:"GET",params:{bookAddress:oe.book_address}}).then((function(e){200===e.status&&vt(e.data.total_read_time)})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}),[oe,n]),(0,p.useEffect)((function(){X(!0),(0,N.fb)(O.wallet.provider)&&K(O.wallet.address),X(!1)}),[O]),(0,p.useEffect)((function(){(0,N.fb)(Ue)&&et({title:Ue.title,body:Ue.body,rating:Ue.rating})}),[Ue]),(0,p.useEffect)((function(){var e=a.bookID;c()({url:"".concat(T._,"/api/book"),method:"GET",params:{id:e}}).then((function(e){ne(e.data[0])}))}),[a]),(0,p.useEffect)((function(){if((0,N.fb)(H)&&(0,N.fb)(oe)){X(!0);var e=oe;e.new_owner===H?de(!0):de(!1),e.publisher_address===H?je(!0):je(!1),c()({url:T._+"/api/book/owner",method:"GET",params:{ownerAddress:H,bookAddress:e.book_address}}).then((function(e){200===e.status&&de(!0)})).catch((function(e){})).finally((function(){return X(!1)}))}}),[oe,a,n,H]),(0,p.useEffect)((function(){(0,N.fb)(oe)&&(0,N.fb)(xe)&&(0,N.fb)(ce)&&X(!1)}),[oe,xe,ce]),(0,p.useEffect)((function(){n(J?(0,E.yh)():(0,E.v3)())}),[J,n]),(0,p.useEffect)((function(){var e=document.getElementById("BOOK_PAGE_"+te);(0,N.fb)(e)&&(0,N.fb)(xt.current)&&xt.current.style.setProperty("--marker-x",e.offsetLeft)}),[te]),(0,p.useEffect)((function(){ce&&c()({url:"".concat(T._,"/api/user/book"),method:"GET",headers:{"user-id":j.user.uid,address:O.wallet.address,authorization:"Bearer ".concat(j.tokens.acsTkn.tkn)},params:{walletAddress:O.wallet.address,bookAddress:oe.book_address}}).then((function(e){200===e.status?(ke(e.data),pe(e.data.listed)):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))}))}),[ce,j,O,n,oe]);var Et=function(){if((0,N.fb)(O.support)&&!0===O.support&&(0,N.fb)(O.wallet.provider))return K(O.wallet.address),!0;X(!0),F.Z.connectWallet().then((function(e){return n((0,P.kH)({wallet:e.wallet,provider:e.provider,signer:e.signer,address:e.address})),K(e.address),n((0,w.e1)({show:!0,message:"Wallet connected.",type:1})),!0})).catch((function(e){return n((0,w.e1)({show:!0,message:"Error while connecting to wallet",type:4})),!1})).finally((function(){return X(!1)}))},Rt=function(){var e=(0,_.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,g.Z)("event_book_read"),X(!0);try{c()({url:"".concat(T._,"/api/verify"),method:"GET",params:{bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){if(200===e.status){var t=e.data;F.Z.signMessage(O.wallet.signer,JSON.stringify(t)).then((function(e){!0===e.isValid?c()({url:T._+"/api/verify",method:"POST",headers:{address:O.wallet.address,"user-id":j.user.uid,authorization:"Bearer ".concat(j.tokens.acsTkn.tkn)},data:{accountAddress:H,bookAddress:oe.book_address,signedData:e.signedData,cid:oe.book.slice(oe.book.lastIndexOf("/")+1)}}).then((function(e){200===e.status?((0,g.Z)("navigate_book_reader"),i("/library/reader",{state:{book:(0,s.Z)((0,s.Z)({},oe),{},{url:e.data.url}),preview:!1}})):n((0,w.e1)({show:!0,message:"Error",type:4}))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})):n((0,w.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else n((0,w.e1)("NOT200"))}))}catch(t){X(!1)}case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,S.jsxs)(f.Z,{children:[(0,S.jsx)("div",{className:"book__bg",children:(0,S.jsx)("img",{src:G.Z,alt:"background",loading:"lazy"})}),(0,N.fb)(oe)?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"book__data",children:[(0,S.jsx)("div",{className:"book__data__background"}),(0,S.jsxs)("div",{className:"book__data__container",children:[(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{className:"book__data__container__cover",children:(0,S.jsx)("img",{className:"book__data__container__cover__image",src:oe.cover_display_url?oe.cover_display_url:oe.cover_public_url?oe.cover_public_url:oe.cover,alt:oe.name})}),(0,S.jsxs)("div",{className:"book__data__container__meta",children:[(0,S.jsx)("h3",{className:"typo__color--n700 typo__head typo__head--3 typo__transform--capital",children:oe.title}),(0,S.jsx)("h5",{className:"typo__color--n500 typo__head typo__head--6 typo__transform--upper",children:oe.author}),ce||xe?null:(0,S.jsx)("div",{className:"book__data__container__meta__price typo-head--6 typo__act typo__color--success",children:0===oe.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",oe.price]})}),(0,S.jsxs)("div",{className:"book__data__container__meta__rating",children:[(0,S.jsx)("div",{className:"book__data__container__meta__rating__stars",children:(0,S.jsx)(b.Z,{size:"small",rating:Ge})}),(0,S.jsxs)("div",{className:"book__data__container__meta__rating__count typo__body",children:[Ve," reviews"]})]}),(0,S.jsx)("div",{className:"book__data__container__meta__cta",children:he?(0,S.jsx)(k.Z,{type:"primary",size:"lg",onClick:function(){return(0,g.Z)("event_book_unlist"),void((0,N.fb)(H)&&(X(!0),c()({url:T._+"/api/user/book/listed",method:"GET",headers:{"user-id":j.user.uid,authorization:"Bearer ".concat(j.tokens.acsTkn.tkn)},params:{ownerAddress:H,tokenId:be.token_id,bookAddress:oe.book_address}}).then((function(e){if(200===e.status){X(!0);var t=e.data.order_id;m.Z.unlistBookFromMarketplace(t,O.wallet.signer).then((function(e){X(!0),c()({url:T._+"/api/book/unlist",method:"POST",data:{ownerAddress:H,bookAddress:oe.book_address}}).then((function(e){200===e.status?(pe(!1),n((0,R.VG)()),n((0,w.e1)({show:!0,message:"Book unlisted from marketplace.",type:1}))):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){X(!1)}))})).catch((function(e){X(!1),(0,N.fb)(e.reason)?e.reason.includes("NFT not yet listed / already sold")&&n((0,w.e1)({show:!0,message:"eBook already sold or not listed.",type:3})):n((0,w.e1)("ERROR"))}))}else n((0,w.e1)("NOT200"))})).catch((function(e){X(!1),n((0,w.e1)("ERROR"))}))))},children:"Unlist"}):xe?(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(k.Z,{type:"primary",size:"lg",onClick:function(){return Rt()},children:"Read"})}):ce?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k.Z,{type:"primary",size:"lg",onClick:function(){return Rt()},children:"Read"}),(0,S.jsx)(k.Z,{onClick:function(){return n((0,R.K4)(R.gG)),void(l()(oe.secondary_sales_from).isSame(l()())||l()(oe.secondary_sales_from).isBefore(l()())?n((0,R.K4)(R.gG)):l()(oe.secondary_sales_from).isAfter(l()())&&n((0,w.e1)({show:!0,message:"Secondary Sales will open only after ".concat(l()(oe.secondary_sales_from).format("D MMM, YYYY"),"."),type:2})))},children:"List"})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k.Z,{type:"primary",size:"lg",onClick:function(){return n(d?(0,R.K4)(R.m0):(0,w.e1)("NOT_LOGGED_IN"))},children:"Buy Now"}),(0,S.jsx)(k.Z,{onClick:function(){return(0,g.Z)("navigate_book_preview"),void i("/book/preview",{state:{book:oe,preview:!0}})},children:"Preview"})]})})]})]}),(0,S.jsxs)("div",{className:"book__data__container__desc",children:[(0,S.jsx)("div",{className:"book__data__container__desc__left",children:(0,S.jsxs)("div",{className:"book__data__container__desc__summary",children:[(0,S.jsxs)("div",{className:"book__data__container__desc__summary__contract",children:[(0,S.jsxs)("div",{className:"book__data__container__desc__summary__contract__data",children:[(0,S.jsx)("div",{className:"book__data__container__desc__summary__contract__label typo__color--n700",children:"Contract Address"}),(0,S.jsxs)("div",{className:"book__data__container__desc__summary__contract__value typo__color--n500",onClick:function(){return window.open("https://mumbai.polygonscan.com/address/".concat(oe.book_address),"_blank")},children:[(oe.book_address||"").slice(0,12),"\u2026",(oe.book_address||"").slice((oe.contract||"").length-10)]})]}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__contract__icon",children:(0,S.jsx)(W.r,{width:24,height:24})})]}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Genres"}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(oe.genres).map((function(e){return(0,S.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})}))}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Prefered Age Group"}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(oe.age_group).map((function(e){return(0,S.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})}))}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Language"}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__data",children:oe.language}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Price"}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__data utils__d__flex utils__align__center",children:0===oe.price?"FREE":(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",oe.price]})}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Published On"}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__data",children:l()(oe.publication_date).add(6,"h").format("D MMM, YYYY")}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Live Readers"}),(0,S.jsxs)("div",{className:"book__data__container__desc__summary__data",children:[ft," people reading"]}),(0,S.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Total Read Time"}),(0,S.jsxs)("div",{className:"book__data__container__desc__summary__data",children:[Math.ceil(yt/60)," minutes"]})]})}),(0,S.jsxs)("div",{className:"book__data__container__desc__right",children:[(0,S.jsxs)("div",{className:"book__data__container__desc__interacts",children:[(0,S.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,S.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Likes"}),(0,S.jsx)(Y.r,{width:24,height:24,className:"book__data__container__desc__interacts__item__icon",stroke:Ce?"#ff5722":"currentColor",fill:Ce?"#ff5722":"transparent",onClick:function(){Et()?ce?(Ce?(Te((function(e){return e-1})),(0,g.Z)("event_book_unlike")):(Te((function(e){return e+1})),(0,g.Z)("event_book_like")),c()({url:"".concat(T._,"/api/book/likes"),method:"POST",data:{bookAddress:oe.book_address,ownerAddress:H,likedState:!Ce}}).then((function(e){200===e.status?Fe((function(e){return!e})):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)}))):n((0,w.e1)({show:!0,message:"Only owners can like a book.",type:3})):n((0,w.e1)({show:!0,message:"Please login first.",type:3}))}}),(0,S.jsx)("div",{className:"typo__head--5 typo__color--n600",children:Ze||"0"})]}),(0,S.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,S.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Reviews"}),(0,S.jsx)(I.r,{width:24,height:24,stroke:"currentColor"}),(0,S.jsx)("div",{className:"typo__head--5 typo__color--n600",children:Ve||"0"})]}),(0,S.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,S.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Pages"}),(0,S.jsx)(M.r,{width:24,height:24,stroke:"currentColor"}),(0,S.jsx)("div",{className:"typo__head--5 typo__color--n600",children:oe.print||"00"})]}),(0,S.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,S.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Sold"}),(0,S.jsx)(U.r,{width:24,height:24,stroke:"currentColor"}),(0,S.jsx)("div",{className:"typo__head--5 typo__color--n600",children:oe.copies||"00"})]})]}),(0,S.jsxs)("div",{className:"book__data__container__desc__tabs",children:[(0,S.jsx)("div",{ref:xt,className:"book__data__container__desc__tabs__container",children:function(){var e=[];return t.forEach((function(t){e.push((0,S.jsxs)("div",{onClick:function(){return ae(t.id)},id:"BOOK_PAGE_"+t.id,className:t.id===te?"book__data__container__desc__tabs__container__item book__data__container__desc__tabs__container__item--active":"book__data__container__desc__tabs__container__item utils__cursor--pointer",children:[(0,N.fb)(t.icon)&&t.icon,(0,S.jsx)("h5",{className:"typo__head typo__head--6 typo__transform--capital",children:t.label})]},t.id))})),e}()}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data",children:function(){switch(te){case"TAB01":return(0,S.jsx)("p",{className:"typo--break-spaces typo__body typo__color--n600",children:oe.synopsis});case"TAB02":return(0,S.jsxs)(p.Fragment,{children:[!(0,N.fb)(Ue)&&ce?(0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,S.jsx)(I.r,{width:32,height:32,stroke:"currentColor"})}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Review"}),(0,S.jsx)(k.Z,{type:"primary",onClick:function(){return n(d?(0,R.K4)(R.wW):(0,w.e1)("NOT_LOGGED_IN"))},children:"Review"})]}):null,(0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews",children:[function(e){var t=[];return(0,N.vd)(e)&&e.forEach((function(e){return t.push((0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item",children:[(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__head typo__head typo__head--6",children:e.title}),(0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header",children:[(0,S.jsx)(b.Z,{rating:e.rating,size:"small"}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__time typo__color--n500",children:l()(e.reviewed_at).format("D MMM, YYYY")})]}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__body typo__body typo__body--2",children:e.body})]}))})),t}(We),0===(null===We||void 0===We?void 0:We.length)?(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Reviews"}):""]})]});case"TAB03":return(0,S.jsxs)(p.Fragment,{children:[(0,N.fb)(st)||!xe&&!ce?null:(0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,S.jsx)(L.r,{width:32,height:32,stroke:"currentColor"})}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Quote"}),(0,S.jsx)(k.Z,{type:"primary",onClick:function(){return n(d?(0,R.K4)(R.D4):(0,w.e1)("NOT_LOGGED_IN"))},children:"Quote"})]}),(0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes",children:[function(e){var t=[];return e.forEach((function(e,a){t.push((0,S.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes__item",children:[(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__icon",children:(0,S.jsx)(D.r,{width:32,height:32,fill:"currentColor"})}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__body typo__body",children:e.body}),(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__time typo__cap typo__cap--2",children:l()(e.created_at).format("D MMM, YYYY")||"-"})]},a))})),t}(rt),0===(null===rt||void 0===rt?void 0:rt.length)?(0,S.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Quotes"}):""]})]})}}()})]})]})]})]})]}),(0,S.jsx)(A,{data:oe,onNewBookPurchase:function(){return(0,g.Z)("event_book_purchase_new"),X(!0),void((0,N.fb)(H)?m.Z.purchaseNft(H,oe.book_address,oe.price.toString(),O.wallet.signer).then((function(e){n((0,w.e1)({show:!0,message:"Book purchased.",type:1})),n((0,R.VG)());var t=Number(e.events.filter((function(e){return"Transfer(address,address,uint256)"===e.eventSignature}))[0].args[2]._hex);c()({url:T._+"/api/book/purchase",method:"POST",data:{ownerAddress:H,bookAddress:oe.book_address,tokenId:t,purchasePrice:oe.price}}).then((function(e){200===e.status?de(!0):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})),c()({url:T._+"/api/book/copies",method:"POST",data:{bookAddress:oe.book_address,copies:t}}).then((function(e){200!==e.status&&n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))}))})).catch((function(e){var t,a;X(!1),e.message?(null===e||void 0===e||null===(t=e.message)||void 0===t?void 0:t.indexOf("execution reverted: ERC20: transfer amount exceeds balance"))>-1?n((0,w.e1)({show:!0,message:"You do not have enough USDC to purchase this book. Please visit the faucet to get some.",type:3})):(null===e||void 0===e||null===(a=e.message)||void 0===a?void 0:a.indexOf("execution reverted: NalndaBook: Book unapproved from marketplace!"))>-1?n((0,w.e1)({show:!0,message:"The book has not been approved for sales yet. Please try again later.",type:3})):4001===e.code&&n((0,w.e1)({show:!0,message:"Transaction denied by user.",type:3})):n((0,w.e1)("ERROR"))})):n((0,w.e1)({show:!0,message:"Please connect your WEB3 wallet.",type:3})))},onOldBookPurchase:function(e){return function(e){(0,g.Z)("event_book_purchase_old"),Et()&&(X(!0),m.Z.buyListedCover(e.order_id,e.price,O.wallet.signer).then((function(t){c()({url:T._+"/api/book/purchase/secondary",method:"POST",data:{newOwnerAddress:H,previousOwnerAddress:e.previous_owner,bookAddress:e.book_address,tokenId:e.token_id,purchasePrice:e.price,orderId:e.order_id,daScore:e.da_score}}).then((function(e){200===e.status?(n((0,R.VG)()),de(!0)):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)}))})).catch((function(e){X(!1)})))}(e)}}),(0,S.jsx)(y.Z,{book:oe,userCopy:be,onListHandler:function(e){return function(e){(0,g.Z)("event_book_list"),(0,N.fb)(H)&&(X(!0),m.Z.listBookToMarketplace(oe.book_address,be.token_id,e,O.wallet.signer).then((function(t){X(!0);var a=parseInt(t.events.filter((function(e){return"CoverListed"===e.event}))[0].args[0]._hex);c()({url:T._+"/api/book/list",method:"POST",data:{ownerAddress:H,bookAddress:oe.book_address,bookPrice:e,bookOrderId:a,bookTokenId:be.token_id}}).then((function(e){200===e.status?(pe(!0),n((0,R.VG)()),n((0,w.e1)({show:!0,message:"Book listed on marketplace.",type:1})),e.data&&(Ee(e.data),n((0,R.K4)(R.Sh)))):n((0,w.e1)("NOT200"))})).catch((function(e){n((0,w.e1)("ERROR"))})).finally((function(){X(!1)}))})).catch((function(e){(0,N.fb)(e.reason)?e.reason.includes("Can't list the cover at this time")?n((0,w.e1)({show:!0,message:"Please wait for some more time before listing the book.",type:3})):e.reason.includes("Listing for this book is disabled")?n((0,w.e1)({show:!0,message:"Listing this book is not allowed right now. Please try again later.",type:3})):e.reason.includes("Seller should own the NFT to list")&&n((0,w.e1)({show:!0,message:"Book is already listed. Please contact us on support@nalnda.com",type:3})):n((0,w.e1)("ERROR"))})).finally((function(){return X(!1)})))}(e)}}),(0,S.jsx)(x.Z,{ReviewForm:$e,setReviewForm:et,reviewHandler:function(){(0,g.Z)("event_book_review"),(0,N.fb)(H)?(0,N.UE)($e.body)&&(0,N.UE)($e.rating)&&(0,N.UE)($e.title)?(X(!0),c()({url:"".concat(T._,"/api/book/reviews"),method:"POST",data:{review:(0,s.Z)({},$e),bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){200===e.status?(n((0,R.VG)()),gt(),jt()):n((0,w.e1)("NOT200"))})).catch((function(e){X(!1),n((0,w.e1)("ERROR"))}))):n((0,w.e1)({show:!0,message:"Please fill the review.",type:3})):n((0,w.e1)({show:!0,message:"Please login first",type:3}))}}),(0,S.jsx)(v.Z,{QuotesForm:lt,setQuotesForm:ut,quoteHandler:function(){(0,g.Z)("event_book_quote"),(0,N.fb)(H)?(0,N.UE)(lt.quote)?(X(!0),c()({url:"".concat(T._,"/api/book/quotes"),method:"POST",data:{quote:{body:lt.quote},bookAddress:oe.book_address,ownerAddress:H}}).then((function(e){200===e.status?(n((0,R.VG)()),Nt(),wt()):n((0,w.e1)("NOT200"))})).catch((function(e){X(!1),n((0,w.e1)("ERROR"))}))):n((0,w.e1)({show:!0,message:"Please enter the quote.",type:3})):n((0,w.e1)({show:!0,message:"Please login first",type:3}))}}),(0,S.jsx)(C.Z,{bookID:Ne})]}):null]})}}}]);
//# sourceMappingURL=821.56935510.chunk.js.map