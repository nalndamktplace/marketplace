"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[839],{7269:function(e,t,n){n.d(t,{r:function(){return u}});var r,a=n(2791),o=["title","titleId"];function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function c(e,t){var n=e.title,c=e.titleId,u=i(e,o);return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":c},u),n?a.createElement("title",{id:c},n):null,r||(r=a.createElement("path",{d:"M21,6,9,18,21,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}var u=a.forwardRef(c);n.p},2623:function(e,t,n){n.d(t,{r:function(){return u}});var r,a=n(2791),o=["title","titleId"];function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function c(e,t){var n=e.title,c=e.titleId,u=i(e,o);return a.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":c},u),n?a.createElement("title",{id:c},n):null,r||(r=a.createElement("path",{d:"M9,6,21,18,9,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}var u=a.forwardRef(c);n.p},1536:function(e,t,n){n(5454),n(7269),n(2623),n(184);t.Z=function(e){e.max,e.current,e.onPageChange;return null}},9839:function(e,t,n){n.r(t);var r=n(1413),a=n(5861),o=n(2982),s=n(885),i=n(7757),c=n.n(i),u=n(4569),l=n.n(u),d=n(6030),f=n(6871),_=n(2791),h=n(2043),p=n(6026),b=n(4643),v=n(9316),y=n(4127),k=n(8979),m=n(5454),g=n(1536),w=n(354),x=n(5248),j=n(639),O=n(6759),Z=n(3930),E=n(5602),N=n(906),S=n(5899),R=n(184);t.default=function(e){var t=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"},{key:"decayscore",value:null,type:"range"}],n=(0,f.TH)(),i=(0,f.s0)(),u=(0,d.I0)(),I=(0,d.v9)((function(e){return e.UserState})),P=(0,d.v9)((function(e){return e.WalletState})),C=(0,_.useState)([]),T=(0,s.Z)(C,2),L=T[0],A=T[1],G=(0,_.useState)([]),H=(0,s.Z)(G,2),M=H[0],W=H[1],B=(0,_.useState)(t),D=(0,s.Z)(B,2),z=D[0],F=D[1],U=(0,_.useState)(!1),q=(0,s.Z)(U,2),J=q[0],K=q[1],V=(0,_.useState)(0),Y=(0,s.Z)(V,2),Q=Y[0],X=Y[1],$=(0,_.useState)(null),ee=(0,s.Z)($,2),te=ee[0],ne=ee[1],re=(0,_.useState)(!1),ae=(0,s.Z)(re,2),oe=ae[0],se=ae[1],ie=(0,_.useState)(window.innerWidth<600?"LIST":"GRID"),ce=(0,s.Z)(ie,2),ue=ce[0],le=ce[1],de=(0,_.useState)(1),fe=(0,s.Z)(de,2),_e=fe[0],he=fe[1],pe=(0,_.useState)(10),be=(0,s.Z)(pe,2),ve=be[0],ye=(be[1],(0,_.useState)(100)),ke=(0,s.Z)(ye,2),me=ke[0],ge=ke[1];(0,_.useEffect)((function(){(0,S.Z)("page_view_account")}),[]),(0,_.useEffect)((function(){0===Q?(0,S.Z)("tab_view_account_owned"):(0,S.Z)("tab_view_account_published")}),[Q]);var we=(0,_.useCallback)((function(){h.Z.connectWallet().then((function(e){u((0,p.kH)({wallet:e.wallet,provider:e.provider,signer:e.signer,address:e.address}))})).catch((function(e){u((0,b.e1)({show:!0,message:"Error while connecting to wallet",type:4}))})).finally((function(){return K(!1)}))}),[u]);(0,_.useEffect)((function(){(0,S.Z)("event_library_filter");var e=M;(0,v.fb)(e)&&(z.forEach((function(t){switch(t.type){case"range":(0,v.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,v.vd)(t.value)){var n=[];t.value.forEach((function(r){return e.forEach((function(e){e[t.key].indexOf(r)>-1&&n.filter((function(t){return t.id===e.id})).length<1&&n.push(e)}))})),e=n}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),A(e))}),[z,M]),(0,_.useEffect)((function(){if((0,v.fb)(n.state)){var e=n.state.tab;X("published"===e?1:0)}}),[n]),(0,_.useEffect)((function(){K(!0),(0,v.fb)(P.wallet.provider)?ne(P.wallet.address):we(),K(!1)}),[P,we]),(0,_.useEffect)((function(){u(J?(0,y.yh)():(0,y.v3)())}),[J,u]),(0,_.useEffect)((function(){(0,v.Pc)(I)&&(K(!0),0===Q?l()({url:x._+"/api/user/books/owned",method:"GET",headers:{"user-id":I.user.uid,authorization:"Bearer ".concat(I.tokens.acsTkn.tkn)},params:{userAddress:te}}).then((function(e){200===e.status?W(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return K(!1)})):1===Q&&l()({url:x._+"/api/user/books/published",method:"GET",headers:{"user-id":I.user.uid,authorization:"Bearer ".concat(I.tokens.acsTkn.tkn)},params:{userAddress:te}}).then((function(e){200===e.status?W(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return K(!1)})))}),[Q,te,u,I]),(0,_.useEffect)((function(){if((0,v.vd)(M)){var e=Math.max.apply(Math,(0,o.Z)(M.map((function(e){return e.price}))));e=10*Math.ceil(e/10),ge(e||100)}}),[M]);var xe=function(){var e=(0,a.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:K(!0);try{l()({url:"".concat(x._,"/api/verify"),method:"GET",params:{bookAddress:t.book_address,ownerAddress:te}}).then((function(e){if(200===e.status){var n=e.data;h.Z.signMessage(P.wallet.signer,JSON.stringify(n)).then((function(e){!0===e.isValid?l()({url:x._+"/api/verify",method:"POST",data:{accountAddress:te,bookAddress:t.book_address,signedData:e.signedData,cid:t.book.slice(t.book.lastIndexOf("/")+1)}}).then((function(e){200===e.status?((0,S.Z)("navigate_book_reader"),i("/library/reader",{state:{book:(0,r.Z)((0,r.Z)({},t),{},{submarineURL:e.data.url}),preview:!1}})):u((0,b.e1)({show:!0,message:"Error",type:4}))})).catch((function(e){})).finally((function(){return K(!1)})):u((0,b.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else u((0,b.e1)("NOT200"))}))}catch(n){K(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,R.jsx)(k.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,R.jsxs)("div",{className:"account__data",children:[(0,R.jsx)("div",{className:"account__data__filter-panel-container","data-filter-open":oe,children:(0,R.jsx)(w.Z,{maxPrice:me,setFiltersPanelOpen:se,config:j.K,defaults:t,filters:z,setFilters:F})}),(0,R.jsxs)("div",{className:"account__data__books","data-filter-open":oe,children:[(0,R.jsxs)("div",{className:"account__data__books__header",children:[(0,R.jsxs)("div",{className:"account__data__books__header__filter",children:[(0,R.jsx)(m.Z,{type:"icon",onClick:function(){return se((function(e){return!e}))},children:(0,R.jsx)(Z.r,{fill:oe?"currentColor":"transparent"})}),(0,R.jsxs)("div",{className:"account__data__books__header__filter__tabs",children:[(0,R.jsx)("div",{onClick:function(){return X(0)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":0===Q,children:"Library"}),(0,R.jsx)("div",{onClick:function(){return X(1)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":1===Q,children:"Published"})]})]}),(0,R.jsxs)("div",{className:"account__data__books__header__layout",children:[(0,R.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return le("LIST")},children:[(0,R.jsx)(N.r,{}),(0,R.jsx)("span",{children:"List"})]}),(0,R.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return le("GRID")},children:[(0,R.jsx)(E.r,{}),(0,R.jsx)("span",{children:"GRID"})]})]})]}),(0,R.jsxs)("div",{className:"account__data__books__wrapper","data-layout":ue,children:[(0,v.fb)(L)&&L.length>0?function(){var e=[];return L.forEach((function(t){e.push((0,R.jsx)(O.Z,{state:t.publisher_address===te?"publisher":"owned",layout:ue,book:t,onRead:function(){return xe(t)},onOpen:function(){return function(e){(0,S.Z)("navigate_account_book"),i("/book",{state:e})}(t)}},t.id))})),e}():(0,R.jsxs)("div",{className:"account__data__books__wrapper__empty",children:[(0,R.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"account__data__books__wrapper__image",loading:"lazy"}),(0,R.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]}),(0,R.jsx)("div",{className:"account__data__books__wrapper__pagination",children:(0,R.jsx)(g.Z,{max:ve,current:_e,onPageChange:function(e){return he(e)}})})]})]})]})})}}}]);
//# sourceMappingURL=839.b9d65438.chunk.js.map