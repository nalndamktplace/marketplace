"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[696],{14998:(e,t,r)=>{r.d(t,{r:()=>f});var n,o,a,i,s,l,c=r(72791);function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}function u(e,t){let{title:r,titleId:u,...f}=e;return c.createElement("svg",d({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":u},f),r?c.createElement("title",{id:u},r):null,n||(n=c.createElement("path",{d:"M6,15H36",transform:"translate(6 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),o||(o=c.createElement("path",{d:"M36,19H6",transform:"translate(6 19)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),a||(a=c.createElement("path",{d:"M15,11H27",transform:"translate(15 11)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),i||(i=c.createElement("path",{d:"M27,7H15",transform:"translate(15 7)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),s||(s=c.createElement("path",{d:"M9,12.5h2a2,2,0,1,1-2,2v-5a4,4,0,0,1,4-4",transform:"translate(9 5.5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),l||(l=c.createElement("path",{d:"M3,12.5H5a2,2,0,1,1-2,2v-5a4,4,0,0,1,4-4",transform:"translate(3 5.5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const f=c.forwardRef(u);r.p},67696:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Tt});var n=r(16030),o=r(16871),a=r(72791),i=r(54270),s=r(4343);const l=function(e,t){const[r,n]=(0,a.useState)(e);return(0,a.useEffect)((()=>{const r=setTimeout((()=>{n(e)}),t);return()=>{clearTimeout(r)}}),[e,t]),r};var c=r(75454),d=r(74569),u=r.n(d),f=r(65248),h=r(29316);const _=e=>{var t=parseInt(e,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map((e=>e<10?"0"+e:e)).filter(((e,t)=>"00"!==e||t>0)).join(":")};var m,p,v=r(44643);function k(){return k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},k.apply(this,arguments)}function b(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,m||(m=a.createElement("circle",{cx:18,cy:18,r:18,transform:"translate(6 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),p||(p=a.createElement("path",{d:"M12,7V17l6,6",transform:"translate(12 7)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const g=a.forwardRef(b);r.p;var w=r(32669),x=r(80184);const y=e=>{let{timerUpdate:t,mobileView:r,bookMeta:i,preview:s}=e;const l=(0,n.v9)((e=>e.UserState)),c=(0,n.v9)((e=>e.BWalletState)),[d,m]=(0,a.useState)(0),[p,k]=(0,a.useState)(0),[b,y]=(0,a.useState)(null),j=(0,w.Z)(),E=(0,n.I0)(),N=(0,o.s0)();return(0,a.useEffect)((()=>{(0,h.fb)(r)&&!1!==r||(0,h.fb)(s)&&!s&&((0,h.fb)(j.getAddress())?y(j.getAddress()):N(-1))}),[r,c,N,s]),(0,a.useEffect)((()=>{!s&&(0,h.fb)(i)&&((0,h.fb)(b)||(0,h.fb)(r)&&!0===r)&&u()({url:`${f._}/api/reader/read-time`,method:"GET",headers:{address:b,"user-id":l.user.uid,authorization:`Bearer ${l.tokens.acsTkn.tkn}`},params:{bookAddress:i.book_address}}).then((e=>{200===e.status&&(m(e.data.read_time),k(e.data.read_time))})).catch((e=>{E((0,v.e1)("ERROR"))}))}),[r,i,E,b,s,l]),(0,a.useEffect)((()=>{if(!(0,h.fb)(i)&&!(0,h.fb)(b)&&!(0,h.fb)(r)&&!0!==r)return;let e=setInterval((()=>{t&&m((e=>e+1))}),1e3);return()=>{clearInterval(e)}}),[t,r,i,b]),(0,a.useEffect)((()=>{if(!s){const e=d;e-p>10&&u()({url:`${f._}/api/reader/read-time`,method:"PUT",headers:{address:b,"user-id":l.user.uid,authorization:`Bearer ${l.tokens.acsTkn.tkn}`},data:{bookAddress:i.book_address,readTime:e}}).then((e=>{200===e.status&&k(e.data.read_time)})).catch((e=>{E((0,v.e1)("ERROR"))}))}}),[i,d,b,p,E,s,l]),(0,x.jsxs)("div",{className:"readtime",children:[(0,x.jsx)(g,{width:"3rem",height:"3rem",stroke:"currentColor"}),(0,x.jsx)("div",{className:"readtime__time",children:_(d)})]})};var j=r(9135);const E=e=>{let{show:t=!1,setShow:r=(()=>{}),position:n="right",title:o="",children:a}=e;return(0,x.jsxs)("div",{className:(()=>{let e=["sidepanel"];return!0===t&&e.push("sidepanel--open"),e.push(`sidepanel--${n}`),e.join(" ")})(),children:[(0,x.jsxs)("div",{className:"sidepanel__header",children:[(0,x.jsx)("div",{className:"sidepanel__header__close-btn",children:(0,x.jsx)(c.Z,{type:"icon",onClick:()=>r(!1),children:(0,x.jsx)(j.r,{width:24,height:24,stroke:"currentColor"})})}),(0,x.jsx)("div",{className:"sidepanel__header__title typo__head--6",children:o})]}),(0,x.jsx)("div",{className:"sidepanel__body",children:a})]})};var N=r(95899);const L={fontSize:{min:100,max:250,step:10,offset:50},lineHeight:{min:1,max:2,step:.25},fontFamily:[{id:"reader-font-family-arial",name:"Arial",value:"'Arial', sans-serif"},{id:"reader-font-family-times",name:"Times",value:"'Times New Roman', serif"},{id:"reader-font-family-trebuchet",name:"Trebuchet",value:"'Trebuchet MS', sans-serif"}],themes:[{id:"reader-theme-light",name:"Light",backgroundColor:"white",color:"black",bodyTheme:"light"},{id:"reader-theme-dark",name:"Dark",backgroundColor:"black",color:"white",bodyTheme:"dark"}]},S={fontSize:170,lineHeight:1.6,fontFamily:L.fontFamily.find((e=>"reader-font-family-arial"===e.id)),theme:L.themes.find((e=>"reader-theme-light"===e.id))},O={body:{"--font-family":S.fontFamily.value,"--font-size":S.fontSize+"%","--line-height":S.lineHeight,"--background-color":S.theme.backgroundColor,"--color":S.theme.color,"background-color":"var(--background-color) !important",color:"var(--color) !important","font-size":"var(--font-size) !important"},p:{"text-align":"justify","font-family":"var(--font-family) !important","line-height":"var(--line-height) !important"}};var R,C;function z(){return z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},z.apply(this,arguments)}function M(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",z({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,R||(R=a.createElement("line",{y2:28,transform:"translate(24 10)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),C||(C=a.createElement("line",{x2:28,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const q=a.forwardRef(M);r.p;var W;function I(){return I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},I.apply(this,arguments)}function T(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",I({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,W||(W=a.createElement("line",{x2:28,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Z=a.forwardRef(T),A=(r.p,e=>{let{value:t=0,setValue:r=(()=>{}),unit:n="",min:o=0,max:a=100,step:i=1,offset:s=0}=e;return(0,x.jsxs)("div",{className:"number-input",children:[(0,x.jsx)("div",{className:"number-input__button",onClick:()=>{r(Math.max(o,t-i))},children:(0,x.jsx)(Z,{width:24,stroke:"currentColor"})}),(0,x.jsxs)("div",{className:"number-input__value",children:[t-s,n]}),(0,x.jsx)("div",{className:"number-input__button",onClick:()=>{r(Math.min(a,t+i))},children:(0,x.jsx)(q,{width:24,stroke:"currentColor"})})]})}),F=e=>{let{rendition:t}=e;const[r,n]=(0,a.useState)({...S,fontFamily:S.fontFamily.id,theme:S.theme.id}),o=(0,a.useCallback)((()=>{try{let e=t.currentLocation();t.clear(),t.display(e.start.cfi)}catch(e){}}),[t]);(0,a.useEffect)((()=>{let{fontSize:e=S.fontSize,lineHeight:t=S.lineHeight,fontFamily:r=S.fontFamily.id,theme:o=S.theme.id}=(()=>{if(!window.localStorage)return{};try{return JSON.parse(window.localStorage.getItem("READER_PREFERENCES"))||{}}catch(e){return{}}})();n({fontSize:e,lineHeight:t,fontFamily:r,theme:o})}),[]),(0,a.useEffect)((()=>{if(!(0,h.fb)(t))return;let e=L.themes.find((e=>e.id===r.theme)),n=L.fontFamily.find((e=>e.id===r.fontFamily));(0,h.fb)(e)||(e=L.themes[0]),(0,h.fb)(n)||(n=L.fontFamily[0]),t.themes.override("--font-size",r.fontSize+"%"),t.themes.override("--font-family",n.value),t.themes.override("--line-height",r.lineHeight),t.themes.override("--background-color",e.backgroundColor),t.themes.override("--color",e.color),window.document.body.setAttribute("data-theme",e.bodyTheme),o(),(e=>{window.localStorage&&window.localStorage.setItem("READER_PREFERENCES",JSON.stringify(e))})(r)}),[r,t,o]);return(0,x.jsxs)("div",{className:"panel panel__customizer",children:[(0,x.jsxs)("div",{className:"panel__customizer__field",children:[(0,x.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Font Size"}),(0,x.jsx)("div",{className:"panel__customizer__field__input",children:(0,x.jsx)(A,{value:r.fontSize,setValue:e=>{(0,N.Z)("event_customizer_fontsize_"+e),n((t=>({...t,fontSize:e})))},unit:"%",offset:L.fontSize.offset,min:L.fontSize.min,max:L.fontSize.max,step:L.fontSize.step})})]}),(0,x.jsxs)("div",{className:"panel__customizer__field",children:[(0,x.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Line Spacing"}),(0,x.jsx)("div",{className:"panel__customizer__field__input",children:(0,x.jsx)(A,{value:r.lineHeight,setValue:e=>{(0,N.Z)("event_customizer_lineheight_"+e),n((t=>({...t,lineHeight:e})))},min:L.lineHeight.min,max:L.lineHeight.max,step:L.lineHeight.step})})]}),(0,x.jsxs)("div",{className:"panel__customizer__field",children:[(0,x.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Themes"}),(0,x.jsx)("div",{className:"panel__customizer__field__input panel__customizer__field__input--themes",children:L.themes.map((e=>(0,x.jsx)("div",{className:"panel__customizer__field__input__chip"+(r.theme===e.id?" panel__customizer__field__input__chip--selected":""),onClick:()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reader-theme-light";(0,N.Z)("event_customizer_theme_"+e),n((t=>({...t,theme:e})))}(e.id),style:{color:e.color,backgroundColor:e.backgroundColor},children:"Aa"},e.id)))})]}),(0,x.jsxs)("div",{className:"panel__customizer__field",children:[(0,x.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Fonts"}),(0,x.jsx)("div",{className:"panel__customizer__field__input panel__customizer__field__input--fonts",children:L.fontFamily.map((e=>(0,x.jsxs)("div",{className:"panel__customizer__field__input__font"+(r.fontFamily===e.id?" panel__customizer__field__input__font--selected":""),style:{fontFamily:e.value},onClick:()=>{var t;t=e.id,(0,N.Z)("event_customizer_font_"+t),n((e=>({...e,fontFamily:t})))},children:[(0,x.jsx)("div",{className:"panel__customizer__field__input__font__demo",children:"Aa"}),(0,x.jsx)("div",{className:"panel__customizer__field__input__font__name",children:e.name})]},e.id)))})]})]})};var P=r(4127);const H=e=>{let{mobileView:t,preview:r,rendition:i,bookMeta:s,addAnnotationRef:l,onRemove:d=(()=>{}),hideModal:_=(()=>{})}=e;const m=(0,w.Z)(),p=(0,n.I0)(),k=(0,o.s0)(),[b,g]=(0,a.useState)(null),[y,j]=(0,a.useState)(!1),[E,L]=(0,a.useState)([]);(0,a.useEffect)((()=>{p(y?(0,P.yh)():(0,P.v3)())}),[y,p]),(0,a.useEffect)((()=>{(0,h.fb)(t)&&!1!==t||(0,h.fb)(r)&&!r&&((0,h.fb)(m.getAddress())?g(m.getAddress()):k(-1))}),[k,r,t]),(0,a.useEffect)((()=>{(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)&&(j(!0),u()({url:`${f._}/api/reader/annotations`,method:"GET",params:{bookAddress:s.book_address,ownerAddress:b}}).then((e=>{if(200===e.status){let t=JSON.parse(e.data.annotations)||[];L(t),t.forEach((e=>{i.annotations.add("highlight",e.cfiRange,{},(()=>{}),"",{fill:e.color,"fill-opacity":"0.35","mix-blend-mode":"multiply"})}))}else p((0,v.e1)("NOT200"))})).catch((e=>{p((0,v.e1)("ERROR"))})).finally((()=>j(!1))))}),[s,b,p,i,r]);const S=(e,t)=>{if((0,N.Z)("event_annotationpanel_remove"),(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)){if(!(0,h.fb)(i))return;if(!(0,h.fb)(s))return;j(!0);let r=E.filter(((t,r)=>r!==e));u()({url:`${f._}/api/reader/annotations`,method:"POST",data:{bookAddress:s.book_address,ownerAddress:b,annotations:JSON.stringify(r)}}).then((e=>{200===e.status?(L(r),i.annotations.remove(t.cfiRange,"highlight"),d()):p((0,v.e1)("NOT200"))})).catch((e=>{p((0,v.e1)("ERROR"))})).finally((()=>j(!1)))}},O=e=>{(0,N.Z)("event_annotationpanel_goto_page"),(0,h.fb)(i)&&(i.display(e),i.display(e),_())},R=(0,a.useCallback)((e=>{if((0,N.Z)("event_annotationpanel_annotate"),(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)){if(!(0,h.fb)(i))return;if(!(0,h.fb)(s))return;j(!0);let t=[...E,e];u()({url:`${f._}/api/reader/annotations`,method:"POST",data:{bookAddress:s.book_address,ownerAddress:b,annotations:JSON.stringify(t)}}).then((r=>{200===r.status?(L(t),i.annotations.add("highlight",e.cfiRange,{},(()=>{}),"",{fill:e.color,"fill-opacity":"0.35","mix-blend-mode":"multiply"})):p((0,v.e1)("NOT200"))})).catch((e=>{p((0,v.e1)("ERROR"))})).finally((()=>j(!1)))}}),[E,b,s,p,i,r]);return(0,a.useEffect)((()=>{l.current=R}),[l,R]),(0,x.jsxs)("div",{className:"panel panel__annotation",children:[" ",(()=>{let e=[];return(0,h.fb)(i)&&(0,h.fb)(s)?(E.forEach(((t,r)=>{e.push((0,x.jsxs)("div",{className:"panel__annotation__item",onClick:()=>O(t.cfiRange),children:[(0,x.jsxs)("div",{className:"panel__annotation__item__container",children:[(0,x.jsx)("div",{className:"panel__annotation__item__color",style:{backgroundColor:t.color}}),(0,x.jsx)("div",{className:"panel__annotation__item__name",children:t.text})]}),(0,x.jsx)(c.Z,{size:"sm",type:"icon",onClick:e=>{e.stopPropagation(),S(r,t)},children:"remove"})]},r))})),0===e.length&&e.push((0,x.jsx)("div",{className:"panel__empty",children:"No Items"},"empty")),e):""})()," "]})};var $,B,V=r(72426),D=r.n(V);function J(){return J=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},J.apply(this,arguments)}function U(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",J({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-message-circle-2",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,$||($=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),B||(B=a.createElement("path",{d:"M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1"})))}const G=a.forwardRef(U);r.p;var Y,Q,K=r(39362);function X(){return X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},X.apply(this,arguments)}function ee(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",X({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-thumb-up",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Y||(Y=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),Q||(Q=a.createElement("path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3"})))}const te=a.forwardRef(ee);r.p;var re,ne;function oe(){return oe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oe.apply(this,arguments)}function ae(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",oe({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-thumb-down",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,re||(re=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),ne||(ne=a.createElement("path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3"})))}const ie=a.forwardRef(ae);r.p;var se,le,ce;function de(){return de=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},de.apply(this,arguments)}function ue(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-send",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,se||(se=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),le||(le=a.createElement("line",{x1:10,y1:14,x2:21,y2:3})),ce||(ce=a.createElement("path",{d:"M21 3l-6.5 18a0.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a0.55 .55 0 0 1 0 -1l18 -6.5"})))}const fe=a.forwardRef(ue);r.p;var he,_e,me,pe,ve;function ke(){return ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ke.apply(this,arguments)}function be(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",ke({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-up-circle",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,he||(he=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),_e||(_e=a.createElement("circle",{cx:12,cy:12,r:9})),me||(me=a.createElement("line",{x1:12,y1:8,x2:8,y2:12})),pe||(pe=a.createElement("line",{x1:12,y1:8,x2:12,y2:16})),ve||(ve=a.createElement("line",{x1:16,y1:12,x2:12,y2:8})))}const ge=a.forwardRef(be);r.p;var we,xe,ye,je,Ee;function Ne(){return Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ne.apply(this,arguments)}function Le(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Ne({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-down-circle",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,we||(we=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),xe||(xe=a.createElement("circle",{cx:12,cy:12,r:9})),ye||(ye=a.createElement("line",{x1:8,y1:12,x2:12,y2:16})),je||(je=a.createElement("line",{x1:12,y1:8,x2:12,y2:16})),Ee||(Ee=a.createElement("line",{x1:16,y1:12,x2:12,y2:16})))}const Se=a.forwardRef(Le),Oe=(r.p,e=>{let{quote:t,bookMeta:r,UserState:o,preview:i,rendition:s,hideModal:l}=e;const c=(0,n.I0)(),[d,_]=(0,a.useState)(!1),[m,p]=(0,a.useState)(""),[k,b]=(0,a.useState)([]);(0,a.useEffect)((()=>{u()({url:`${f._}/api/book/quotes/comments`,method:"GET",params:{bookAddress:r.book_address,quoteId:t.book_id}}).then((e=>{200===e.status?b(e.data):204===e.status||c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))}))}),[r,c,s,i,t]);const g=e=>{let t=[];return e.forEach(((e,r)=>{t.push((0,x.jsxs)("div",{className:"quotes__comments__thread",children:[(0,x.jsxs)("div",{className:"quotes__comments__icon",children:[(0,x.jsx)(K.r,{width:22,height:24,stroke:"currentColor"}),(0,x.jsx)("div",{className:"quotes__comments__text",children:e.uid})]}),(0,x.jsx)("div",{className:"quotes__comments__body typo__body",children:e.comment})]},r))})),t};return(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"quotes__item",onClick:()=>{return e=t.cfi_range,(0,N.Z)("event_annotationpanel_goto_page"),void((0,h.fb)(s)&&(s.display(e),s.display(e),l()));var e},children:[(0,x.jsx)("div",{className:"quotes__item__body typo__body",children:t.body}),(0,x.jsx)("div",{className:"quotes__item__time typo__cap typo__cap--2",children:D()(t.created_at).format("D MMM, YYYY")||"-"})]}),(0,x.jsx)("div",{className:"quotes__item__section"}),(0,x.jsxs)("div",{className:"quotes__item__section__icons",children:[(0,x.jsxs)("div",{className:"quotes__item__section__icon__action",children:[" ",(0,x.jsx)(G,{onClick:()=>_(!d),height:24,width:24}),k.length]}),(0,x.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,x.jsx)(ge,{height:24,width:24})}),(0,x.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,x.jsx)(Se,{height:24,width:24})})]}),d?(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"quotes__item__section__comment-div",children:[(0,x.jsx)("input",{value:m,onChange:e=>p(e.target.value),className:"quotes__item__section__comment-div__input",type:"text",placeholder:"Add a comment..."}),(0,x.jsx)("div",{className:"quotes__item__section__comment-div__action",children:(0,x.jsx)(fe,{onClick:()=>{m.length>2&&u()({url:`${f._}/api/book/quotes/comments`,method:"POST",headers:{"user-id":o.user.uid},data:{bookAddress:r.book_address,quoteId:t.book_id,comment:m}}).then((e=>{200===e.status?u()({url:`${f._}/api/book/quotes/comments`,method:"GET",params:{bookAddress:r.book_address,quoteId:t.book_id}}).then((e=>{200===e.status?(b(e.data),p("")):204===e.status||c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))})):c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))}))}})})]}),(()=>{let e=[];return k.forEach(((t,r)=>{e.push((0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"quotes__comments",children:[(0,x.jsxs)("div",{className:"quotes__comments__icon",children:[(0,x.jsx)(K.r,{width:22,height:24,stroke:"currentColor"}),(0,x.jsx)("div",{className:"quotes__comments__text",children:t.uid})]}),(0,x.jsx)("div",{className:"quotes__comments__body typo__body",children:t.comment})]},r),(0,x.jsxs)("div",{className:"quotes__item__section__icons",children:[(0,x.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,x.jsx)(te,{height:24,width:24})}),(0,x.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,x.jsx)(ie,{height:24,width:24})})]}),t.thread?g(t.thread):null]}))})),e})()]}):null]})}),Re=e=>{let{setDiscCount:t,mobileView:r,preview:i,rendition:s,bookMeta:l,hideModal:d=(()=>{})}=e;const _=(0,w.Z)(),m=(0,n.I0)(),p=(0,o.s0)(),k=(0,n.v9)((e=>e.UserState)),[b,g]=(0,a.useState)(null),[y,j]=(0,a.useState)(!1),[E,N]=(0,a.useState)([]),[L,S]=(0,a.useState)("");(0,a.useEffect)((()=>{m(y?(0,P.yh)():(0,P.v3)())}),[y,m]),(0,a.useEffect)((()=>{(0,h.fb)(r)&&!1!==r||(0,h.fb)(i)&&!i&&((0,h.fb)(_.getAddress())?g(_.getAddress()):p(-1))}),[p,i,r]),(0,a.useEffect)((()=>{if((0,h.fb)(i)&&!i&&(0,h.fb)(l)&&(0,h.fb)(b)&&(0,h.fb)(s)){if(!(0,h.fb)(s))return;if(!(0,h.fb)(l))return;u()({url:`${f._}/api/book/quotes`,method:"GET",params:{bookAddress:l.book_address,cfi_range:s.currentLocation().start.cfi}}).then((e=>{200===e.status?(t(e.data.length),N(e.data)):204===e.status||m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>j(!1)))}}),[b,l,m,null===s||void 0===s?void 0:s.location]);const O=(0,a.useCallback)((e=>{if((0,h.fb)(i)&&!i&&(0,h.fb)(l)&&(0,h.fb)(b)&&(0,h.fb)(s)){if(!(0,h.fb)(s))return;if(!(0,h.fb)(l))return;j(!0),u()({url:`${f._}/api/book/quotes`,method:"POST",data:{bookAddress:l.book_address,ownerAddress:b,quote:{body:e},cfi_range:null===s||void 0===s?void 0:s.currentLocation().start.cfi}}).then((e=>{200===e.status?u()({url:`${f._}/api/book/quotes`,method:"GET",params:{bookAddress:l.book_address,cfi_range:s.currentLocation().start.cfi}}).then((e=>{200===e.status?(t(e.data.length),N(e.data),S("")):204===e.status||m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>j(!1))):m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>j(!1)))}}),[E,b,l,m,s,i]);return(0,x.jsxs)("div",{className:"panel panel__annotation",children:[(0,x.jsxs)("div",{className:"quotes__input",children:[(0,x.jsx)("textarea",{className:"quotes__input__text-input",rows:6,onChange:e=>S(e.target.value),placeholder:"Start a Discussion...",type:"text",value:L}),(0,x.jsx)(c.Z,{className:"quotes__input__button",type:"primary",onClick:()=>O(L),children:"Post"})]}),E.map((e=>(0,x.jsx)(Oe,{rendition:s,quote:e,bookMeta:l,preview:i,UserState:k,hideModal:d})))]})},Ce=e=>{let{onColorSelect:t=(()=>{}),onClose:r=(()=>{})}=e;return(0,x.jsxs)("div",{className:"annotation-context-menu",children:[(0,x.jsx)("div",{className:"annotation-context-menu__container",children:["#e6192a","#0080ff","#14b84b","#ffd500","#aa00ff"].map((e=>(0,x.jsx)("div",{style:{"--color":e},className:"annotation-context-menu__container__item",onClick:()=>t(e)},e)))}),(0,x.jsx)("div",{className:"annotation-context-menu__close",children:(0,x.jsx)(c.Z,{type:"icon",onClick:r,children:(0,x.jsx)(j.r,{})})})]})};var ze;function Me(){return Me=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Me.apply(this,arguments)}function qe(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Me({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,ze||(ze=a.createElement("path",{d:"M21,6,9,18,21,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const We=a.forwardRef(qe);r.p;var Ie;function Te(){return Te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Te.apply(this,arguments)}function Ze(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Te({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Ie||(Ie=a.createElement("path",{d:"M9,6,21,18,9,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Ae=a.forwardRef(Ze);r.p;var Fe;function Pe(){return Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pe.apply(this,arguments)}function He(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Pe({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Fe||(Fe=a.createElement("path",{d:"M11,4H23a4,4,0,0,1,4,4V36L17,30,7,36V8a4,4,0,0,1,4-4",transform:"translate(7 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const $e=a.forwardRef(He);r.p;var Be,Ve,De,Je;function Ue(){return Ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ue.apply(this,arguments)}function Ge(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Ue({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Be||(Be=a.createElement("circle",{cx:7,cy:7,r:7,transform:"translate(28 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Ve||(Ve=a.createElement("path",{d:"M3,33V12a7,7,0,1,1,14,0V33",transform:"translate(3 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),De||(De=a.createElement("path",{d:"M3,13H17",transform:"translate(3 13)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Je||(Je=a.createElement("path",{d:"M21,12V26",transform:"translate(21 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Ye=a.forwardRef(Ge);r.p;var Qe,Ke,Xe,et,tt,rt,nt,ot,at=r(14998);function it(){return it=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},it.apply(this,arguments)}function st(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",it({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Qe||(Qe=a.createElement("path",{d:"M16,4h8v8",transform:"translate(16 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Ke||(Ke=a.createElement("line",{y1:12,x2:12,transform:"translate(28 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Xe||(Xe=a.createElement("path",{d:"M12,24H4V16",transform:"translate(4 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),et||(et=a.createElement("line",{y1:12,x2:12,transform:"translate(8 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),tt||(tt=a.createElement("path",{d:"M16,24h8V16",transform:"translate(16 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),rt||(rt=a.createElement("line",{x2:12,y2:12,transform:"translate(28 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),nt||(nt=a.createElement("path",{d:"M12,4H4v8",transform:"translate(4 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ot||(ot=a.createElement("line",{x2:12,y2:12,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const lt=a.forwardRef(st);r.p;var ct,dt,ut,ft,ht,_t,mt,pt;function vt(){return vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vt.apply(this,arguments)}function kt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",vt({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,ct||(ct=a.createElement("path",{d:"M5,13h8V5",transform:"translate(5 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),dt||(dt=a.createElement("line",{x2:12,y2:12,transform:"translate(6 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ut||(ut=a.createElement("path",{d:"M5,15h8v8",transform:"translate(5 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ft||(ft=a.createElement("line",{y1:12,x2:12,transform:"translate(6 30)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ht||(ht=a.createElement("path",{d:"M23,13H15V5",transform:"translate(15 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),_t||(_t=a.createElement("line",{y1:12,x2:12,transform:"translate(30 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),mt||(mt=a.createElement("path",{d:"M23,15H15v8",transform:"translate(15 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),pt||(pt=a.createElement("line",{x2:12,y2:12,transform:"translate(30 30)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const bt=a.forwardRef(kt);r.p;var gt,wt,xt,yt,jt,Et;function Nt(){return Nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nt.apply(this,arguments)}function Lt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Nt({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,gt||(gt=a.createElement("line",{x2:22,transform:"translate(18 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),wt||(wt=a.createElement("line",{x2:22,transform:"translate(18 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),xt||(xt=a.createElement("line",{x2:22,transform:"translate(18 36)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),yt||(yt=a.createElement("line",{y2:.02,transform:"translate(10 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),jt||(jt=a.createElement("line",{y2:.02,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Et||(Et=a.createElement("line",{y2:.02,transform:"translate(10 36)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const St=a.forwardRef(Lt);r.p;var Ot,Rt,Ct;function zt(){return zt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zt.apply(this,arguments)}function Mt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",zt({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-messages",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Ot||(Ot=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),Rt||(Rt=a.createElement("path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10"})),Ct||(Ct=a.createElement("path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2"})))}const qt=a.forwardRef(Mt),Wt=(r.p,e=>{let{rendition:t,onGoto:r=(()=>{}),onSelect:n=(()=>{})}=e;const[o,i]=(0,a.useState)([]);(0,a.useEffect)((()=>{(0,h.fb)(t)&&(0,h.fb)(t.book)&&t.book.loaded.navigation.then((e=>{let{toc:t}=e;const r=t.map((e=>({label:e.label,href:e.href})));i(r)}))}),[t]);const s=e=>{n(),(0,N.Z)("event_toc_panel_goto"),(0,h.fb)(t)&&(t.display(e),t.display(e),r())};return(0,x.jsx)("div",{className:"panel panel__toc",children:(()=>{(0,N.Z)("event_toc_panel_show");let e=[];return(0,h.fb)(t)?(o.forEach(((t,r)=>{e.push((0,x.jsx)("div",{className:"panel__toc__item",onClick:()=>s(`${t.href}`),children:(0,x.jsx)("div",{className:"typo__body typo__body--1",children:t.label})},r))})),0===e.length&&e.push((0,x.jsx)("div",{className:"panel__empty",children:"No Items"},"empty")),e):""})()})}),It=e=>{let{className:t="",value:r,onChange:n,min:o=0,max:i=100,step:s=1}=e;const l=(0,a.useRef)();return(0,a.useEffect)((()=>{if(!(0,h.fb)(l.current))return;let e=r/(i-o);l.current.style.setProperty("--progress",e)}),[r,o,i,l]),(0,x.jsx)("div",{ref:l,className:"range-slider "+t,children:(0,x.jsx)("input",{type:"range",value:r,onChange:n,min:o,max:i,step:s,className:"range-slider__input"})})},Tt=()=>{const e=(0,w.Z)(),t=(0,o.TH)(),r=(0,n.I0)(),d=(0,o.s0)(),[_,m]=(0,a.useState)(0),[p,k]=(0,a.useState)(null),[b,g]=(0,a.useState)(!1),[j,L]=(0,a.useState)({}),[S,R]=(0,a.useState)(0),[C,z]=(0,a.useState)(),[M,q]=(0,a.useState)(!1),[W,I]=(0,a.useState)(!1),[T,Z]=(0,a.useState)(!1),[A,$]=(0,a.useState)(!1),[B,V]=(0,a.useState)(0),[D,J]=(0,a.useState)(!1),[U,G]=(0,a.useState)(!1),[Y,Q]=(0,a.useState)(null),[K,X]=(0,a.useState)(!0),[ee,te]=(0,a.useState)({}),[re,ne]=(0,a.useState)(!1),[oe,ae]=(0,a.useState)(""),[ie,se]=(0,a.useState)(""),[le,ce]=(0,a.useState)(""),[de,ue]=(0,a.useState)(!0),fe=l(S,300),he=(0,a.useRef)(),_e=(0,a.useRef)(),me=(0,a.useRef)(!1);(0,a.useEffect)((()=>Q(e.getAddress())),[]);const pe=(0,a.useCallback)((e=>{if((0,N.Z)("event_reader_lastPage_save"),!(0,h.fb)(window.localStorage))return;if(!(0,h.fb)(j))return;const t=`${j.id}:lastread`;localStorage.setItem(t,e)}),[j]),ve=(0,a.useCallback)((()=>{if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;const e=`${j.id}:bookmarks`;let t=window.localStorage.getItem(e);if(!(0,h.vd)(t))return!1;let r=JSON.parse(t)||{},n=new s.OS,o=C.currentLocation();try{return 0===n.compare(r.cfi,o.start.cfi)||(0===n.compare(r.cfi,o.end.cfi)||1===n.compare(r.cfi,o.start.cfi)&&-1===n.compare(r.cfi,o.end.cfi))}catch(a){return!1}}),[j,C]),ke=(0,a.useCallback)((()=>{(0,N.Z)("event_reader_page_bookmark");const e=ve();$(e)}),[ve]),be=(0,a.useCallback)((function(){let{customizer:e=!0,annotation:t=!0,quote:r=!0,toc:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,N.Z)("event_reader_panels_hide"),e&&J(!1),t&&I(!1),r&&Z(!1),n&&G(!1)}),[]);(0,a.useEffect)((()=>{(0,N.Z)("page_view_reader")}),[]),(0,a.useEffect)((()=>{!0===M?((0,N.Z)("event_reader_screen_full"),ge()):((0,N.Z)("event_reader_screen_window"),we())}),[M]),(0,a.useEffect)((()=>{r(b?(0,P.yh)():(0,P.v3)())}),[b,r]),(0,a.useEffect)((()=>{be()}),[K,be]),(0,a.useEffect)((()=>{g(!0);let e=null;const n=t.state;(0,h.fb)(n.preview)&&!0===n.preview?((0,N.Z)("event_reader_mode_preview"),e=f._+"/files/"+n.book.preview,k(!0)):((0,N.Z)("event_reader_mode_live"),e=n.book.url,k(!1));try{const t=(0,s.ZP)(e,{openAs:"epub"});t.ready.then((()=>{const e=document.querySelector("#book__reader");e&&(e.innerHTML="");const r=t.renderTo("book__reader",{width:"100%",height:"100%",manager:"continuous",flow:"paginated",snap:"true",gap:40,allowScriptedContent:!0});r.themes.default(O),r.display(),z(r),g(!1)})).catch((e=>{r((0,v.e1)({show:!0,message:"Error while loading book.",type:4})),g(!1)})),L(n.book)}catch(o){r((0,v.e1)({show:!0,message:"Error while loading book.",type:4})),g(!1)}}),[t,r]),(0,a.useEffect)((()=>{if(!(0,h.fb)(C))return;const e=()=>{(0,N.Z)("event_reader_resize"),C.manager.resize("100%","100%")},t=()=>{(0,h.fb)(window.document.fullscreenElement)?((0,N.Z)("event_reader_fullscreen"),q(!0)):((0,N.Z)("event_reader_window"),q(!1)),e()};return window.addEventListener("resize",e),window.addEventListener("fullscreenchange",t),()=>{window.removeEventListener("resize",e),window.removeEventListener("fullscreenchange",t)}}),[C]),(0,a.useEffect)((()=>{(0,h.fb)(C)&&((0,h.fb)(le)||(0,h.vd)(le))&&C.book.loaded.navigation.then((function(){var e;let t=le,r=C.book.spine.get(t);if(!(0,h.fb)(r))return;let n=C.book.navigation.get(r.href);ae((null===n||void 0===n||null===(e=n.label)||void 0===e?void 0:e.trim())||"")}))}),[C,le]),(0,a.useEffect)((()=>{if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;const e=e=>{ke(),R(e.start.location),pe(e.start.cfi),ce(e.start.cfi)},t=()=>{X((e=>!e))},r=e=>{(0,N.Z)("event_reader_navigate_keys"),"ArrowLeft"!==e.key&&37!==(e.keyCode||e.which)||C.prev(),"ArrowRight"!==e.key&&39!==(e.keyCode||e.which)||C.next()};return C.on("relocated",e),C.on("click",t),C.on("keyup",r),document.addEventListener("keyup",r),()=>{C.off("relocated",e),C.off("click",t),C.off("keyup",r),document.removeEventListener("keyup",r)}}),[C,j,ke,pe,ce]),(0,a.useEffect)((()=>{if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;const e=`${j.id}:locations`;let t=localStorage.getItem(e);t?(C.book.locations.load(t),V(JSON.parse(t).length)):C.book.locations.generate().then((()=>{V(C.book.locations.total),localStorage.setItem(e,C.book.locations.save())})).catch((e=>{}))}),[C,j]),(0,a.useEffect)((()=>{(0,h.fb)(C)&&!0===me.current&&(C.display(C.book.locations.cfiFromLocation(fe)),me.current=!1)}),[fe,C,me]),(0,a.useEffect)((()=>{if(!(0,h.fb)(window.localStorage))return;if(!(0,h.fb)(j))return;if(!(0,h.fb)(C))return;const e=`${j.id}:lastread`;let t=localStorage.getItem(e);(0,h.fb)(t)&&C.display(t)}),[j,C]),(0,a.useEffect)((()=>{if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;const e=(e,t)=>{(0,N.Z)("event_reader_content_selected"),C.book.getRange(e).then((t=>{te({cfiRange:e,text:null===t||void 0===t?void 0:t.toString()}),ne(!0)})).catch((()=>{te({})}))};return C.on("selected",e),()=>{C.off("selected",e)}}),[C,j]),(0,a.useEffect)((()=>{if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;const e=(e,t,r)=>{I(!0)};return C.on("markClicked",e),()=>{C.off("markClicked",e)}}),[C,j]);const ge=()=>{xe();var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},we=()=>{xe(),document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())};function xe(){ue(!0),m(0)}return(0,a.useEffect)((()=>{if(!(0,h.fb)(j)&&!(0,h.fb)(Y))return;let e=setInterval((()=>{m((e=>e+1))}),1e3);return()=>{clearInterval(e)}}),[j,Y]),(0,a.useEffect)((()=>{_>=1e3&&(ue(!1),m(0))})),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(i.q,{children:(0,x.jsx)("meta",{name:"Reader",content:"Book's Reader View"})}),(0,x.jsxs)("div",{className:"reader",children:[(0,x.jsxs)("div",{className:"reader__header"+(K?" reader__header--show":""),children:[(0,x.jsxs)("div",{className:"reader__header__left",children:[(0,x.jsx)(c.Z,{type:"icon",onClick:()=>{d(-1)},children:(0,x.jsx)(We,{})}),(0,x.jsxs)("div",{className:"reader__header__left__timer",children:[(0,x.jsx)("span",{class:"reader__header__left__timer__dot"}),C&&(0,x.jsx)(y,{timerUpdate:de,preview:p,bookMeta:j,rendition:C})]})]}),(0,x.jsx)("div",{className:"reader__header__center",children:(0,x.jsx)("div",{className:"typo__body--2 typo__color--n700 typo__transform--capital",children:j.title||"Untitled"})}),(0,x.jsxs)("div",{className:"reader__header__right",children:[(0,x.jsxs)(c.Z,{className:"reader__header__right__hide-on-mobile",type:"icon",onClick:()=>q((e=>!e)),children:[" ",M?(0,x.jsx)(bt,{}):(0,x.jsx)(lt,{})," "]}),(0,x.jsxs)(c.Z,{type:"icon",className:U?"reader__header__right__button--active":"",onClick:()=>{be({toc:!1}),G((e=>!e)),xe()},children:[" ",(0,x.jsx)(St,{})," "]}),(0,x.jsxs)(c.Z,{type:"icon",className:W?"reader__header__right__button--active":"",onClick:()=>{be({annotation:!1}),I((e=>!e)),xe()},children:[" ",(0,x.jsx)(at.r,{})," "]}),(0,x.jsxs)(c.Z,{type:"icon",className:T?"reader__header__right__button--active":"",onClick:()=>{be({quotePanel:!1}),Z((e=>!e)),xe()},children:[" ",(0,x.jsx)(qt,{})," "]}),(0,x.jsx)(c.Z,{type:"icon",className:A?"reader__header__right__button--active":"",onClick:()=>{xe(),!0===ve()?(()=>{if((0,N.Z)("event_bookmarkpanel_bookmark_remove"),(0,h.fb)(p)&&!p&&(0,h.fb)(j)&&(0,h.fb)(Y)){if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;g(!0),u()({url:`${f._}/api/reader/bookmarks`,method:"POST",data:{bookAddress:j.book_address,ownerAddress:Y,bookmarks:""}}).then((e=>{if(200===e.status){const e=`${j.id}:bookmarks`;localStorage.setItem(e,""),ke()}else r((0,v.e1)("NOT200"))})).catch((e=>{r((0,v.e1)("ERROR"))})).finally((()=>g(!1)))}})():(()=>{if((0,N.Z)("event_bookmarkpanel_bookmark"),(0,h.fb)(p)&&!p&&(0,h.fb)(j)&&(0,h.fb)(Y)){if(!(0,h.fb)(C))return;if(!(0,h.fb)(j))return;g(!0);let e={cfi:C.currentLocation().start.cfi,percent:C.currentLocation().start.percentage};u()({url:`${f._}/api/reader/bookmarks`,method:"POST",data:{bookAddress:j.book_address,ownerAddress:Y,bookmarks:JSON.stringify(e)}}).then((t=>{if(200===t.status){const t=`${j.id}:bookmarks`;localStorage.setItem(t,JSON.stringify(e)),ke()}else r((0,v.e1)("NOT200"))})).catch((e=>{r((0,v.e1)("ERROR"))})).finally((()=>g(!1)))}})()},children:(0,x.jsx)($e,{})}),(0,x.jsx)(c.Z,{type:"icon",className:D?"reader__header__right__button--active":"",onClick:()=>{be({customizer:!1}),J((e=>!e)),xe()},children:(0,x.jsx)(Ye,{})})]})]}),(0,x.jsxs)("div",{className:"reader__container",children:[T?null:(0,x.jsxs)("div",{className:"quotes__discussions ",children:["Discussions:",(0,x.jsx)("div",{className:"quotes__discussions__count",children:ie})]}),(0,x.jsx)("div",{className:A?"reader__container__bookmark reader__container__bookmark--show":"reader__container__bookmark"}),(0,x.jsx)("div",{className:"reader__container__prev-btn",children:(0,x.jsx)("div",{className:"reader__container__prev-btn__button",onClick:()=>{C.prev(),xe()},children:(0,x.jsx)(We,{width:32,stroke:"currentColor"})})}),(0,x.jsx)("div",{id:"book__reader",className:"reader__container__book"}),(0,x.jsx)("div",{className:"reader__container__next-btn",children:(0,x.jsx)("div",{className:"reader__container__next-btn__button",onClick:()=>{C.next(),xe()},children:(0,x.jsx)(Ae,{width:32,stroke:"currentColor"})})}),!p&&(0,x.jsx)("div",{className:re?"reader__container__context-menu-container reader__container__context-menu-container--show":"reader__container__context-menu-container",children:(0,x.jsx)(Ce,{onColorSelect:e=>{(e=>{xe(),(0,h.fb)(ee)&&(0,h.fb)(C)&&(0,h.fb)(j)&&(0,h.fb)(he.current)&&"function"===typeof he.current&&he.current({...ee,color:e})})(e),ne(!1)},onClose:()=>ne(!1)})}),(0,x.jsx)(E,{show:U,setShow:G,position:"right",title:"Table of Content",children:(0,x.jsx)(Wt,{onSelect:()=>{be({toc:!1}),G(!1)},rendition:C})}),(0,x.jsx)(E,{show:W,setShow:I,position:"right",title:"Annotations",children:(0,x.jsx)(H,{preview:p,rendition:C,bookMeta:j,show:W,addAnnotationRef:he,hideModal:()=>{I(!1),xe()},onRemove:()=>{I(!1)}})}),(0,x.jsx)(E,{show:T,setShow:Z,position:"right",title:"Discussions",children:(0,x.jsx)(Re,{setDiscCount:se,preview:p,rendition:C,bookMeta:j,show:T,addQuotesRef:_e,hideModal:()=>{Z(!1)}})}),(0,x.jsx)(E,{show:D,setShow:J,position:"right-bottom",title:"Preferences",children:(0,x.jsx)(F,{initialFontSize:100,rendition:C})})]}),(0,x.jsxs)("nav",{className:"reader__nav"+(K?" reader__nav--show":""),children:[(0,x.jsxs)("div",{className:"reader__nav__value",children:[(0,x.jsx)("div",{className:"reader__nav__value__chapter-title typo__gray--n600 typo__transform--capital",children:oe||j.title||""}),(0,x.jsxs)("div",{children:[Math.floor(100*fe/B)||"0","%"]})]}),(0,x.jsx)("div",{className:"reader__nav__progress",children:(0,x.jsx)(It,{value:S,onChange:e=>{xe(),me.current=!0,R(e.target.value)},max:B,className:"reader__nav__progress"})})]})]})]})}}}]);
//# sourceMappingURL=696.5606540d.chunk.js.map