"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[590],{45972:function(e,t,a){a.d(t,{r:function(){return _}});var n,r,o,s,i=a(72791),l=["title","titleId"];function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},c.apply(this,arguments)}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function u(e,t){var a=e.title,u=e.titleId,_=p(e,l);return i.createElement("svg",c({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":u},_),a?i.createElement("title",{id:u},a):null,n||(n=i.createElement("line",{x2:.02,transform:"translate(30 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),r||(r=i.createElement("rect",{width:32,height:32,rx:3,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),o||(o=i.createElement("path",{d:"M4,19.67l8-8a4.029,4.029,0,0,1,6,0l10,10",transform:"translate(4 10.33)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),s||(s=i.createElement("path",{d:"M14,15.67l2-2a4.029,4.029,0,0,1,6,0l4,4",transform:"translate(14 12.33)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}var _=i.forwardRef(u);a.p},7018:function(e,t,a){var n=a(72791),r=a(80184);t.Z=function(e){var t=e.progress,a=(0,n.useRef)();return(0,n.useEffect)((function(){var e;null===a||void 0===a||null===(e=a.current)||void 0===e||e.style.setProperty("--progress",t)}),[t]),(0,r.jsx)("div",{className:"progressbar",children:(0,r.jsx)("div",{ref:a,className:"progressbar__value"})})}},46332:function(e,t,a){a.d(t,{d:function(){return n}});var n=["Children (0-14 years)","Youth (15-24 years)","Adults (25-64 years)","Seniors 65+"]},14605:function(e,t,a){a.d(t,{Hb:function(){return r},iV:function(){return n}});var n="0xdA5289fCAAF71d52a80A254da614a192b693e977",r="0xCcCABe37d0bDec98628860C69895092340de07B0"},83483:function(e,t,a){a.d(t,{x:function(){return n}});var n=["Adventure","Art","Autobiography","Biography","Business","Children's","Children's History","Classics","Comics","Contemporary Fiction","Cookbooks","Crime Fiction","Drama","Dystopian","Essays","Family","Fantasy","Fiction","Food & Drink","Graphic Novels","Guide / How-To","Health","Historical Fiction","History","Horror","Humanities & Social Sciences","Humor","LGBTQ+","Literary Fiction","Magical Realism","Management","Memoir","Music","Mystery","New Adult","Parenting & Families","Personal Development","Philosophy","Photography","Poetry","Politics","Psychological Thrillers","Psychology","Relationships","Religion & Spirituality","Romance","Science","Science & Technology","Science Fiction","Self Help","Short Story","Society & Culture","Sports","Thriller","Travel","Women's Fiction","Young Adult"]},35771:function(e,t,a){a.d(t,{a:function(){return n}});var n=["EN - English","ZH - Chinese","DE - German","ES - Spanish","JA - Japanese","RU - Russian","FR - French","KO - Korean","IT - Italian","NL - Dutch","PT - Portugese","HI - Hindi","PL - Polish","DA - Danish","BN - Bangla"]},85590:function(e,t,a){a.r(t);var n=a(15861),r=a(1413),o=a(29439),s=a(64687),i=a.n(s),l=a(74569),c=a.n(l),p=a(72426),u=a.n(p),_=a(16871),d=a(72791),h=a(16030),b=a(54270),f=a(17303),m=a(6222),g=a(88062),v=a(83374),y=a(88952),k=a(61199),x=a(95899),w=a(98669),j=a(44643),Z=a(29316),S=a(4127),N=a(75454),E=a(7018),F=a(45972),C=a(83483),P=a(65248),O=a(35771),L=a(46332),T=a(14605),A=a(80184);t.default=function(e){var t=(0,h.I0)(),a=(0,_.s0)(),s=(0,h.v9)((function(e){return e.UserState})),l=(0,h.v9)((function(e){return e.BWalletState})),p=(0,d.useState)(!1),I=(0,o.Z)(p,2),R=I[0],D=I[1],B=(0,d.useState)(null),H=(0,o.Z)(B,2),G=H[0],U=H[1],M=(0,d.useState)(null),W=(0,o.Z)(M,2),J=W[0],Y=W[1],z=(0,d.useState)({name:"",author:"",cover:null,preview:null,book:null,genres:[],ageGroup:[],price:"",pages:"",publication:"",isbn:"",synopsis:"",language:"",published:"",secondarySalesDate:"",primarySales:"",secondaryFrom:u()().add(1,"days")}),V=(0,o.Z)(z,2),q=V[0],K=V[1],Q=(0,d.useState)(0),X=(0,o.Z)(Q,2),$=X[0],ee=X[1],te=(0,d.useState)(!0),ae=(0,o.Z)(te,2),ne=ae[0],re=ae[1];function oe(){return oe=(0,n.Z)(i().mark((function e(){var r,o,p,_,d,h,b,y,k,S,N,E,F,L;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=q.name,o=q.author,p=q.cover,_=q.book,d=q.genres,h=q.ageGroup,b=q.price,y=q.pages,k=q.publication,S=q.synopsis,N=q.language,E=q.published,F=q.secondaryFrom,(0,Z.fb)(r)&&(0,Z.vd)(o)&&(0,Z.fb)(p)&&(0,Z.fb)(_)&&(0,Z.fb)(d)&&(0,Z.fb)(h)&&(0,Z.fb)(b)&&(0,Z.fb)(y)&&(0,Z.fb)(S)&&(0,Z.fb)(N)&&(0,Z.fb)(E)&&(0,Z.fb)(F)?((0,x.Z)("event_publish_list"),D(!0),(L=new FormData).append("book",q.book),L.append("cover",q.cover),L.append("bookTitle",q.title),L.append("synopsis",q.synopsis),c()({url:P._+"/api/book/submarine",method:"POST",headers:{"user-id":s.user.uid,address:s.user.wallet,authorization:"Bearer ".concat(s.tokens.acsTkn.tkn)},data:L}).then(function(){var e=(0,n.Z)(i().mark((function e(n){var s,x,L,A,I,R,B,H,G,U,M;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.data.book.url,x=n.data.cover.url,L=[],d.forEach((function(e){return L.push(C.x.indexOf(e).toString())})),A=O.a.indexOf(N).toString(),I=Math.round(u().duration(q.secondaryFrom-u()()).asDays()),!((0,Z.fb)(A)&&(0,Z.fb)(L)&&!isNaN(I)&&(0,Z.vd)(r)&&(0,Z.vd)(o)&&(0,Z.fb)(p)&&(0,Z.fb)(_)&&(0,Z.vd)(y))){e.next=32;break}return e.prev=7,R=new f.vU(["function createNewBook(address _author, string memory _coverURI, uint256 _initialPrice, uint256 _daysForSecondarySales, uint256 _lang, uint256[] memory _genre )"]),B=l.smartAccount.address,H=R.encodeFunctionData("createNewBook",[B,x,m.parseUnits(b,6),I,A,L]),G={to:T.Hb,data:H},l.smartAccount.on("txMined",(function(e){e.receipt.logs.forEach((function(n){n.topics.forEach((function(i){if(i===(0,g.keccak256)((0,v.Y0)("OwnershipTransferred(address,address)"))){var l=n.address,p=e.receipt.transactionHash,u=e.receipt.status;if((0,Z.fb)(l)&&(0,Z.fb)(u)&&1===u&&(0,Z.fb)(p)){var _=new FormData;_.append("epub",q.preview),_.append("name",r),_.append("author",o),_.append("cover",x),_.append("coverFile",q.cover),_.append("book",s),_.append("genres",JSON.stringify(d.sort((function(e,t){return e>t})))),_.append("ageGroup",JSON.stringify(h.sort((function(e,t){return e>t})))),_.append("price",b),_.append("pages",y),_.append("publication",k),_.append("synopsis",S.replace(/<[^>]+>/g,"")),_.append("language",N),_.append("published",E),_.append("secondarySalesFrom",F),_.append("publisherAddress",J),_.append("bookAddress",l),_.append("txHash",p),c()({url:P._+"/api/book/publish",method:"POST",data:_}).then((function(e){200===e.status?((0,w.SR)("publish-book-form-data"),D(!1),a("/library",{state:{tab:"published"}})):t((0,j.e1)("ERROR"))})).catch((function(e){(0,Z.fb)(e.response)?413===e.response.status?t((0,j.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&t((0,j.e1)("INVALID_FILE_TYPE")):t((0,j.e1)("NOT200")),D(!1)}))}else D(!1),(0,Z.fb)(p)?t((0,j.e1)({show:!0,message:"The transaction to mint eBook failed.\ntxhash: ".concat(p),type:3})):t((0,j.e1)({show:!0,message:"The transaction to mint eBook failed.",type:3}))}}))}))})),l.smartAccount.on("error",(function(e){console.error({error:e}),D(!1),t((0,j.e1)("ERROR"))})),e.next=16,l.smartAccount.prepareRefundTransaction({transaction:G});case 16:return U=e.sent,e.next=19,l.smartAccount.createRefundTransaction({transaction:G,feeQuote:U[0]});case 19:return M=e.sent,e.next=22,l.smartAccount.sendTransaction({tx:M,gasLimit:{hex:"0x4C4B40",type:"hex"}});case 22:e.sent,e.next=30;break;case 25:e.prev=25,e.t0=e.catch(7),D(!1),console.error({error:e.t0}),t((0,j.e1)("ERROR"));case 30:e.next=34;break;case 32:t((0,j.e1)({show:!0,message:"Incomplete details",type:3})),D(!1);case 34:case"end":return e.stop()}}),e,null,[[7,25]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error({err:e}),(0,Z.fb)(e.response)?413===e.response.status?t((0,j.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&t((0,j.e1)("INVALID_FILE_TYPE")):t((0,j.e1)("NOT200")),D(!1)}))):t((0,j.e1)({show:!0,message:"Incomplete details",type:3}));case 2:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}return(0,d.useEffect)((function(){(0,x.Z)("page_view_publish")}),[]),(0,d.useEffect)((function(){(0,Z.fb)(q.cover)&&U(URL.createObjectURL(q.cover))}),[q]),(0,d.useEffect)((function(){t(R?(0,S.yh)():(0,S.v3)())}),[R,t]),(0,d.useEffect)((function(){D(!0),(0,Z.fb)(l.smartAccount)&&Y(l.smartAccount.address),D(!1)}),[l]),(0,d.useEffect)((function(){var e=["publication","isbn","primarySales","secondarySalesDate"],t=0,a=Object.keys(q).length;Object.keys(q).forEach((function(n){var r;if(e.includes(n))return a--;""!==q[n]&&0!==(null===(r=q[n])||void 0===r?void 0:r.length)&&null!==q[n]&&t++})),ee(t/a)}),[q]),(0,d.useEffect)((function(){if(window.localStorage)try{(0,x.Z)("event_publish_load_data");var e=JSON.parse(window.localStorage.getItem("publish-book-form-data"));if(!(0,Z.fb)(e))return void re(!1);K((0,r.Z)((0,r.Z)({},q),{},{name:e.name,author:e.author,genres:e.genres,ageGroup:e.ageGroup,price:e.price,pages:e.pages,publication:e.publication,synopsis:e.synopsis,language:e.language})),re(!1)}catch(t){re(!1)}}),[]),(0,d.useEffect)((function(){(0,x.Z)("event_publish_save_data"),ne||window.localStorage&&window.localStorage.setItem("publish-book-form-data",JSON.stringify(q))}),[q,ne]),(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(b.q,{children:(0,A.jsx)("meta",{name:"Publish",content:""})}),(0,A.jsx)(y.Z,{noFooter:!0,containerClass:"publish publish__bg",children:(0,A.jsxs)("div",{className:"publish__data",children:[(0,A.jsxs)("div",{className:"publish__data__form utils__padding__bottom--s",children:[(0,A.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Publish eBook"}),(0,A.jsx)(k.Z,{type:"string",label:"book name",value:q.name,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{name:e.target.value}))},description:"Enter name of the book"}),(0,A.jsx)(k.Z,{type:"string",label:"book author",value:q.author,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{author:e.target.value}))},description:"Enter name of the author"}),(0,A.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Upload Files"}),(0,A.jsx)(k.Z,{type:"file",label:"cover",accept:"image/*",onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{cover:e.target.files[0]}))},description:"Upload a picture of book cover. File types supported: JPG, PNG, GIF, SVG, WEBP"}),(0,A.jsx)(k.Z,{type:"file",label:"preview",accept:"application/epub+zip",onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{preview:e.target.files[0]}))},description:"Upload a sample of book for preview. File types supported: EPUB"}),(0,A.jsx)(k.Z,{type:"file",label:"book",accept:"application/epub+zip",onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{book:e.target.files[0]}))},description:"Upload a book. File types supported: EPUB"}),(0,A.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Meta Data"}),(0,A.jsx)(k.Z,{type:"number",label:"price in USDC",value:q.price,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{price:e.target.value}))},description:"Price of book in USDC"}),(0,A.jsx)(k.Z,{type:"list",label:"genres",listType:"multiple",minLimit:1,maxLimit:5,values:C.x,value:q.genres,onSave:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{genres:e}))},placeholder:"e.g., Action, Adventure",description:"Select genres for the book. Max 5 genres can be selected"}),(0,A.jsx)(k.Z,{type:"list",label:"age group",listType:"multiple",minLimit:1,maxLimit:L.d.length,values:L.d,value:q.ageGroup,onSave:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{ageGroup:e}))},placeholder:"e.g., Youth (15-24 years)",description:"Select the most appropriate age group for the book."}),(0,A.jsx)(k.Z,{type:"number",label:"number of print pages",value:q.pages,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{pages:e.target.value}))},description:"Enter number of pages in the book"}),(0,A.jsx)(k.Z,{type:"string",label:"publication",value:q.publication,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{publication:e.target.value}))},description:"Enter name of the publisher",required:!1}),(0,A.jsx)(k.Z,{type:"text",label:"synopsis",lines:8,value:q.synopsis,onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{synopsis:e.target.value}))},description:"Write a brief description about the book"}),(0,A.jsx)(k.Z,{type:"list",label:"language",listType:"single",values:O.a,value:q.language,onSave:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{language:e}))},description:"Select the language of the book"}),(0,A.jsx)(k.Z,{type:"date",label:"published",onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{published:e.target.value}))},description:"Enter when book was published"}),(0,A.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--b utils__margin__bottom--m",children:"Secondary Sales Conditions"}),(0,A.jsx)(k.Z,{type:"date",label:"open on",min:u()().add(1,"days"),max:u()().add(150,"days"),onChange:function(e){return K((0,r.Z)((0,r.Z)({},q),{},{secondaryFrom:e.target.value}))},description:"From when to start secondary sales"})]}),(0,A.jsx)("div",{className:"publish__data__preview",children:(0,A.jsxs)("div",{className:"publish__data__preview__container",children:[(0,A.jsx)("h3",{className:"typo__head typo__head--5 utils__margin__top--n",children:"Preview"}),(0,A.jsxs)("div",{className:"publish__data__preview__book",onClick:function(){},children:[(0,A.jsx)("div",{className:"publish__data__preview__book__cover",children:(0,Z.fb)(G)?(0,A.jsx)("img",{className:"publish__data__preview__book__cover__img",src:G,alt:q.name+" cover"}):(0,A.jsxs)("div",{className:"publish__data__preview__book__cover__placeholder",children:[(0,A.jsx)(F.r,{stroke:"currentColor"}),(0,A.jsx)("span",{className:"utils__margin__top--m",children:"Book Cover"})]})}),(0,A.jsxs)("div",{className:"publish__data__preview__book__data",children:[(0,A.jsx)("div",{className:"publish__data__preview__book__data__title  typo__head--5",children:q.name}),(0,A.jsx)("div",{className:"publish__data__preview__book__data__author typo__subtitle typo__color--n500",children:q.author}),q.price&&(0,A.jsx)("div",{className:"publish__data__preview__book__data__price typo__color--success",children:0===parseFloat(q.price)?"FREE":(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",q.price]})}),q.language&&(0,A.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Language"}),(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__value typo__body typo__color--n500",children:q.language})]}),(0,Z.vd)(q.genres)&&(0,A.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Genres"}),(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__chips",children:q.genres.map((function(e){return(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__chips__item typo__body",children:e},e)}))})]}),q.publication&&(0,A.jsxs)("div",{className:"publish__data__preview__book__data__field",children:[(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__label typo__body typo__color--n700",children:"Publication"}),(0,A.jsx)("div",{className:"publish__data__preview__book__data__field__value typo__body typo__color--n500",children:q.publication})]})]})]}),(0,A.jsxs)("div",{className:"publish__data__preview__progress",children:[(0,A.jsxs)("div",{className:"publish__data__preview__progress__container",children:[(0,A.jsxs)("div",{className:"publish__data__preview__progress__container__value typo__color--n700",children:[Math.round(100*$),"%"]}),(0,A.jsx)(E.Z,{progress:$})]}),(0,A.jsx)(N.Z,{type:"primary",disabled:!1,size:"lg",onClick:function(){return function(){return oe.apply(this,arguments)}()},children:"Publish"})]})]})})]})})]})}}}]);
//# sourceMappingURL=590.00e57858.chunk.js.map