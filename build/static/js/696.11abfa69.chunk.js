"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[696],{14998:(e,t,r)=>{r.d(t,{r:()=>f});var n,o,a,i,s,l,c=r(72791);function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}function u(e,t){let{title:r,titleId:u,...f}=e;return c.createElement("svg",d({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":u},f),r?c.createElement("title",{id:u},r):null,n||(n=c.createElement("path",{d:"M6,15H36",transform:"translate(6 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),o||(o=c.createElement("path",{d:"M36,19H6",transform:"translate(6 19)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),a||(a=c.createElement("path",{d:"M15,11H27",transform:"translate(15 11)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),i||(i=c.createElement("path",{d:"M27,7H15",transform:"translate(15 7)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),s||(s=c.createElement("path",{d:"M9,12.5h2a2,2,0,1,1-2,2v-5a4,4,0,0,1,4-4",transform:"translate(9 5.5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),l||(l=c.createElement("path",{d:"M3,12.5H5a2,2,0,1,1-2,2v-5a4,4,0,0,1,4-4",transform:"translate(3 5.5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const f=c.forwardRef(u);r.p},67696:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Tt});var n=r(16030),o=r(16871),a=r(72791),i=r(54270),s=r(4343);const l=function(e,t){const[r,n]=(0,a.useState)(e);return(0,a.useEffect)((()=>{const r=setTimeout((()=>{n(e)}),t);return()=>{clearTimeout(r)}}),[e,t]),r};var c=r(75454),d=r(74569),u=r.n(d),f=r(65248),h=r(29316);const _=e=>{var t=parseInt(e,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map((e=>e<10?"0"+e:e)).filter(((e,t)=>"00"!==e||t>0)).join(":")};var m,p,v=r(44643);function k(){return k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},k.apply(this,arguments)}function b(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,m||(m=a.createElement("circle",{cx:18,cy:18,r:18,transform:"translate(6 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),p||(p=a.createElement("path",{d:"M12,7V17l6,6",transform:"translate(12 7)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const g=a.forwardRef(b);r.p;var w=r(80184);const x=e=>{let{timerUpdate:t,mobileView:r,bookMeta:i,preview:s}=e;const l=(0,n.v9)((e=>e.UserState)),c=(0,n.v9)((e=>e.BWalletState)),[d,m]=(0,a.useState)(0),[p,k]=(0,a.useState)(0),[b,x]=(0,a.useState)(null),y=(0,n.I0)(),j=(0,o.s0)();return(0,a.useEffect)((()=>{(0,h.fb)(r)&&!1!==r||(0,h.fb)(s)&&!s&&((0,h.fb)(c.smartAccount)?x(c.smartAccount.address):j(-1))}),[r,c,j,s]),(0,a.useEffect)((()=>{!s&&(0,h.fb)(i)&&((0,h.fb)(b)||(0,h.fb)(r)&&!0===r)&&u()({url:`${f._}/api/reader/read-time`,method:"GET",headers:{address:b,"user-id":l.user.uid,authorization:`Bearer ${l.tokens.acsTkn.tkn}`},params:{bookAddress:i.book_address}}).then((e=>{200===e.status&&(m(e.data.read_time),k(e.data.read_time))})).catch((e=>{y((0,v.e1)("ERROR"))}))}),[r,i,y,b,s,l]),(0,a.useEffect)((()=>{if(!(0,h.fb)(i)&&!(0,h.fb)(b)&&!(0,h.fb)(r)&&!0!==r)return;let e=setInterval((()=>{t&&m((e=>e+1))}),1e3);return()=>{clearInterval(e)}}),[t,r,i,b]),(0,a.useEffect)((()=>{if(!s){const e=d;e-p>10&&u()({url:`${f._}/api/reader/read-time`,method:"PUT",headers:{address:b,"user-id":l.user.uid,authorization:`Bearer ${l.tokens.acsTkn.tkn}`},data:{bookAddress:i.book_address,readTime:e}}).then((e=>{200===e.status&&k(e.data.read_time)})).catch((e=>{y((0,v.e1)("ERROR"))}))}}),[i,d,b,p,y,s,l]),(0,w.jsxs)("div",{className:"readtime",children:[(0,w.jsx)(g,{width:"3rem",height:"3rem",stroke:"currentColor"}),(0,w.jsx)("div",{className:"readtime__time",children:_(d)})]})};var y=r(9135);const j=e=>{let{show:t=!1,setShow:r=(()=>{}),position:n="right",title:o="",children:a}=e;return(0,w.jsxs)("div",{className:(()=>{let e=["sidepanel"];return!0===t&&e.push("sidepanel--open"),e.push(`sidepanel--${n}`),e.join(" ")})(),children:[(0,w.jsxs)("div",{className:"sidepanel__header",children:[(0,w.jsx)("div",{className:"sidepanel__header__close-btn",children:(0,w.jsx)(c.Z,{type:"icon",onClick:()=>r(!1),children:(0,w.jsx)(y.r,{width:24,height:24,stroke:"currentColor"})})}),(0,w.jsx)("div",{className:"sidepanel__header__title typo__head--6",children:o})]}),(0,w.jsx)("div",{className:"sidepanel__body",children:a})]})};var E=r(95899);const N={fontSize:{min:100,max:250,step:10,offset:50},lineHeight:{min:1,max:2,step:.25},fontFamily:[{id:"reader-font-family-arial",name:"Arial",value:"'Arial', sans-serif"},{id:"reader-font-family-times",name:"Times",value:"'Times New Roman', serif"},{id:"reader-font-family-trebuchet",name:"Trebuchet",value:"'Trebuchet MS', sans-serif"}],themes:[{id:"reader-theme-light",name:"Light",backgroundColor:"white",color:"black",bodyTheme:"light"},{id:"reader-theme-dark",name:"Dark",backgroundColor:"black",color:"white",bodyTheme:"dark"}]},L={fontSize:170,lineHeight:1.6,fontFamily:N.fontFamily.find((e=>"reader-font-family-arial"===e.id)),theme:N.themes.find((e=>"reader-theme-light"===e.id))},S={body:{"--font-family":L.fontFamily.value,"--font-size":L.fontSize+"%","--line-height":L.lineHeight,"--background-color":L.theme.backgroundColor,"--color":L.theme.color,"background-color":"var(--background-color) !important",color:"var(--color) !important","font-size":"var(--font-size) !important"},p:{"text-align":"justify","font-family":"var(--font-family) !important","line-height":"var(--line-height) !important"}};var O,R;function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C.apply(this,arguments)}function z(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,O||(O=a.createElement("line",{y2:28,transform:"translate(24 10)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),R||(R=a.createElement("line",{x2:28,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const M=a.forwardRef(z);r.p;var W;function q(){return q=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},q.apply(this,arguments)}function A(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",q({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,W||(W=a.createElement("line",{x2:28,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const I=a.forwardRef(A),T=(r.p,e=>{let{value:t=0,setValue:r=(()=>{}),unit:n="",min:o=0,max:a=100,step:i=1,offset:s=0}=e;return(0,w.jsxs)("div",{className:"number-input",children:[(0,w.jsx)("div",{className:"number-input__button",onClick:()=>{r(Math.max(o,t-i))},children:(0,w.jsx)(I,{width:24,stroke:"currentColor"})}),(0,w.jsxs)("div",{className:"number-input__value",children:[t-s,n]}),(0,w.jsx)("div",{className:"number-input__button",onClick:()=>{r(Math.min(a,t+i))},children:(0,w.jsx)(M,{width:24,stroke:"currentColor"})})]})}),Z=e=>{let{rendition:t}=e;const[r,n]=(0,a.useState)({...L,fontFamily:L.fontFamily.id,theme:L.theme.id}),o=(0,a.useCallback)((()=>{try{let e=t.currentLocation();t.clear(),t.display(e.start.cfi)}catch(e){}}),[t]);(0,a.useEffect)((()=>{let{fontSize:e=L.fontSize,lineHeight:t=L.lineHeight,fontFamily:r=L.fontFamily.id,theme:o=L.theme.id}=(()=>{if(!window.localStorage)return{};try{return JSON.parse(window.localStorage.getItem("READER_PREFERENCES"))||{}}catch(e){return{}}})();n({fontSize:e,lineHeight:t,fontFamily:r,theme:o})}),[]),(0,a.useEffect)((()=>{if(!(0,h.fb)(t))return;let e=N.themes.find((e=>e.id===r.theme)),n=N.fontFamily.find((e=>e.id===r.fontFamily));(0,h.fb)(e)||(e=N.themes[0]),(0,h.fb)(n)||(n=N.fontFamily[0]),t.themes.override("--font-size",r.fontSize+"%"),t.themes.override("--font-family",n.value),t.themes.override("--line-height",r.lineHeight),t.themes.override("--background-color",e.backgroundColor),t.themes.override("--color",e.color),window.document.body.setAttribute("data-theme",e.bodyTheme),o(),(e=>{window.localStorage&&window.localStorage.setItem("READER_PREFERENCES",JSON.stringify(e))})(r)}),[r,t,o]);return(0,w.jsxs)("div",{className:"panel panel__customizer",children:[(0,w.jsxs)("div",{className:"panel__customizer__field",children:[(0,w.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Font Size"}),(0,w.jsx)("div",{className:"panel__customizer__field__input",children:(0,w.jsx)(T,{value:r.fontSize,setValue:e=>{(0,E.Z)("event_customizer_fontsize_"+e),n((t=>({...t,fontSize:e})))},unit:"%",offset:N.fontSize.offset,min:N.fontSize.min,max:N.fontSize.max,step:N.fontSize.step})})]}),(0,w.jsxs)("div",{className:"panel__customizer__field",children:[(0,w.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Line Spacing"}),(0,w.jsx)("div",{className:"panel__customizer__field__input",children:(0,w.jsx)(T,{value:r.lineHeight,setValue:e=>{(0,E.Z)("event_customizer_lineheight_"+e),n((t=>({...t,lineHeight:e})))},min:N.lineHeight.min,max:N.lineHeight.max,step:N.lineHeight.step})})]}),(0,w.jsxs)("div",{className:"panel__customizer__field",children:[(0,w.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Themes"}),(0,w.jsx)("div",{className:"panel__customizer__field__input panel__customizer__field__input--themes",children:N.themes.map((e=>(0,w.jsx)("div",{className:"panel__customizer__field__input__chip"+(r.theme===e.id?" panel__customizer__field__input__chip--selected":""),onClick:()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"reader-theme-light";(0,E.Z)("event_customizer_theme_"+e),n((t=>({...t,theme:e})))}(e.id),style:{color:e.color,backgroundColor:e.backgroundColor},children:"Aa"},e.id)))})]}),(0,w.jsxs)("div",{className:"panel__customizer__field",children:[(0,w.jsx)("div",{className:"panel__customizer__field__lable typo__head--6",children:"Fonts"}),(0,w.jsx)("div",{className:"panel__customizer__field__input panel__customizer__field__input--fonts",children:N.fontFamily.map((e=>(0,w.jsxs)("div",{className:"panel__customizer__field__input__font"+(r.fontFamily===e.id?" panel__customizer__field__input__font--selected":""),style:{fontFamily:e.value},onClick:()=>{var t;t=e.id,(0,E.Z)("event_customizer_font_"+t),n((e=>({...e,fontFamily:t})))},children:[(0,w.jsx)("div",{className:"panel__customizer__field__input__font__demo",children:"Aa"}),(0,w.jsx)("div",{className:"panel__customizer__field__input__font__name",children:e.name})]},e.id)))})]})]})};var F=r(4127);const P=e=>{let{mobileView:t,preview:r,rendition:i,bookMeta:s,addAnnotationRef:l,onRemove:d=(()=>{}),hideModal:_=(()=>{})}=e;const m=(0,n.I0)(),p=(0,o.s0)(),k=(0,n.v9)((e=>e.BWalletState)),[b,g]=(0,a.useState)(null),[x,y]=(0,a.useState)(!1),[j,N]=(0,a.useState)([]);(0,a.useEffect)((()=>{m(x?(0,F.yh)():(0,F.v3)())}),[x,m]),(0,a.useEffect)((()=>{(0,h.fb)(t)&&!1!==t||(0,h.fb)(r)&&!r&&((0,h.fb)(k.smartAccount)?g(k.smartAccount.address):p(-1))}),[k,p,r,t]),(0,a.useEffect)((()=>{(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)&&(y(!0),u()({url:`${f._}/api/reader/annotations`,method:"GET",params:{bookAddress:s.book_address,ownerAddress:b}}).then((e=>{if(200===e.status){let t=JSON.parse(e.data.annotations)||[];N(t),t.forEach((e=>{i.annotations.add("highlight",e.cfiRange,{},(()=>{}),"",{fill:e.color,"fill-opacity":"0.35","mix-blend-mode":"multiply"})}))}else m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>y(!1))))}),[s,b,m,i,r]);const L=(e,t)=>{if((0,E.Z)("event_annotationpanel_remove"),(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)){if(!(0,h.fb)(i))return;if(!(0,h.fb)(s))return;y(!0);let r=j.filter(((t,r)=>r!==e));u()({url:`${f._}/api/reader/annotations`,method:"POST",data:{bookAddress:s.book_address,ownerAddress:b,annotations:JSON.stringify(r)}}).then((e=>{200===e.status?(N(r),i.annotations.remove(t.cfiRange,"highlight"),d()):m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>y(!1)))}},S=e=>{(0,E.Z)("event_annotationpanel_goto_page"),(0,h.fb)(i)&&(i.display(e),i.display(e),_())},O=(0,a.useCallback)((e=>{if((0,E.Z)("event_annotationpanel_annotate"),(0,h.fb)(r)&&!r&&(0,h.fb)(s)&&(0,h.fb)(b)&&(0,h.fb)(i)){if(!(0,h.fb)(i))return;if(!(0,h.fb)(s))return;y(!0);let t=[...j,e];u()({url:`${f._}/api/reader/annotations`,method:"POST",data:{bookAddress:s.book_address,ownerAddress:b,annotations:JSON.stringify(t)}}).then((r=>{200===r.status?(N(t),i.annotations.add("highlight",e.cfiRange,{},(()=>{}),"",{fill:e.color,"fill-opacity":"0.35","mix-blend-mode":"multiply"})):m((0,v.e1)("NOT200"))})).catch((e=>{m((0,v.e1)("ERROR"))})).finally((()=>y(!1)))}}),[j,b,s,m,i,r]);return(0,a.useEffect)((()=>{l.current=O}),[l,O]),(0,w.jsxs)("div",{className:"panel panel__annotation",children:[" ",(()=>{let e=[];return(0,h.fb)(i)&&(0,h.fb)(s)?(j.forEach(((t,r)=>{e.push((0,w.jsxs)("div",{className:"panel__annotation__item",onClick:()=>S(t.cfiRange),children:[(0,w.jsxs)("div",{className:"panel__annotation__item__container",children:[(0,w.jsx)("div",{className:"panel__annotation__item__color",style:{backgroundColor:t.color}}),(0,w.jsx)("div",{className:"panel__annotation__item__name",children:t.text})]}),(0,w.jsx)(c.Z,{size:"sm",type:"icon",onClick:e=>{e.stopPropagation(),L(r,t)},children:"remove"})]},r))})),0===e.length&&e.push((0,w.jsx)("div",{className:"panel__empty",children:"No Items"},"empty")),e):""})()," "]})};var H,B,$=r(72426),V=r.n($);function D(){return D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D.apply(this,arguments)}function J(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",D({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-message-circle-2",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,H||(H=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),B||(B=a.createElement("path",{d:"M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1"})))}const U=a.forwardRef(J);r.p;var G,Y,Q=r(39362);function K(){return K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},K.apply(this,arguments)}function X(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",K({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-thumb-up",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,G||(G=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),Y||(Y=a.createElement("path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3"})))}const ee=a.forwardRef(X);r.p;var te,re;function ne(){return ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ne.apply(this,arguments)}function oe(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-thumb-down",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,te||(te=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),re||(re=a.createElement("path",{d:"M7 13v-8a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v7a1 1 0 0 0 1 1h3a4 4 0 0 1 4 4v1a2 2 0 0 0 4 0v-5h3a2 2 0 0 0 2 -2l-1 -5a2 3 0 0 0 -2 -2h-7a3 3 0 0 0 -3 3"})))}const ae=a.forwardRef(oe);r.p;var ie,se,le;function ce(){return ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ce.apply(this,arguments)}function de(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",ce({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-send",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,ie||(ie=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),se||(se=a.createElement("line",{x1:10,y1:14,x2:21,y2:3})),le||(le=a.createElement("path",{d:"M21 3l-6.5 18a0.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a0.55 .55 0 0 1 0 -1l18 -6.5"})))}const ue=a.forwardRef(de);r.p;var fe,he,_e,me,pe;function ve(){return ve=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ve.apply(this,arguments)}function ke(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",ve({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-up-circle",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,fe||(fe=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),he||(he=a.createElement("circle",{cx:12,cy:12,r:9})),_e||(_e=a.createElement("line",{x1:12,y1:8,x2:8,y2:12})),me||(me=a.createElement("line",{x1:12,y1:8,x2:12,y2:16})),pe||(pe=a.createElement("line",{x1:16,y1:12,x2:12,y2:8})))}const be=a.forwardRef(ke);r.p;var ge,we,xe,ye,je;function Ee(){return Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ee.apply(this,arguments)}function Ne(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Ee({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-arrow-down-circle",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,ge||(ge=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),we||(we=a.createElement("circle",{cx:12,cy:12,r:9})),xe||(xe=a.createElement("line",{x1:8,y1:12,x2:12,y2:16})),ye||(ye=a.createElement("line",{x1:12,y1:8,x2:12,y2:16})),je||(je=a.createElement("line",{x1:16,y1:12,x2:12,y2:16})))}const Le=a.forwardRef(Ne),Se=(r.p,e=>{let{quote:t,bookMeta:r,UserState:o,preview:i,rendition:s,hideModal:l}=e;const c=(0,n.I0)(),[d,_]=(0,a.useState)(!1),[m,p]=(0,a.useState)(""),[k,b]=(0,a.useState)([]);(0,a.useEffect)((()=>{u()({url:`${f._}/api/book/quotes/comments`,method:"GET",params:{bookAddress:r.book_address,quoteId:t.book_id}}).then((e=>{200===e.status?b(e.data):204===e.status||c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))}))}),[r,c,s,i,t]);const g=e=>{let t=[];return e.forEach(((e,r)=>{t.push((0,w.jsxs)("div",{className:"quotes__comments__thread",children:[(0,w.jsxs)("div",{className:"quotes__comments__icon",children:[(0,w.jsx)(Q.r,{width:22,height:24,stroke:"currentColor"}),(0,w.jsx)("div",{className:"quotes__comments__text",children:e.uid})]}),(0,w.jsx)("div",{className:"quotes__comments__body typo__body",children:e.comment})]},r))})),t};return(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"quotes__item",onClick:()=>{return e=t.cfi_range,(0,E.Z)("event_annotationpanel_goto_page"),void((0,h.fb)(s)&&(s.display(e),s.display(e),l()));var e},children:[(0,w.jsx)("div",{className:"quotes__item__body typo__body",children:t.body}),(0,w.jsx)("div",{className:"quotes__item__time typo__cap typo__cap--2",children:V()(t.created_at).format("D MMM, YYYY")||"-"})]}),(0,w.jsx)("div",{className:"quotes__item__section"}),(0,w.jsxs)("div",{className:"quotes__item__section__icons",children:[(0,w.jsxs)("div",{className:"quotes__item__section__icon__action",children:[" ",(0,w.jsx)(U,{onClick:()=>_(!d),height:24,width:24}),k.length]}),(0,w.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,w.jsx)(be,{height:24,width:24})}),(0,w.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,w.jsx)(Le,{height:24,width:24})})]}),d?(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"quotes__item__section__comment-div",children:[(0,w.jsx)("input",{value:m,onChange:e=>p(e.target.value),className:"quotes__item__section__comment-div__input",type:"text",placeholder:"Add a comment..."}),(0,w.jsx)("div",{className:"quotes__item__section__comment-div__action",children:(0,w.jsx)(ue,{onClick:()=>{m.length>2&&u()({url:`${f._}/api/book/quotes/comments`,method:"POST",headers:{"user-id":o.user.uid},data:{bookAddress:r.book_address,quoteId:t.book_id,comment:m}}).then((e=>{200===e.status?u()({url:`${f._}/api/book/quotes/comments`,method:"GET",params:{bookAddress:r.book_address,quoteId:t.book_id}}).then((e=>{200===e.status?(b(e.data),p("")):204===e.status||c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))})):c((0,v.e1)("NOT200"))})).catch((e=>{c((0,v.e1)("ERROR"))}))}})})]}),(()=>{let e=[];return k.forEach(((t,r)=>{e.push((0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{className:"quotes__comments",children:[(0,w.jsxs)("div",{className:"quotes__comments__icon",children:[(0,w.jsx)(Q.r,{width:22,height:24,stroke:"currentColor"}),(0,w.jsx)("div",{className:"quotes__comments__text",children:t.uid})]}),(0,w.jsx)("div",{className:"quotes__comments__body typo__body",children:t.comment})]},r),(0,w.jsxs)("div",{className:"quotes__item__section__icons",children:[(0,w.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,w.jsx)(ee,{height:24,width:24})}),(0,w.jsx)("div",{className:"quotes__item__section__icon__action",children:(0,w.jsx)(ae,{height:24,width:24})})]}),t.thread?g(t.thread):null]}))})),e})()]}):null]})}),Oe=e=>{let{setDiscCount:t,mobileView:r,preview:i,rendition:s,bookMeta:l,hideModal:d=(()=>{})}=e;const _=(0,n.I0)(),m=(0,o.s0)(),p=(0,n.v9)((e=>e.UserState)),k=(0,n.v9)((e=>e.BWalletState)),[b,g]=(0,a.useState)(null),[x,y]=(0,a.useState)(!1),[j,E]=(0,a.useState)([]),[N,L]=(0,a.useState)("");(0,a.useEffect)((()=>{_(x?(0,F.yh)():(0,F.v3)())}),[x,_]),(0,a.useEffect)((()=>{(0,h.fb)(r)&&!1!==r||(0,h.fb)(i)&&!i&&((0,h.fb)(k.smartAccount.address)?g(k.smartAccount.address):m(-1))}),[k,m,i,r]),(0,a.useEffect)((()=>{if((0,h.fb)(i)&&!i&&(0,h.fb)(l)&&(0,h.fb)(b)&&(0,h.fb)(s)){if(!(0,h.fb)(s))return;if(!(0,h.fb)(l))return;u()({url:`${f._}/api/book/quotes`,method:"GET",params:{bookAddress:l.book_address,cfi_range:s.currentLocation().start.cfi}}).then((e=>{200===e.status?(t(e.data.length),E(e.data)):204===e.status||_((0,v.e1)("NOT200"))})).catch((e=>{_((0,v.e1)("ERROR"))})).finally((()=>y(!1)))}}),[b,l,_,null===s||void 0===s?void 0:s.location]);const S=(0,a.useCallback)((e=>{if((0,h.fb)(i)&&!i&&(0,h.fb)(l)&&(0,h.fb)(b)&&(0,h.fb)(s)){if(!(0,h.fb)(s))return;if(!(0,h.fb)(l))return;y(!0),u()({url:`${f._}/api/book/quotes`,method:"POST",data:{bookAddress:l.book_address,ownerAddress:b,quote:{body:e},cfi_range:null===s||void 0===s?void 0:s.currentLocation().start.cfi}}).then((e=>{200===e.status?u()({url:`${f._}/api/book/quotes`,method:"GET",params:{bookAddress:l.book_address,cfi_range:s.currentLocation().start.cfi}}).then((e=>{200===e.status?(t(e.data.length),E(e.data),L(""),console.log(e.data)):204===e.status||_((0,v.e1)("NOT200"))})).catch((e=>{_((0,v.e1)("ERROR"))})).finally((()=>y(!1))):_((0,v.e1)("NOT200"))})).catch((e=>{_((0,v.e1)("ERROR"))})).finally((()=>y(!1)))}}),[j,b,l,_,s,i]);return(0,w.jsxs)("div",{className:"panel panel__annotation",children:[(0,w.jsxs)("div",{className:"quotes__input",children:[(0,w.jsx)("textarea",{className:"quotes__input__text-input",rows:6,onChange:e=>L(e.target.value),placeholder:"Start a Discussion...",type:"text",value:N}),(0,w.jsx)(c.Z,{className:"quotes__input__button",type:"primary",onClick:()=>S(N),children:"Post"})]}),j.map((e=>(0,w.jsx)(Se,{rendition:s,quote:e,bookMeta:l,preview:i,UserState:p,hideModal:d})))]})},Re=e=>{let{onColorSelect:t=(()=>{}),onClose:r=(()=>{})}=e;return(0,w.jsxs)("div",{className:"annotation-context-menu",children:[(0,w.jsx)("div",{className:"annotation-context-menu__container",children:["#e6192a","#0080ff","#14b84b","#ffd500","#aa00ff"].map((e=>(0,w.jsx)("div",{style:{"--color":e},className:"annotation-context-menu__container__item",onClick:()=>t(e)},e)))}),(0,w.jsx)("div",{className:"annotation-context-menu__close",children:(0,w.jsx)(c.Z,{type:"icon",onClick:r,children:(0,w.jsx)(y.r,{})})})]})};var Ce;function ze(){return ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ze.apply(this,arguments)}function Me(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",ze({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Ce||(Ce=a.createElement("path",{d:"M21,6,9,18,21,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const We=a.forwardRef(Me);r.p;var qe;function Ae(){return Ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ae.apply(this,arguments)}function Ie(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Ae({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,qe||(qe=a.createElement("path",{d:"M9,6,21,18,9,30",transform:"translate(9 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Te=a.forwardRef(Ie);r.p;var Ze;function Fe(){return Fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fe.apply(this,arguments)}function Pe(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Fe({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Ze||(Ze=a.createElement("path",{d:"M11,4H23a4,4,0,0,1,4,4V36L17,30,7,36V8a4,4,0,0,1,4-4",transform:"translate(7 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const He=a.forwardRef(Pe);r.p;var Be,$e,Ve,De;function Je(){return Je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Je.apply(this,arguments)}function Ue(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Je({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Be||(Be=a.createElement("circle",{cx:7,cy:7,r:7,transform:"translate(28 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),$e||($e=a.createElement("path",{d:"M3,33V12a7,7,0,1,1,14,0V33",transform:"translate(3 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Ve||(Ve=a.createElement("path",{d:"M3,13H17",transform:"translate(3 13)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),De||(De=a.createElement("path",{d:"M21,12V26",transform:"translate(21 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Ge=a.forwardRef(Ue);r.p;var Ye,Qe,Ke,Xe,et,tt,rt,nt,ot=r(14998);function at(){return at=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},at.apply(this,arguments)}function it(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",at({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,Ye||(Ye=a.createElement("path",{d:"M16,4h8v8",transform:"translate(16 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Qe||(Qe=a.createElement("line",{y1:12,x2:12,transform:"translate(28 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Ke||(Ke=a.createElement("path",{d:"M12,24H4V16",transform:"translate(4 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),Xe||(Xe=a.createElement("line",{y1:12,x2:12,transform:"translate(8 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),et||(et=a.createElement("path",{d:"M16,24h8V16",transform:"translate(16 16)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),tt||(tt=a.createElement("line",{x2:12,y2:12,transform:"translate(28 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),rt||(rt=a.createElement("path",{d:"M12,4H4v8",transform:"translate(4 4)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),nt||(nt=a.createElement("line",{x2:12,y2:12,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const st=a.forwardRef(it);r.p;var lt,ct,dt,ut,ft,ht,_t,mt;function pt(){return pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},pt.apply(this,arguments)}function vt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",pt({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,lt||(lt=a.createElement("path",{d:"M5,13h8V5",transform:"translate(5 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ct||(ct=a.createElement("line",{x2:12,y2:12,transform:"translate(6 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),dt||(dt=a.createElement("path",{d:"M5,15h8v8",transform:"translate(5 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ut||(ut=a.createElement("line",{y1:12,x2:12,transform:"translate(6 30)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ft||(ft=a.createElement("path",{d:"M23,13H15V5",transform:"translate(15 5)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),ht||(ht=a.createElement("line",{y1:12,x2:12,transform:"translate(30 6)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),_t||(_t=a.createElement("path",{d:"M23,15H15v8",transform:"translate(15 15)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),mt||(mt=a.createElement("line",{x2:12,y2:12,transform:"translate(30 30)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const kt=a.forwardRef(vt);r.p;var bt,gt,wt,xt,yt,jt;function Et(){return Et=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Et.apply(this,arguments)}function Nt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Et({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,bt||(bt=a.createElement("line",{x2:22,transform:"translate(18 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),gt||(gt=a.createElement("line",{x2:22,transform:"translate(18 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),wt||(wt=a.createElement("line",{x2:22,transform:"translate(18 36)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),xt||(xt=a.createElement("line",{y2:.02,transform:"translate(10 12)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),yt||(yt=a.createElement("line",{y2:.02,transform:"translate(10 24)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),jt||(jt=a.createElement("line",{y2:.02,transform:"translate(10 36)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const Lt=a.forwardRef(Nt);r.p;var St,Ot,Rt;function Ct(){return Ct=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ct.apply(this,arguments)}function zt(e,t){let{title:r,titleId:n,...o}=e;return a.createElement("svg",Ct({xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-messages",width:24,height:24,viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",ref:t,"aria-labelledby":n},o),r?a.createElement("title",{id:n},r):null,St||(St=a.createElement("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"})),Ot||(Ot=a.createElement("path",{d:"M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10"})),Rt||(Rt=a.createElement("path",{d:"M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2"})))}const Mt=a.forwardRef(zt),Wt=(r.p,e=>{let{rendition:t,onGoto:r=(()=>{}),onSelect:n=(()=>{})}=e;const[o,i]=(0,a.useState)([]);(0,a.useEffect)((()=>{(0,h.fb)(t)&&(0,h.fb)(t.book)&&t.book.loaded.navigation.then((e=>{let{toc:t}=e;const r=t.map((e=>({label:e.label,href:e.href})));i(r)}))}),[t]);const s=e=>{n(),(0,E.Z)("event_toc_panel_goto"),(0,h.fb)(t)&&(t.display(e),t.display(e),r())};return(0,w.jsx)("div",{className:"panel panel__toc",children:(()=>{(0,E.Z)("event_toc_panel_show");let e=[];return(0,h.fb)(t)?(o.forEach(((t,r)=>{e.push((0,w.jsx)("div",{className:"panel__toc__item",onClick:()=>s(`${t.href}`),children:(0,w.jsx)("div",{className:"typo__body typo__body--1",children:t.label})},r))})),0===e.length&&e.push((0,w.jsx)("div",{className:"panel__empty",children:"No Items"},"empty")),e):""})()})}),qt=e=>{let{className:t="",value:r,onChange:n,min:o=0,max:i=100,step:s=1}=e;const l=(0,a.useRef)();return(0,a.useEffect)((()=>{if(!(0,h.fb)(l.current))return;let e=r/(i-o);l.current.style.setProperty("--progress",e)}),[r,o,i,l]),(0,w.jsx)("div",{ref:l,className:"range-slider "+t,children:(0,w.jsx)("input",{type:"range",value:r,onChange:n,min:o,max:i,step:s,className:"range-slider__input"})})};var At=r(16026),It=r(40696);const Tt=()=>{const e=(0,o.TH)(),t=(0,n.I0)(),r=(0,o.s0)(),d=(0,n.v9)((e=>e.BWalletState)),[_,m]=(0,a.useState)(0),[p,k]=(0,a.useState)(null),[b,g]=(0,a.useState)(!1),[y,N]=(0,a.useState)({}),[L,O]=(0,a.useState)(0),[R,C]=(0,a.useState)(),[z,M]=(0,a.useState)(!1),[W,q]=(0,a.useState)(!1),[A,I]=(0,a.useState)(!1),[T,H]=(0,a.useState)(!1),[B,$]=(0,a.useState)(0),[V,D]=(0,a.useState)(!1),[J,U]=(0,a.useState)(!1),[G,Y]=(0,a.useState)(null),[Q,K]=(0,a.useState)(!0),[X,ee]=(0,a.useState)({}),[te,re]=(0,a.useState)(!1),[ne,oe]=(0,a.useState)(""),[ae,ie]=(0,a.useState)(""),[se,le]=(0,a.useState)(""),[ce,de]=(0,a.useState)(!0),ue=l(L,300),fe=(0,a.useRef)(),he=(0,a.useRef)(),_e=(0,a.useRef)(!1),me=(0,a.useCallback)((()=>{It.Z.connectWallet().then((e=>{t((0,At.kH)(e.selectedAddress)),t((0,v.e1)({show:!0,message:"Wallet connected.",type:1}))})).catch((e=>{t((0,v.e1)({show:!0,message:"Error while connecting to wallet",type:4}))})).finally((()=>g(!1)))}),[t]),pe=(0,a.useCallback)((e=>{if((0,E.Z)("event_reader_lastPage_save"),!(0,h.fb)(window.localStorage))return;if(!(0,h.fb)(y))return;const t=`${y.id}:lastread`;localStorage.setItem(t,e)}),[y]),ve=(0,a.useCallback)((()=>{if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;const e=`${y.id}:bookmarks`;let t=window.localStorage.getItem(e);if(!(0,h.vd)(t))return!1;let r=JSON.parse(t)||{},n=new s.OS,o=R.currentLocation();try{return 0===n.compare(r.cfi,o.start.cfi)||(0===n.compare(r.cfi,o.end.cfi)||1===n.compare(r.cfi,o.start.cfi)&&-1===n.compare(r.cfi,o.end.cfi))}catch(a){return!1}}),[y,R]),ke=(0,a.useCallback)((()=>{(0,E.Z)("event_reader_page_bookmark");const e=ve();H(e)}),[ve]),be=(0,a.useCallback)((function(){let{customizer:e=!0,annotation:t=!0,quote:r=!0,toc:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,E.Z)("event_reader_panels_hide"),e&&D(!1),t&&q(!1),r&&I(!1),n&&U(!1)}),[]);(0,a.useEffect)((()=>{(0,E.Z)("page_view_reader")}),[]),(0,a.useEffect)((()=>{!0===z?((0,E.Z)("event_reader_screen_full"),ge()):((0,E.Z)("event_reader_screen_window"),we())}),[z]),(0,a.useEffect)((()=>{t(b?(0,F.yh)():(0,F.v3)())}),[b,t]),(0,a.useEffect)((()=>{g(!0),(0,h.fb)(d.smartAccount)?Y(d.smartAccount.address):me(),g(!1)}),[d,me]),(0,a.useEffect)((()=>{be()}),[Q,be]),(0,a.useEffect)((()=>{g(!0);let r=null;const n=e.state;(0,h.fb)(n.preview)&&!0===n.preview?((0,E.Z)("event_reader_mode_preview"),r=f._+"/files/"+n.book.preview,k(!0)):((0,E.Z)("event_reader_mode_live"),r=n.book.url,k(!1));try{const e=(0,s.ZP)(r,{openAs:"epub"});e.ready.then((()=>{const t=document.querySelector("#book__reader");t&&(t.innerHTML="");const r=e.renderTo("book__reader",{width:"100%",height:"100%",manager:"continuous",flow:"paginated",snap:"true",gap:40,allowScriptedContent:!0});r.themes.default(S),r.display(),C(r),g(!1)})).catch((e=>{t((0,v.e1)({show:!0,message:"Error while loading book.",type:4})),g(!1)})),N(n.book)}catch(o){t((0,v.e1)({show:!0,message:"Error while loading book.",type:4})),g(!1)}}),[e,t]),(0,a.useEffect)((()=>{if(!(0,h.fb)(R))return;const e=()=>{(0,E.Z)("event_reader_resize"),R.manager.resize("100%","100%")},t=()=>{(0,h.fb)(window.document.fullscreenElement)?((0,E.Z)("event_reader_fullscreen"),M(!0)):((0,E.Z)("event_reader_window"),M(!1)),e()};return window.addEventListener("resize",e),window.addEventListener("fullscreenchange",t),()=>{window.removeEventListener("resize",e),window.removeEventListener("fullscreenchange",t)}}),[R]),(0,a.useEffect)((()=>{(0,h.fb)(R)&&((0,h.fb)(se)||(0,h.vd)(se))&&R.book.loaded.navigation.then((function(){var e;let t=se,r=R.book.spine.get(t);if(!(0,h.fb)(r))return;let n=R.book.navigation.get(r.href);oe((null===n||void 0===n||null===(e=n.label)||void 0===e?void 0:e.trim())||"")}))}),[R,se]),(0,a.useEffect)((()=>{if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;const e=e=>{ke(),O(e.start.location),pe(e.start.cfi),le(e.start.cfi)},t=()=>{K((e=>!e))},r=e=>{(0,E.Z)("event_reader_navigate_keys"),"ArrowLeft"!==e.key&&37!==(e.keyCode||e.which)||R.prev(),"ArrowRight"!==e.key&&39!==(e.keyCode||e.which)||R.next()};return R.on("relocated",e),R.on("click",t),R.on("keyup",r),document.addEventListener("keyup",r),()=>{R.off("relocated",e),R.off("click",t),R.off("keyup",r),document.removeEventListener("keyup",r)}}),[R,y,ke,pe,le]),(0,a.useEffect)((()=>{if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;const e=`${y.id}:locations`;let t=localStorage.getItem(e);t?(R.book.locations.load(t),$(JSON.parse(t).length)):R.book.locations.generate().then((()=>{$(R.book.locations.total),localStorage.setItem(e,R.book.locations.save())})).catch((e=>{}))}),[R,y]),(0,a.useEffect)((()=>{(0,h.fb)(R)&&!0===_e.current&&(R.display(R.book.locations.cfiFromLocation(ue)),_e.current=!1)}),[ue,R,_e]),(0,a.useEffect)((()=>{if(!(0,h.fb)(window.localStorage))return;if(!(0,h.fb)(y))return;if(!(0,h.fb)(R))return;const e=`${y.id}:lastread`;let t=localStorage.getItem(e);(0,h.fb)(t)&&R.display(t)}),[y,R]),(0,a.useEffect)((()=>{if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;const e=(e,t)=>{(0,E.Z)("event_reader_content_selected"),R.book.getRange(e).then((t=>{ee({cfiRange:e,text:null===t||void 0===t?void 0:t.toString()}),re(!0)})).catch((()=>{ee({})}))};return R.on("selected",e),()=>{R.off("selected",e)}}),[R,y]),(0,a.useEffect)((()=>{if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;const e=(e,t,r)=>{q(!0)};return R.on("markClicked",e),()=>{R.off("markClicked",e)}}),[R,y]);const ge=()=>{xe();var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},we=()=>{xe(),document.fullscreenElement&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())};function xe(){de(!0),m(0)}return(0,a.useEffect)((()=>{if(!(0,h.fb)(y)&&!(0,h.fb)(G))return;let e=setInterval((()=>{m((e=>e+1))}),1e3);return()=>{clearInterval(e)}}),[y,G]),(0,a.useEffect)((()=>{_>=1e3&&(de(!1),m(0))})),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.q,{children:(0,w.jsx)("meta",{name:"Reader",content:"Book's Reader View"})}),(0,w.jsxs)("div",{className:"reader",children:[(0,w.jsxs)("div",{className:"reader__header"+(Q?" reader__header--show":""),children:[(0,w.jsxs)("div",{className:"reader__header__left",children:[(0,w.jsx)(c.Z,{type:"icon",onClick:()=>{r(-1)},children:(0,w.jsx)(We,{})}),(0,w.jsxs)("div",{className:"reader__header__left__timer",children:[(0,w.jsx)("span",{class:"reader__header__left__timer__dot"}),R&&(0,w.jsx)(x,{timerUpdate:ce,preview:p,bookMeta:y,rendition:R})]})]}),(0,w.jsx)("div",{className:"reader__header__center",children:(0,w.jsx)("div",{className:"typo__body--2 typo__color--n700 typo__transform--capital",children:y.title||"Untitled"})}),(0,w.jsxs)("div",{className:"reader__header__right",children:[(0,w.jsxs)(c.Z,{className:"reader__header__right__hide-on-mobile",type:"icon",onClick:()=>M((e=>!e)),children:[" ",z?(0,w.jsx)(kt,{}):(0,w.jsx)(st,{})," "]}),(0,w.jsxs)(c.Z,{type:"icon",className:J?"reader__header__right__button--active":"",onClick:()=>{be({toc:!1}),U((e=>!e)),xe()},children:[" ",(0,w.jsx)(Lt,{})," "]}),(0,w.jsxs)(c.Z,{type:"icon",className:W?"reader__header__right__button--active":"",onClick:()=>{be({annotation:!1}),q((e=>!e)),xe()},children:[" ",(0,w.jsx)(ot.r,{})," "]}),(0,w.jsxs)(c.Z,{type:"icon",className:A?"reader__header__right__button--active":"",onClick:()=>{be({quotePanel:!1}),I((e=>!e)),xe()},children:[" ",(0,w.jsx)(Mt,{})," "]}),(0,w.jsx)(c.Z,{type:"icon",className:T?"reader__header__right__button--active":"",onClick:()=>{xe(),!0===ve()?(()=>{if((0,E.Z)("event_bookmarkpanel_bookmark_remove"),(0,h.fb)(p)&&!p&&(0,h.fb)(y)&&(0,h.fb)(G)){if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;g(!0),u()({url:`${f._}/api/reader/bookmarks`,method:"POST",data:{bookAddress:y.book_address,ownerAddress:G,bookmarks:""}}).then((e=>{if(200===e.status){const e=`${y.id}:bookmarks`;localStorage.setItem(e,""),ke()}else t((0,v.e1)("NOT200"))})).catch((e=>{t((0,v.e1)("ERROR"))})).finally((()=>g(!1)))}})():(()=>{if((0,E.Z)("event_bookmarkpanel_bookmark"),(0,h.fb)(p)&&!p&&(0,h.fb)(y)&&(0,h.fb)(G)){if(!(0,h.fb)(R))return;if(!(0,h.fb)(y))return;g(!0);let e={cfi:R.currentLocation().start.cfi,percent:R.currentLocation().start.percentage};u()({url:`${f._}/api/reader/bookmarks`,method:"POST",data:{bookAddress:y.book_address,ownerAddress:G,bookmarks:JSON.stringify(e)}}).then((r=>{if(200===r.status){const t=`${y.id}:bookmarks`;localStorage.setItem(t,JSON.stringify(e)),ke()}else t((0,v.e1)("NOT200"))})).catch((e=>{t((0,v.e1)("ERROR"))})).finally((()=>g(!1)))}})()},children:(0,w.jsx)(He,{})}),(0,w.jsx)(c.Z,{type:"icon",className:V?"reader__header__right__button--active":"",onClick:()=>{be({customizer:!1}),D((e=>!e)),xe()},children:(0,w.jsx)(Ge,{})})]})]}),(0,w.jsxs)("div",{className:"reader__container",children:[A?null:(0,w.jsxs)("div",{className:"quotes__discussions ",children:["Discussions:",(0,w.jsx)("div",{className:"quotes__discussions__count",children:ae})]}),(0,w.jsx)("div",{className:T?"reader__container__bookmark reader__container__bookmark--show":"reader__container__bookmark"}),(0,w.jsx)("div",{className:"reader__container__prev-btn",children:(0,w.jsx)("div",{className:"reader__container__prev-btn__button",onClick:()=>{R.prev(),xe()},children:(0,w.jsx)(We,{width:32,stroke:"currentColor"})})}),(0,w.jsx)("div",{id:"book__reader",className:"reader__container__book"}),(0,w.jsx)("div",{className:"reader__container__next-btn",children:(0,w.jsx)("div",{className:"reader__container__next-btn__button",onClick:()=>{R.next(),xe()},children:(0,w.jsx)(Te,{width:32,stroke:"currentColor"})})}),!p&&(0,w.jsx)("div",{className:te?"reader__container__context-menu-container reader__container__context-menu-container--show":"reader__container__context-menu-container",children:(0,w.jsx)(Re,{onColorSelect:e=>{(e=>{xe(),(0,h.fb)(X)&&(0,h.fb)(R)&&(0,h.fb)(y)&&(0,h.fb)(fe.current)&&"function"===typeof fe.current&&fe.current({...X,color:e})})(e),re(!1)},onClose:()=>re(!1)})}),(0,w.jsx)(j,{show:J,setShow:U,position:"right",title:"Table of Content",children:(0,w.jsx)(Wt,{onSelect:()=>{be({toc:!1}),U(!1)},rendition:R})}),(0,w.jsx)(j,{show:W,setShow:q,position:"right",title:"Annotations",children:(0,w.jsx)(P,{preview:p,rendition:R,bookMeta:y,show:W,addAnnotationRef:fe,hideModal:()=>{q(!1),xe()},onRemove:()=>{q(!1)}})}),(0,w.jsx)(j,{show:A,setShow:I,position:"right",title:"Discussions",children:(0,w.jsx)(Oe,{setDiscCount:ie,preview:p,rendition:R,bookMeta:y,show:A,addQuotesRef:he,hideModal:()=>{I(!1)}})}),(0,w.jsx)(j,{show:V,setShow:D,position:"right-bottom",title:"Preferences",children:(0,w.jsx)(Z,{initialFontSize:100,rendition:R})})]}),(0,w.jsxs)("nav",{className:"reader__nav"+(Q?" reader__nav--show":""),children:[(0,w.jsxs)("div",{className:"reader__nav__value",children:[(0,w.jsx)("div",{className:"reader__nav__value__chapter-title typo__gray--n600 typo__transform--capital",children:ne||y.title||""}),(0,w.jsxs)("div",{children:[Math.floor(100*ue/B)||"0","%"]})]}),(0,w.jsx)("div",{className:"reader__nav__progress",children:(0,w.jsx)(qt,{value:L,onChange:e=>{xe(),_e.current=!0,O(e.target.value)},max:B,className:"reader__nav__progress"})})]})]})]})}}}]);
//# sourceMappingURL=696.11abfa69.chunk.js.map