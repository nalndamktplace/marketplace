"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[839],{50906:(e,a,t)=>{t.d(a,{r:()=>i});var s,r,o=t(72791);function n(){return n=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},n.apply(this,arguments)}function c(e,a){let{title:t,titleId:c,...i}=e;return o.createElement("svg",n({xmlns:"http://www.w3.org/2000/svg",width:48,height:48,viewBox:"0 0 48 48",ref:a,"aria-labelledby":c},i),t?o.createElement("title",{id:c},t):null,s||(s=o.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 8)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})),r||(r=o.createElement("rect",{width:32,height:12,rx:2,transform:"translate(8 28)",fill:"none",stroke:"currentcolor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3.6})))}const i=o.forwardRef(c);t.p},59839:(e,a,t)=>{t.r(a),t.d(a,{default:()=>E});var s=t(74569),r=t.n(s),o=t(16030),n=t(16871),c=t(72791),i=t(54270),l=t(40696),d=t(44643),_=t(29316),u=t(4127),h=t(88952),f=t(75454),b=t(40354),p=t(65248),k=t(50639),y=t(56759),m=t(72808),v=t(15602),g=t(50906),x=t(95899),j=t(298),w=t(80184);const E=e=>{const{connect:a,address:t,provider:s}=(0,j.dD)(),E=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"},{key:"decayscore",value:null,type:"range"}],N=(0,n.TH)(),R=(0,n.s0)(),O=(0,o.I0)(),S=(0,o.v9)((e=>e.UserState)),T=(0,o.v9)((e=>e.BWalletState)),[L,Z]=(0,c.useState)([]),[C,I]=(0,c.useState)([]),[A,P]=(0,c.useState)(E),[G,D]=(0,c.useState)(!1),[H,B]=(0,c.useState)(0),[W,F]=(0,c.useState)(null),[M,$]=(0,c.useState)(!1),[z,q]=(0,c.useState)(window.innerWidth<600?"LIST":"GRID"),[U,J]=(0,c.useState)(100);(0,c.useEffect)((()=>{(0,x.Z)("page_view_account")}),[]),(0,c.useEffect)((()=>{0===H?(0,x.Z)("tab_view_account_owned"):(0,x.Z)("tab_view_account_published")}),[H]);const K=(0,c.useCallback)((()=>{t||(async()=>{a()})(),(0,l.Z)(s,O)}),[O]);(0,c.useEffect)((()=>{(0,x.Z)("event_library_filter");let e=C;(0,_.fb)(e)&&(A.forEach((a=>{switch(a.type){case"range":(0,_.fb)(a.value)&&(e=e.filter((e=>e[a.key]<=a.value)));break;case"multiselect":if((0,_.vd)(a.value)){let t=[];a.value.forEach((s=>e.forEach((e=>{e[a.key].indexOf(s)>-1&&t.filter((a=>a.id===e.id)).length<1&&t.push(e)})))),e=t}break;case"select":if("orderby"===a.key)switch(a.value){case"PRICE_L_H":e.sort(((e,a)=>e.price<a.price));break;case"PRICE_H_L":e.sort(((e,a)=>e.price>a.price));break;case"RATING_L_H":e.sort(((e,a)=>e.rating<a.rating));break;case"RATING_H_L":e.sort(((e,a)=>e.rating>a.rating))}}})),Z(e))}),[A,C]),(0,c.useEffect)((()=>{if((0,_.fb)(N.state)){const e=N.state.tab;B("published"===e?1:0)}}),[N]),(0,c.useEffect)((()=>{D(!0),(0,_.fb)(T.smartAccount)?F(T.smartAccount.address):K(),D(!1)}),[T,K]),(0,c.useEffect)((()=>{O(G?(0,u.yh)():(0,u.v3)())}),[G,O]),(0,c.useEffect)((()=>{(0,_.Pc)(S)&&(D(!0),0===H?r()({url:p._+"/api/user/books/owned",method:"GET",headers:{"user-id":S.user.uid,authorization:`Bearer ${S.tokens.acsTkn.tkn}`},params:{userAddress:W}}).then((e=>{200===e.status?I(e.data):O((0,d.e1)("NOT200"))})).catch((e=>{O((0,d.e1)("ERROR"))})).finally((()=>D(!1))):1===H&&r()({url:p._+"/api/user/books/published",method:"GET",headers:{"user-id":S.user.uid,authorization:`Bearer ${S.tokens.acsTkn.tkn}`},params:{userAddress:W}}).then((e=>{200===e.status?I(e.data):O((0,d.e1)("NOT200"))})).catch((e=>{O((0,d.e1)("ERROR"))})).finally((()=>D(!1))))}),[H,W,O,S]),(0,c.useEffect)((()=>{if(!(0,_.vd)(C))return;let e=Math.max(...C.map((e=>e.price)));e=10*Math.ceil(e/10),J(e||100)}),[C]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.q,{children:(0,w.jsx)("meta",{name:"Library",content:"Explore library of  books"})}),(0,w.jsx)(h.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,w.jsxs)("div",{className:"account__data",children:[(0,w.jsx)("div",{className:"account__data__filter-panel-container","data-filter-open":M,children:(0,w.jsx)(b.Z,{maxPrice:U,setFiltersPanelOpen:$,config:k.K,defaults:E,filters:A,setFilters:P})}),(0,w.jsxs)("div",{className:"account__data__books","data-filter-open":M,children:[(0,w.jsxs)("div",{className:"account__data__books__header",children:[(0,w.jsxs)("div",{className:"account__data__books__header__filter",children:[(0,w.jsx)(f.Z,{type:"icon",onClick:()=>$((e=>!e)),children:(0,w.jsx)(m.r,{fill:M?"currentColor":"transparent"})}),(0,w.jsxs)("div",{className:"account__data__books__header__filter__tabs",children:[(0,w.jsx)("div",{onClick:()=>B(0),className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":0===H,children:"Library"}),(0,w.jsx)("div",{onClick:()=>B(1),className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":1===H,children:"Published"})]})]}),(0,w.jsxs)("div",{className:"account__data__books__header__layout",children:[(0,w.jsxs)(f.Z,{className:"account__data__books__header__layout__button",onClick:()=>q("LIST"),children:[(0,w.jsx)(g.r,{}),(0,w.jsx)("span",{children:"List"})]}),(0,w.jsxs)(f.Z,{className:"account__data__books__header__layout__button",onClick:()=>q("GRID"),children:[(0,w.jsx)(v.r,{}),(0,w.jsx)("span",{children:"GRID"})]})]})]}),(0,w.jsx)("div",{className:"account__data__books__wrapper","data-layout":z,children:(0,_.fb)(L)&&L.length>0?(()=>{let e=[];return L.forEach((a=>{e.push((0,w.jsx)(y.Z,{state:a.publisher_address===W?"publisher":"owned",layout:z,book:a,onRead:()=>(async e=>{D(!0);try{r()({url:`${p._}/api/verify`,method:"GET",params:{bookAddress:e.book_address,ownerAddress:W}}).then((a=>{if(200===a.status){const t=a.data;l.Z.signMessage(T.smartAccount.signer,JSON.stringify(t)).then((a=>{!0===a.isValid?r()({url:p._+"/api/verify",method:"POST",data:{accountAddress:W,bookAddress:e.book_address,signedData:a.signedData,cid:e.book.slice(e.book.lastIndexOf("/")+1)}}).then((a=>{200===a.status?((0,x.Z)("navigate_book_reader"),R("/library/reader",{state:{book:{...e,submarineURL:a.data.url},preview:!1}})):O((0,d.e1)({show:!0,message:"Error",type:4}))})).catch((e=>{})).finally((()=>D(!1))):O((0,d.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else O((0,d.e1)("NOT200"))}))}catch(a){D(!1)}})(a),onOpen:()=>(e=>{(0,x.Z)("navigate_account_book"),R(`/book/${e.id}`)})(a)},a.id))})),e})():(0,w.jsxs)("div",{className:"account__data__books__wrapper__empty",children:[(0,w.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"account__data__books__wrapper__image",loading:"lazy"}),(0,w.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]})})]})}}}]);
//# sourceMappingURL=839.75cabbad.chunk.js.map