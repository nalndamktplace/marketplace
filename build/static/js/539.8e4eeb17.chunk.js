"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[539],{98535:(e,a,s)=>{s.d(a,{Z:()=>g});var t=s(16030),o=s(72791),_=s(88062),r=s(83374),d=s(38308),n=s(4127),i=s(55169),c=s(29316),l=s(32669),p=s(17303),h=s(6222),u=s(74569),m=s.n(u),b=s(44643),k=s(65248),y=s(43935),f=s(87928),v=s(14605);const g=()=>{var e,a;const s=(0,t.v9)((e=>e.UserState)),u=(0,t.v9)((e=>e.BWalletState)),g=(0,l.Z)(),x=(0,t.I0)(),w=(0,d.mA)(),[j,N]=(0,o.useState)(!1),R={address:g.getAddress(),"user-id":s.user.uid,authorization:`Bearer ${null===(e=s.tokens)||void 0===e||null===(a=e.acsTkn)||void 0===a?void 0:a.tkn}`};let E=null;const A=async(e,a,s)=>{try{N(!0);const t=await m().post(`${k._}/api/book/crypto/order/wc`,{amount:a},{headers:R});200===t.status&&(E=t.data.id);const o=new p.vU(["function approve(address spender, uint256 amount)"]),d=g.getAddress(),n=o.encodeFunctionData("approve",[e,h.parseEther(a.toString())]),l=(i.ZZ,new p.vU(["function safeMint(address to)"]).encodeFunctionData("safeMint",[d])),y={to:e,data:l};u.smartAccount.on("txMined",(async t=>{const o=t.receipt.transactionHash,n=t.receipt.logs.filter((a=>a.address===e&&4===a.topics.length&&(0,c.vd)(a.topics.filter((e=>e===(0,_.keccak256)((0,r.Y0)("Transfer(address,address,uint256)"))&&(0,c.vd)(a.topics[a.topics.length-1]))))));if((0,c.vd)(n)){m().post(`${k._}/api/book/crypto/mine`,{transactionId:E,wallet:g.getAddress(),hash:o},{headers:R});const t=parseInt(n[0].topics[n[0].topics.length-1]);m()({url:`${k._}/api/book/copies`,method:"POST",data:{bookAddress:e,copies:t}}).then((e=>{})).catch((e=>{}));const _={ownerAddress:d,bookAddress:e,tokenId:t,purchasePrice:a};200===(await m().post(`${k._}/api/book/purchase`,_,{headers:R})).status?s():x((0,b.e1)("NOT200")),N(!1)}})),u.smartAccount.on("error",(e=>{m().post(`${k._}/api/book/crypto/error/bc`,{transactionId:E,error:e},{headers:R}),N(!1),x((0,b.e1)("ERROR"))}));const f=[y],v=await u.smartAccount.prepareRefundTransactionBatch({transactions:f}),w=await u.smartAccount.createRefundTransactionBatch({transactions:f,feeQuote:v[1]});await u.smartAccount.sendTransaction({tx:w,gasLimit:{hex:i.Lw,type:"hex"}})}catch(t){m().post(`${k._}/api/book/crypto/error/bc`,{transactionId:E,error:t},{headers:R}),N(!1),x((0,b.e1)("ERROR"))}},T=async(e,a,s,t,o,d,n,l,y,f,w,j,R,E,A,T,O,S,B)=>{try{const Z=new p.vU(["function createNewBook(address _author, string memory _coverURI, uint256 _initialPrice, uint256 _daysForSecondarySales, uint256 _lang, uint256[] memory _genre )"]),$=u.smartAccount.address,P=Z.encodeFunctionData("createNewBook",[$,e,h.parseEther(a),s,t,o]),I={to:v.Hb,data:P};u.smartAccount.on("txMined",(s=>{s.receipt.logs.forEach((t=>{t.topics.forEach((o=>{if(o===(0,_.keccak256)((0,r.Y0)("OwnershipTransferred(address,address)"))){const o=t.address,_=s.receipt.transactionHash,r=s.receipt.status;if((0,c.fb)(o)&&(0,c.fb)(r)&&1===r&&(0,c.fb)(_)){let s=new FormData;s.append("epub",d),s.append("name",n),s.append("author",l),s.append("cover",e),s.append("coverFile",y),s.append("book",f),s.append("genres",w),s.append("ageGroup",j),s.append("price",a),s.append("pages",R),s.append("publication",E),s.append("synopsis",A),s.append("language",T),s.append("published",O),s.append("secondarySalesFrom",S),s.append("publisherAddress",g.getAddress()),s.append("bookAddress",o),s.append("txHash",_),m()({url:k._+"/api/book/publish",method:"POST",data:s}).then((e=>{200===e.status?B():x((0,b.e1)("ERROR"))})).catch((e=>{(0,c.fb)(e.response)?413===e.response.status?x((0,b.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&x((0,b.e1)("INVALID_FILE_TYPE")):x((0,b.e1)("NOT200")),N(!1)}))}else N(!1),(0,c.fb)(_)?x((0,b.e1)({show:!0,message:`The transaction to mint eBook failed.\ntxhash: ${_}`,type:3})):x((0,b.e1)({show:!0,message:"The transaction to mint eBook failed.",type:3}))}}))}))})),u.smartAccount.on("error",(e=>{N(!1),x((0,b.e1)("ERROR"))}));const C=await u.smartAccount.prepareRefundTransaction({transaction:I}),F=await u.smartAccount.createRefundTransaction({transaction:I,feeQuote:C[1]});await u.smartAccount.sendTransaction({tx:F,gasLimit:{hex:i.Lw,type:"hex"}})}catch(Z){N(!1),x((0,b.e1)("ERROR"))}},O=async(e,a,s)=>{const t=await m().post(`${k._}/api/book/crypto/order/wc`,{amount:a},{headers:R});200===t.status&&(E=t.data.id),N(!0),y.Z.purchaseNft(g.getAddress(),e,a.toString(),g.getSigner()).then((t=>{x((0,b.e1)({show:!0,message:"Book purchased.",type:1})),x((0,f.VG)());const o=Number(t.events.filter((e=>"Transfer(address,address,uint256)"===e.eventSignature))[0].args[2]._hex);m().post(`${k._}/api/book/crypto/mine`,{transactionId:E,wallet:g.getAddress(),hash:t.transactionHash},{headers:R}),m()({url:k._+"/api/book/purchase",method:"POST",data:{ownerAddress:g.getAddress(),bookAddress:e,tokenId:o,purchasePrice:a}}).then((e=>{200===e.status?s():x((0,b.e1)("NOT200"))})).catch((e=>{x((0,b.e1)("ERROR"))})).finally((()=>N(!1))),m()({url:k._+"/api/book/copies",method:"POST",data:{bookAddress:e,copies:o}}).then((e=>{})).catch((e=>{}))})).catch((e=>{var a,s;(m().post(`${k._}/api/book/crypto/error/bc`,{transactionId:E,error:e},{headers:R}),N(!1),e.message)?(null===e||void 0===e||null===(a=e.message)||void 0===a?void 0:a.indexOf("execution reverted: ERC20: transfer amount exceeds balance"))>-1?x((0,b.e1)({show:!0,message:"You do not have enough USDC to purchase this book. Please visit the faucet to get some.",type:3})):(null===e||void 0===e||null===(s=e.message)||void 0===s?void 0:s.indexOf("execution reverted: NalndaBook: Book unapproved from marketplace!"))>-1?x((0,b.e1)({show:!0,message:"The book has not been approved for sales yet. Please try again later.",type:3})):4001===e.code&&x((0,b.e1)({show:!0,message:"Transaction denied by user.",type:3})):x((0,b.e1)("ERROR"))}))},S=(e,a,s,t,o,_,r,d,n,i,l,p,h,u,f,v,w,j,R)=>{try{y.Z.listNftForSales(g.getAddress(),e,a,s,t,o,g.getSigner()).then((s=>{const t=s.events.filter((e=>"OwnershipTransferred"===e.event))[0].address,o=s.status,y=s.transactionHash;if((0,c.fb)(t)&&(0,c.fb)(o)&&1===o&&(0,c.fb)(y)){let s=new FormData;s.append("epub",_),s.append("name",r),s.append("author",d),s.append("cover",e),s.append("coverFile",n),s.append("book",i),s.append("genres",l),s.append("ageGroup",p),s.append("price",a),s.append("pages",h),s.append("publication",u),s.append("synopsis",f),s.append("language",v),s.append("published",w),s.append("secondarySalesFrom",j),s.append("publisherAddress",g.getAddress()),s.append("bookAddress",t),s.append("txHash",y),m()({url:k._+"/api/book/publish",method:"POST",data:s}).then((e=>{200===e.status?R():x((0,b.e1)("ERROR"))})).catch((e=>{(0,c.fb)(e.response)?413===e.response.status?x((0,b.e1)("LIMIT_FILE_SIZE")):415===e.response.status&&x((0,b.e1)("INVALID_FILE_TYPE")):x((0,b.e1)("NOT200")),N(!1)}))}else N(!1),(0,c.fb)(y)?x((0,b.e1)({show:!0,message:`The transaction to mint eBook failed.\ntxhash: ${y}`,type:3})):x((0,b.e1)({show:!0,message:"The transaction to mint eBook failed.",type:3}))})).catch((e=>{x((0,b.e1)("NOT200")),N(!1)}))}catch(E){N(!1),x((0,b.e1)("ERROR"))}};return(0,o.useEffect)((()=>{x(j?(0,n.yh)():(0,n.v3)())}),[j,x]),{purchaseBook:(e,a,s)=>w.isConnected?O(e,a,s):A(e,a,s),publishBook:(e,a,s,t,o,_,r,d,n,i,c,l,p,h,u,m,b,k,y)=>w.isConnected?S(e,a,s,t,o,_,r,d,n,i,c,l,p,h,u,m,b,k,y):T(e,a,s,t,o,_,r,d,n,i,c,l,p,h,u,m,b,k,y)}}},14539:(e,a,s)=>{s.r(a),s.d(a,{default:()=>q});var t=s(74569),o=s.n(t),_=s(72426),r=s.n(_),d=s(16030),n=s(16871),i=s(72791),c=s(54270),l=s(88952),p=s(43935),h=s(4254),u=s(75454),m=s(90709),b=s(85807),k=s(46472),y=s(77107),f=(s(40696),s(95899)),v=s(65248),g=s(29316),x=s(44643),w=s(4127),j=s(87928),N=s(37793),R=s(25897),E=s(23358),A=s(40116),T=s(88465),O=s(33653),S=s(70476),B=s(7445),Z=s(96744),$=s(1692),P=s(14998),I=s(7215),C=s(88079),F=s(65748),G=(s(298),s(98535)),z=s(32669);const M=()=>{const e=(0,d.v9)((e=>e.UserState)),a=(0,z.Z)(),s=(0,d.I0)(),[t,_]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{s(t?(0,w.yh)():(0,w.v3)())}),[t,s]),{collectPayment:async(t,r,d,n,i,c,l,p)=>{_(!0);const h=await(u="https://checkout.razorpay.com/v1/checkout.js",new Promise((e=>{const a=document.createElement("script");a.src=u,a.onload=()=>{e(!0)},a.onerror=()=>{e(!1)},document.body.appendChild(a)})));var u;_(!1),h||alert("Razorpay SDK failed to load. Are you online?");const m=await o().post(`${v._}/api/book/fiat/order`,{amount:100*t,currency:"INR"},{headers:{address:a.getAddress(),"user-id":e.user.uid,authorization:`Bearer ${e.tokens.acsTkn.tkn}`}});m||alert("Server error. Are you online?");const{amount:b,id:k,currency:y}=m.data,f={key:"rzp_test_b6S0NAjuFymj4M",amount:b.toString(),currency:y,name:"Nalnda Marketplace",description:`${r} by ${d}`,image:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/779d7e7d-76f3-41e7-8e3c-457d77865300/square160",order_id:k,handler:async function(r){_(!0);const d={orderCreationId:k,razorpayPaymentId:r.razorpay_payment_id,razorpayOrderId:r.razorpay_order_id,razorpaySignature:r.razorpay_signature,bookAddress:n,bookPrice:t},i={address:a.getAddress(),"user-id":e.user.uid,authorization:`Bearer ${e.tokens.acsTkn.tkn}`};200===(await o().post(`${v._}/api/book/fiat/mint`,d,{headers:i})).status?(s((0,x.e1)({show:!0,message:"Purchase Successful! Book has been added to your library.",type:1})),p()):s((0,x.e1)("NOT200")),_(!1)},prefill:{name:i,email:c,contact:l},notes:{bookAddress:n},theme:{color:"#61dafb"}};new window.Razorpay(f).open()}}};var L=s(80184);const q=e=>{const a=[{id:"TAB01",label:"Synopsis",icon:(0,L.jsx)(Z.r,{})},{id:"TAB02",label:"reviews",icon:(0,L.jsx)(B.r,{})},{id:"TAB03",label:"quotes",icon:(0,L.jsx)(P.r,{})}],s=(0,n.UO)(),t=(0,z.Z)(),_=(0,d.I0)(),q=(0,n.s0)(),Y=M(),D=(0,N.Z)(),U=(0,G.Z)(),H=(0,d.v9)((e=>e.UserState)),K=(0,d.v9)((e=>e.BWalletState)),[Q,V]=(0,i.useState)(t.getAddress()),[W,J]=(0,i.useState)(!1),[X,ee]=(0,i.useState)("TAB01"),[ae,se]=(0,i.useState)(null),[te,oe]=(0,i.useState)(null),[_e,re]=(0,i.useState)(null),[de,ne]=(0,i.useState)(null),[ie,ce]=(0,i.useState)(null),[le,pe]=(0,i.useState)(null),[he,ue]=(0,i.useState)(0),[me,be]=(0,i.useState)(!1),[ke,ye]=(0,i.useState)(0),[fe,ve]=(0,i.useState)(null),[ge,xe]=(0,i.useState)([]),[we,je]=(0,i.useState)(0),[Ne,Re]=(0,i.useState)({title:"",body:"",rating:0}),[Ee,Ae]=(0,i.useState)(null),[Te,Oe]=(0,i.useState)([]),[Se,Be]=(0,i.useState)({quote:""}),[Ze,$e]=(0,i.useState)(0),[Pe,Ie]=(0,i.useState)(0),[Ce,Fe]=(0,i.useState)(0),Ge=(0,i.useRef)();(0,i.useEffect)((()=>{(0,f.Z)("page_view_book")}),[]),(0,i.useEffect)((()=>{"TAB01"===X?(0,f.Z)("tab_view_book_synopsis"):"TAB02"===X?(0,f.Z)("tab_view_book_reviews"):(0,f.Z)("tab_view_book_quotes")}),[X]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&re(1===ae.listed)}),[ae]);const ze=(0,i.useCallback)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/book/reviews`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status?(xe(e.data.reviews),ye(e.data.rating),je(e.data.total)):_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),Me=(0,i.useCallback)((()=>{(0,g.fb)(ae)&&(0,g.fb)(Q)&&(J(!0),o()({url:`${v._}/api/book/reviewed`,method:"GET",params:{bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{200===e.status&&(0,g.UE)(e.data)&&ve(e.data)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,Q,_]),Le=(0,i.useCallback)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/book/quotes`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status?Oe(e.data):204===e.status||_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),qe=(0,i.useCallback)((()=>{(0,g.fb)(ae)&&(0,g.fb)(Q)&&(J(!0),o()({url:`${v._}/api/book/quoted`,method:"GET",params:{bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{200===e.status&&(0,g.UE)(e.data)&&Ae(e.data)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,Q,_]);(0,i.useEffect)((()=>{ze()}),[ze]),(0,i.useEffect)((()=>{Me()}),[Me]),(0,i.useEffect)((()=>{Le()}),[Le]),(0,i.useEffect)((()=>{qe()}),[qe]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/book/likes`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status?ue(e.data.likes):_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(0,g.fb)(Q)&&(J(!0),o()({url:`${v._}/api/book/liked`,method:"GET",params:{bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{200===e.status&&be(e.data.liked)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,Q,_]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/reader/total-reader-count`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status&&$e(e.data.total_readers)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/reader/count`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status&&Ie(e.data.reader_count)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(J(!0),o()({url:`${v._}/api/reader/total-read-time`,method:"GET",params:{bookAddress:ae.book_address}}).then((e=>{200===e.status&&Fe(e.data.total_read_time)})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))}),[ae,_]),(0,i.useEffect)((()=>{(0,g.fb)(fe)&&Re({title:fe.title,body:fe.body,rating:fe.rating})}),[fe]),(0,i.useEffect)((()=>{const e=s.bookID;o()({url:`${v._}/api/book`,method:"GET",params:{id:e}}).then((e=>{se(e.data[0])}))}),[s]),(0,i.useEffect)((()=>{if((0,g.fb)(Q)&&(0,g.fb)(ae)){J(!0);const e=ae;e.new_owner===Q?oe(!0):oe(!1),e.publisher_address===Q?ce(!0):ce(!1),o()({url:v._+"/api/book/owner",method:"GET",params:{ownerAddress:Q,bookAddress:e.book_address}}).then((e=>{J(!1),200===e.status&&oe(!0)})).catch((e=>{J(!1)}))}}),[ae,s,_,Q]),(0,i.useEffect)((()=>{(0,g.fb)(ae)&&(0,g.fb)(ie)&&(0,g.fb)(te)&&J(!1)}),[ae,ie,te]),(0,i.useEffect)((()=>{_(W?(0,w.yh)():(0,w.v3)())}),[W,_]),(0,i.useEffect)((()=>{let e=document.getElementById("BOOK_PAGE_"+X);(0,g.fb)(e)&&(0,g.fb)(Ge.current)&&Ge.current.style.setProperty("--marker-x",e.offsetLeft)}),[X]),(0,i.useEffect)((()=>{te&&o()({url:`${v._}/api/user/book`,method:"GET",headers:{"user-id":H.user.uid,address:Q,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},params:{walletAddress:Q,bookAddress:ae.book_address}}).then((e=>{200===e.status?(ne(e.data),re(e.data.listed)):204===e.status||_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))}))}),[te,H,_,ae,Q]);const Ye=async()=>{(0,f.Z)("event_book_read"),J(!0);try{o()({url:`${v._}/api/verify/mobile`,method:"POST",headers:{address:Q,"user-id":H.user.uid,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},data:{bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{J(!1),200===e.status?((0,f.Z)("navigate_book_reader"),q("/library/reader",{state:{book:{...ae,url:`${e.data.base}?token=${e.data.token}&cid=${e.data.cid}&fileName=${e.data.fileName}`}}})):_((0,x.e1)("NOT200"))})).catch((e=>{var a;J(!1),401===(null===(a=e.response)||void 0===a?void 0:a.status)?_((0,x.e1)({show:!0,message:"Please purchase the book first.",type:3})):_((0,x.e1)("ERROR"))}))}catch(e){J(!1)}},De=()=>oe(!0);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(c.q,{children:(0,L.jsx)("meta",{name:"Book's Page",content:"Buy & Read the book you like"})}),(0,L.jsxs)(l.Z,{children:[(0,L.jsx)("div",{className:"book__bg",children:(0,L.jsx)("img",{src:R.Z,alt:"background",loading:"lazy"})}),(0,g.fb)(ae)?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"book__data",children:[(0,L.jsx)("div",{className:"book__data__background"}),(0,L.jsxs)("div",{className:"book__data__container",children:[(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"book__data__container__cover",children:(0,L.jsx)("img",{className:"book__data__container__cover__image",src:ae.cover_display_url?ae.cover_display_url:ae.cover_public_url?ae.cover_public_url:ae.cover,alt:ae.name})}),(0,L.jsxs)("div",{className:"book__data__container__meta",children:[(0,L.jsx)("h3",{className:"typo__color--n700 typo__head typo__head--3 typo__transform--capital",children:ae.title}),(0,L.jsx)("h5",{className:"typo__color--n500 typo__head typo__head--6 typo__transform--upper",children:ae.author}),(0,L.jsxs)("div",{className:"book__data__container__meta__rating",children:[(0,L.jsx)("div",{className:"book__data__container__meta__rating__stars",children:(0,L.jsx)(h.Z,{size:"small",rating:ke})}),(0,L.jsxs)("div",{className:"book__data__container__meta__rating__count typo__body",children:[we," reviews"]})]}),(0,L.jsx)("div",{className:"book__data__container__meta__cta",children:_e?(0,L.jsx)(u.Z,{type:"primary",size:"lg",onClick:()=>((0,f.Z)("event_book_unlist"),void((0,g.fb)(Q)&&(J(!0),o()({url:v._+"/api/user/book/listed",method:"GET",headers:{"user-id":H.user.uid,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},params:{ownerAddress:Q,tokenId:de.token_id,bookAddress:ae.book_address}}).then((e=>{if(200===e.status){J(!0);const a=e.data.order_id;p.Z.unlistBookFromMarketplace(a,K.smartAccount.signer).then((e=>{J(!0),o()({url:v._+"/api/book/unlist",method:"POST",data:{ownerAddress:Q,bookAddress:ae.book_address}}).then((e=>{200===e.status?(re(!1),_((0,j.VG)()),_((0,x.e1)({show:!0,message:"Book unlisted from marketplace.",type:1}))):_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>{J(!1)}))})).catch((e=>{J(!1),(0,g.fb)(e.reason)?e.reason.includes("NFT not yet listed / already sold")&&_((0,x.e1)({show:!0,message:"eBook already sold or not listed.",type:3})):_((0,x.e1)("ERROR"))}))}else _((0,x.e1)("NOT200"))})).catch((e=>{J(!1),_((0,x.e1)("ERROR"))}))))),children:"Unlist"}):ie?(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(u.Z,{type:"primary",size:"lg",onClick:()=>Ye(),children:"Read"})}):te?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(u.Z,{type:"primary",size:"lg",onClick:()=>Ye(),children:"Read"}),(0,L.jsx)(u.Z,{onClick:()=>(_((0,j.K4)(j.gG)),void(r()(ae.secondary_sales_from).isSame(r()())||r()(ae.secondary_sales_from).isBefore(r()())?_((0,j.K4)(j.gG)):r()(ae.secondary_sales_from).isAfter(r()())&&_((0,x.e1)({show:!0,message:`Secondary Sales will open only after ${r()(ae.secondary_sales_from).format("D MMM, YYYY")}.`,type:2})))),children:"List"})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(u.Z,{type:"primary",size:"lg",onClick:()=>U.purchaseBook(ae.book_address,ae.price,De),children:[(0,L.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",ae.price]}),(0,L.jsxs)(u.Z,{type:"primary",size:"lg",onClick:()=>Y.collectPayment(ae.price,ae.title,ae.author,ae.book_address,H.user.name.join(", "," "),H.user.email,null,De),children:["$\xa0",ae.price]}),(0,L.jsx)(u.Z,{onClick:()=>((0,f.Z)("navigate_book_preview"),void q("/book/preview",{state:{book:ae,preview:!0}})),children:"Preview"})]})})]})]}),(0,L.jsxs)("div",{className:"book__data__container__desc",children:[(0,L.jsx)("div",{className:"book__data__container__desc__left",children:(0,L.jsxs)("div",{className:"book__data__container__desc__summary",children:[(0,L.jsxs)("div",{className:"book__data__container__desc__summary__contract",onClick:()=>window.open(`https://mumbai.polygonscan.com/address/${ae.book_address}`,"_blank"),children:[(0,L.jsxs)("div",{className:"book__data__container__desc__summary__contract__data",children:[(0,L.jsx)("div",{className:"book__data__container__desc__summary__contract__label typo__color--n700",children:"Contract Address"}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__contract__value typo__color--n500",children:[(ae.book_address||"").slice(0,12),"\u2026",(ae.book_address||"").slice((ae.contract||"").length-10)]})]}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__contract__icon",children:(0,L.jsx)(C.r,{width:24,height:24})})]}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Genres"}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ae.genres).map((e=>(0,L.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Preferred Age Group"}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ae.age_group).map((e=>(0,L.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid typo__color--n700",children:[(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,L.jsx)($.r,{}),(0,L.jsx)("div",{className:"book__data__container__desc__summary__grid__item__data",children:ae.language})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,L.jsx)(S.r,{}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Ze," readers"]})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,L.jsx)(I.r,{}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Pe," people reading"]})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,L.jsx)(F.r,{}),(0,L.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Math.ceil(Ce/60)," minutes"]})]})]})]})}),(0,L.jsxs)("div",{className:"book__data__container__desc__right",children:[(0,L.jsxs)("div",{className:"book__data__container__desc__interacts",children:[(0,L.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,L.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Likes"}),(0,L.jsx)(E.r,{width:24,height:24,className:"book__data__container__desc__interacts__item__icon",stroke:me?"#ff5722":"currentColor",fill:me?"#ff5722":"transparent",onClick:()=>{t.isConnected()?te?(me?(ue((e=>e-1)),(0,f.Z)("event_book_unlike")):(ue((e=>e+1)),(0,f.Z)("event_book_like")),o()({url:`${v._}/api/book/likes`,method:"POST",data:{bookAddress:ae.book_address,ownerAddress:Q,likedState:!me}}).then((e=>{200===e.status?be((e=>!e)):_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>J(!1)))):_((0,x.e1)({show:!0,message:"Only owners can like a book.",type:3})):_((0,x.e1)({show:!0,message:"Please login first.",type:3}))}}),(0,L.jsx)("div",{className:"typo__head--5 typo__color--n600",children:he||"0"})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,L.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Reviews"}),(0,L.jsx)(B.r,{width:24,height:24,stroke:"currentColor"}),(0,L.jsx)("div",{className:"typo__head--5 typo__color--n600",children:we||"0"})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,L.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Pages"}),(0,L.jsx)(T.r,{width:24,height:24,stroke:"currentColor"}),(0,L.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ae.print||"00"})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,L.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Sold"}),(0,L.jsx)(A.r,{width:24,height:24,stroke:"currentColor"}),(0,L.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ae.copies||"00"})]})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__tabs",children:[(0,L.jsx)("div",{ref:Ge,className:"book__data__container__desc__tabs__container",children:(()=>{let e=[];return a.forEach((a=>{e.push((0,L.jsxs)("div",{onClick:()=>ee(a.id),id:"BOOK_PAGE_"+a.id,className:a.id===X?"book__data__container__desc__tabs__container__item book__data__container__desc__tabs__container__item--active":"book__data__container__desc__tabs__container__item utils__cursor--pointer",children:[(0,g.fb)(a.icon)&&a.icon,(0,L.jsx)("h5",{className:"typo__head typo__head--6 typo__transform--capital",children:a.label})]},a.id))})),e})()}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data",children:(()=>{switch(X){case"TAB01":return(0,L.jsx)("p",{className:"typo--break-spaces typo__body typo__color--n600",children:ae.synopsis});case"TAB02":const e=e=>{let a=[];return(0,g.vd)(e)&&e.forEach((e=>a.push((0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item",children:[(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__head typo__head typo__head--6",children:e.title}),(0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header",children:[(0,L.jsx)(h.Z,{rating:e.rating,size:"small"}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__time typo__color--n500",children:r()(e.reviewed_at).format("D MMM, YYYY")})]}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__body typo__body typo__body--2",children:e.body})]})))),a};return(0,L.jsxs)(i.Fragment,{children:[!(0,g.fb)(fe)&&te?(0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,L.jsx)(B.r,{width:32,height:32,stroke:"currentColor"})}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Review"}),(0,L.jsx)(u.Z,{type:"primary",onClick:()=>_(D?(0,j.K4)(j.wW):(0,x.e1)("NOT_LOGGED_IN")),children:"Review"})]}):null,(0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews",children:[e(ge),0===(null===ge||void 0===ge?void 0:ge.length)?(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Reviews"}):""]})]});case"TAB03":const a=e=>{let a=[];return e.forEach(((e,s)=>{a.push((0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes__item",children:[(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__icon",children:(0,L.jsx)(O.r,{width:32,height:32,stroke:"currentColor"})}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__body typo__body",children:e.body}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__time typo__cap typo__cap--2",children:r()(e.created_at).format("D MMM, YYYY")||"-"})]},s))})),a};return(0,L.jsxs)(i.Fragment,{children:[(0,g.fb)(Ee)||!ie&&!te?null:(0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,L.jsx)(P.r,{width:32,height:32,stroke:"currentColor"})}),(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Quote"}),(0,L.jsx)(u.Z,{type:"primary",onClick:()=>_(D?(0,j.K4)(j.D4):(0,x.e1)("NOT_LOGGED_IN")),children:"Quote"})]}),(0,L.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes",children:[a(Te),0===(null===Te||void 0===Te?void 0:Te.length)?(0,L.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Quotes"}):""]})]})}})()})]})]})]})]})]}),(0,L.jsx)(m.Z,{book:ae,userCopy:de,onListHandler:e=>(e=>{(0,f.Z)("event_book_list"),(0,g.fb)(Q)&&(J(!0),p.Z.listBookToMarketplace(ae.book_address,de.token_id,e,K.smartAccount.signer).then((a=>{J(!0);const s=parseInt(a.events.filter((e=>"CoverListed"===e.event))[0].args[0]._hex);o()({url:v._+"/api/book/list",method:"POST",data:{ownerAddress:Q,bookAddress:ae.book_address,bookPrice:e,bookOrderId:s,bookTokenId:de.token_id}}).then((e=>{200===e.status?(re(!0),_((0,j.VG)()),_((0,x.e1)({show:!0,message:"Book listed on marketplace.",type:1})),e.data&&(pe(e.data),_((0,j.K4)(j.Sh)))):_((0,x.e1)("NOT200"))})).catch((e=>{_((0,x.e1)("ERROR"))})).finally((()=>{J(!1)}))})).catch((e=>{(0,g.fb)(e.reason)?e.reason.includes("Can't list the cover at this time")?_((0,x.e1)({show:!0,message:"Please wait for some more time before listing the book.",type:3})):e.reason.includes("Listing for this book is disabled")?_((0,x.e1)({show:!0,message:"Listing this book is not allowed right now. Please try again later.",type:3})):e.reason.includes("Seller should own the NFT to list")&&_((0,x.e1)({show:!0,message:"Book is already listed. Please contact us on support@nalnda.com",type:3})):_((0,x.e1)("ERROR"))})).finally((()=>J(!1))))})(e)}),(0,L.jsx)(k.Z,{ReviewForm:Ne,setReviewForm:Re,reviewHandler:()=>{(0,f.Z)("event_book_review"),(0,g.fb)(Q)?(0,g.UE)(Ne.body)&&(0,g.UE)(Ne.rating)&&(0,g.UE)(Ne.title)?(J(!0),o()({url:`${v._}/api/book/reviews`,method:"POST",data:{review:{...Ne},bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{200===e.status?(_((0,j.VG)()),Me(),ze()):_((0,x.e1)("NOT200"))})).catch((e=>{J(!1),_((0,x.e1)("ERROR"))}))):_((0,x.e1)({show:!0,message:"Please fill the review.",type:3})):_((0,x.e1)({show:!0,message:"Please login first",type:3}))}}),(0,L.jsx)(b.Z,{QuotesForm:Se,setQuotesForm:Be,quoteHandler:()=>{(0,f.Z)("event_book_quote"),(0,g.fb)(Q)?(0,g.UE)(Se.quote)?(J(!0),o()({url:`${v._}/api/book/quotes`,method:"POST",data:{quote:{body:Se.quote},bookAddress:ae.book_address,ownerAddress:Q}}).then((e=>{200===e.status?(_((0,j.VG)()),qe(),Le()):_((0,x.e1)("NOT200"))})).catch((e=>{J(!1),_((0,x.e1)("ERROR"))}))):_((0,x.e1)({show:!0,message:"Please enter the quote.",type:3})):_((0,x.e1)({show:!0,message:"Please login first",type:3}))}}),(0,L.jsx)(y.Z,{bookID:le})]}):null]})]})}}}]);
//# sourceMappingURL=539.8e4eeb17.chunk.js.map