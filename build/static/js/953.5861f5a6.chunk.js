"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[953],{55953:(e,a,s)=>{s.r(a),s.d(a,{default:()=>H});var t=s(74569),_=s.n(t),o=s(72426),r=s.n(o),d=s(16030),c=s(16871),i=s(72791),n=s(54270),l=s(17303),h=s(6222),m=s(88062),u=s(83374),b=s(88952),p=s(43935),k=s(4254),y=s(75454),v=s(90709),f=s(85807),x=s(46472),j=s(89018),w=s(95899),N=s(4127),g=s(87928),R=s(9135),A=s(40867),E=s(29316),O=s(80184);const T=e=>{let{label:a,price:s}=e;return(0,O.jsxs)("div",{className:"tag__price",children:[a,":\xa0",(0,E.fb)(s)?0===s?"FREE":(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:24,height:24,objectFit:"contain"},alt:"USDC"}),parseFloat(s)]}):"loading..."]})},S=e=>{let{onOldBookPurchase:a,onNewBookPurchase:s,data:t}=e;const _=(0,d.I0)(),o=((0,d.v9)((e=>e.UserState)),(0,d.v9)((e=>e.ModalState))),r=(0,d.v9)((e=>e.BWalletState)),[c,n]=(0,i.useState)(!1),[l,m]=(0,i.useState)(!1),[u,b]=(0,i.useState)(null),p=(0,i.useCallback)((async()=>{const e={chainId:A.ChainId.POLYGON_MUMBAI,eoaAddress:r.smartAccount.address,tokenAddresses:["0xdA5289fCAAF71d52a80A254da614a192b693e977"]},a=(await r.smartAccount.getAlltokenBalances(e)).data.filter((e=>"0xda5289fcaaf71d52a80a254da614a192b693e977"===e.contract_address))[0];a.balance=h.formatUnits(null===a||void 0===a?void 0:a.balance,"mwei"),b(a)}),[r.smartAccount]);return(0,i.useEffect)((()=>{window.document.documentElement.style.overflowY=c?"hidden":"auto"}),[c]),(0,i.useEffect)((()=>{_(l?(0,N.yh)():(0,N.v3)())}),[l,_]),(0,i.useEffect)((()=>{!0===o.show&&o.type===g.m0?((0,w.Z)("modal_view_purchase"),n(!0),p()):n(!1)}),[o,r,p]),(0,O.jsx)(j.Z,{show:c,children:(0,O.jsxs)("div",{className:(()=>{let e=["purchase purchase__wrapper"];return c?e.push("purchase__wrapper--open"):e.push("purchase__wrapper--close"),e.join(" ")})(),children:[(0,O.jsxs)("div",{className:"purchase__wrapper__header",children:[(0,O.jsx)("div",{className:"purchase__wrapper__header__title typo__head--6 typo__transform--capital",children:"Checkout"}),(0,O.jsx)("div",{className:"purchase__wrapper__header__close-button",children:(0,O.jsx)("div",{onClick:()=>n(!1),children:(0,O.jsx)(R.r,{width:20,height:20})})})]}),(0,O.jsxs)("div",{className:"purchase__wrapper__content",children:[(0,O.jsxs)("div",{className:"",children:["Title: ",t.title]}),(0,O.jsx)(T,{label:"price",price:t.price}),(0,O.jsx)(T,{label:"your balance",price:null===u||void 0===u?void 0:u.balance}),(0,O.jsx)(T,{label:"balance after purchase",price:parseFloat((null===u||void 0===u?void 0:u.balance)-t.price).toFixed(6)}),(0,O.jsx)("br",{}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>s(),children:"Purchase"})]})]})})};var C=s(77107),Z=s(40696),B=s(65248),P=s(44643),G=s(37793),F=s(25897),$=s(23358),M=s(40116),I=s(88465),q=s(33653),U=s(70476),Y=s(7445),D=s(96744),L=s(1692),z=s(14998),K=s(7215),W=s(88079),Q=s(65748),V=s(298);const H=e=>{const a=[{id:"TAB01",label:"Synopsis",icon:(0,O.jsx)(D.r,{})},{id:"TAB02",label:"reviews",icon:(0,O.jsx)(Y.r,{})},{id:"TAB03",label:"quotes",icon:(0,O.jsx)(z.r,{})}],s=(0,c.UO)(),t=(0,d.I0)(),o=(0,c.s0)(),j=(0,G.Z)(),{address:R,connect:A,provider:T}=(0,V.dD)(),H=(0,d.v9)((e=>e.UserState)),J=(0,d.v9)((e=>e.BWalletState)),[X,ee]=(0,i.useState)(null),[ae,se]=(0,i.useState)(!1),[te,_e]=(0,i.useState)("TAB01"),[oe,re]=(0,i.useState)(null),[de,ce]=(0,i.useState)(null),[ie,ne]=(0,i.useState)(null),[le,he]=(0,i.useState)(null),[me,ue]=(0,i.useState)(null),[be,pe]=(0,i.useState)(null),[ke,ye]=(0,i.useState)(0),[ve,fe]=(0,i.useState)(!1),[xe,je]=(0,i.useState)(0),[we,Ne]=(0,i.useState)(null),[ge,Re]=(0,i.useState)([]),[Ae,Ee]=(0,i.useState)(0),[Oe,Te]=(0,i.useState)({title:"",body:"",rating:0}),[Se,Ce]=(0,i.useState)(null),[Ze,Be]=(0,i.useState)([]),[Pe,Ge]=(0,i.useState)({quote:""}),[Fe,$e]=(0,i.useState)(0),[Me,Ie]=(0,i.useState)(0),[qe,Ue]=(0,i.useState)(0),Ye=(0,i.useRef)();(0,i.useEffect)((()=>{(0,w.Z)("page_view_book")}),[]),(0,i.useEffect)((()=>{"TAB01"===te?(0,w.Z)("tab_view_book_synopsis"):"TAB02"===te?(0,w.Z)("tab_view_book_reviews"):(0,w.Z)("tab_view_book_quotes")}),[te]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&ne(1===oe.listed)}),[oe]);const De=(0,i.useCallback)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/book/reviews`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status?(Re(e.data.reviews),je(e.data.rating),Ee(e.data.total)):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),Le=(0,i.useCallback)((()=>{(0,E.fb)(oe)&&(0,E.fb)(X)&&(se(!0),_()({url:`${B._}/api/book/reviewed`,method:"GET",params:{bookAddress:oe.book_address,ownerAddress:X}}).then((e=>{200===e.status&&(0,E.UE)(e.data)&&Ne(e.data)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,X,t]),ze=(0,i.useCallback)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/book/quotes`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status?Be(e.data):204===e.status||t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),Ke=(0,i.useCallback)((()=>{(0,E.fb)(oe)&&(0,E.fb)(X)&&(se(!0),_()({url:`${B._}/api/book/quoted`,method:"GET",params:{bookAddress:oe.book_address,ownerAddress:X}}).then((e=>{200===e.status&&(0,E.UE)(e.data)&&Ce(e.data)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,X,t]);(0,i.useEffect)((()=>{De()}),[De]),(0,i.useEffect)((()=>{Le()}),[Le]),(0,i.useEffect)((()=>{ze()}),[ze]),(0,i.useEffect)((()=>{Ke()}),[Ke]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/book/likes`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status?ye(e.data.likes):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(0,E.fb)(X)&&(se(!0),_()({url:`${B._}/api/book/liked`,method:"GET",params:{bookAddress:oe.book_address,ownerAddress:X}}).then((e=>{200===e.status&&fe(e.data.liked)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,X,t]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/reader/total-reader-count`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status&&$e(e.data.total_readers)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/reader/count`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status&&Ie(e.data.reader_count)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(se(!0),_()({url:`${B._}/api/reader/total-read-time`,method:"GET",params:{bookAddress:oe.book_address}}).then((e=>{200===e.status&&Ue(e.data.total_read_time)})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))}),[oe,t]),(0,i.useEffect)((()=>{se(!0),(0,E.fb)(J.smartAccount)&&ee(J.smartAccount.address),se(!1)}),[J]),(0,i.useEffect)((()=>{(0,E.fb)(we)&&Te({title:we.title,body:we.body,rating:we.rating})}),[we]),(0,i.useEffect)((()=>{const e=s.bookID;_()({url:`${B._}/api/book`,method:"GET",params:{id:e}}).then((e=>{re(e.data[0])}))}),[s]),(0,i.useEffect)((()=>{if((0,E.fb)(X)&&(0,E.fb)(oe)){se(!0);const e=oe;e.new_owner===X?ce(!0):ce(!1),e.publisher_address===X?ue(!0):ue(!1),_()({url:B._+"/api/book/owner",method:"GET",params:{ownerAddress:X,bookAddress:e.book_address}}).then((e=>{200===e.status&&ce(!0)})).catch((e=>{})).finally((()=>se(!1)))}}),[oe,s,t,X]),(0,i.useEffect)((()=>{(0,E.fb)(oe)&&(0,E.fb)(me)&&(0,E.fb)(de)&&se(!1)}),[oe,me,de]),(0,i.useEffect)((()=>{t(ae?(0,N.yh)():(0,N.v3)())}),[ae,t]),(0,i.useEffect)((()=>{let e=document.getElementById("BOOK_PAGE_"+te);(0,E.fb)(e)&&(0,E.fb)(Ye.current)&&Ye.current.style.setProperty("--marker-x",e.offsetLeft)}),[te]),(0,i.useEffect)((()=>{de&&_()({url:`${B._}/api/user/book`,method:"GET",headers:{"user-id":H.user.uid,address:J.smartAccount.address,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},params:{walletAddress:J.smartAccount.address,bookAddress:oe.book_address}}).then((e=>{200===e.status?(he(e.data),ne(e.data.listed)):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))}))}),[de,H,J,t,oe]);const We=()=>{if((0,E.fb)(J.smartAccount))return ee(J.smartAccount.address),!0;R||(async()=>{A()})(),(0,Z.Z)(T,t)},Qe=async()=>{(0,w.Z)("event_book_read"),se(!0);try{_()({url:`${B._}/api/verify/mobile`,method:"POST",headers:{address:J.smartAccount.address,"user-id":H.user.uid,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},data:{bookAddress:oe.book_address,ownerAddress:J.smartAccount.address}}).then((e=>{200===e.status&&((0,w.Z)("navigate_book_reader"),o("/library/reader",{state:{book:{...oe,url:`${e.data.base}?token=${e.data.token}&cid=${e.data.cid}&fileName=${e.data.fileName}`}}}))}))}catch(e){se(!1)}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.q,{children:(0,O.jsx)("meta",{name:"Book's Page",content:"Buy & Read the book you like"})}),(0,O.jsxs)(b.Z,{children:[(0,O.jsx)("div",{className:"book__bg",children:(0,O.jsx)("img",{src:F.Z,alt:"background",loading:"lazy"})}),(0,E.fb)(oe)?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:"book__data",children:[(0,O.jsx)("div",{className:"book__data__background"}),(0,O.jsxs)("div",{className:"book__data__container",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:"book__data__container__cover",children:(0,O.jsx)("img",{className:"book__data__container__cover__image",src:oe.cover_display_url?oe.cover_display_url:oe.cover_public_url?oe.cover_public_url:oe.cover,alt:oe.name})}),(0,O.jsxs)("div",{className:"book__data__container__meta",children:[(0,O.jsx)("h3",{className:"typo__color--n700 typo__head typo__head--3 typo__transform--capital",children:oe.title}),(0,O.jsx)("h5",{className:"typo__color--n500 typo__head typo__head--6 typo__transform--upper",children:oe.author}),de||me?null:(0,O.jsx)("div",{className:"book__data__container__meta__price typo-head--6 typo__act typo__color--success",children:0===oe.price?"FREE":(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",oe.price]})}),(0,O.jsxs)("div",{className:"book__data__container__meta__rating",children:[(0,O.jsx)("div",{className:"book__data__container__meta__rating__stars",children:(0,O.jsx)(k.Z,{size:"small",rating:xe})}),(0,O.jsxs)("div",{className:"book__data__container__meta__rating__count typo__body",children:[Ae," reviews"]})]}),(0,O.jsx)("div",{className:"book__data__container__meta__cta",children:ie?(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>((0,w.Z)("event_book_unlist"),void((0,E.fb)(X)&&(se(!0),_()({url:B._+"/api/user/book/listed",method:"GET",headers:{"user-id":H.user.uid,authorization:`Bearer ${H.tokens.acsTkn.tkn}`},params:{ownerAddress:X,tokenId:le.token_id,bookAddress:oe.book_address}}).then((e=>{if(200===e.status){se(!0);const a=e.data.order_id;p.Z.unlistBookFromMarketplace(a,J.smartAccount.signer).then((e=>{se(!0),_()({url:B._+"/api/book/unlist",method:"POST",data:{ownerAddress:X,bookAddress:oe.book_address}}).then((e=>{200===e.status?(ne(!1),t((0,g.VG)()),t((0,P.e1)({show:!0,message:"Book unlisted from marketplace.",type:1}))):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>{se(!1)}))})).catch((e=>{se(!1),(0,E.fb)(e.reason)?e.reason.includes("NFT not yet listed / already sold")&&t((0,P.e1)({show:!0,message:"eBook already sold or not listed.",type:3})):t((0,P.e1)("ERROR"))}))}else t((0,P.e1)("NOT200"))})).catch((e=>{se(!1),t((0,P.e1)("ERROR"))}))))),children:"Unlist"}):me?(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>Qe(),children:"Read"})}):de?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>Qe(),children:"Read"}),(0,O.jsx)(y.Z,{onClick:()=>(t((0,g.K4)(g.gG)),void(r()(oe.secondary_sales_from).isSame(r()())||r()(oe.secondary_sales_from).isBefore(r()())?t((0,g.K4)(g.gG)):r()(oe.secondary_sales_from).isAfter(r()())&&t((0,P.e1)({show:!0,message:`Secondary Sales will open only after ${r()(oe.secondary_sales_from).format("D MMM, YYYY")}.`,type:2})))),children:"List"})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(y.Z,{type:"primary",size:"lg",onClick:()=>t(j?(0,g.K4)(g.m0):(0,P.e1)("NOT_LOGGED_IN")),children:"Buy Now"}),(0,O.jsx)(y.Z,{onClick:()=>((0,w.Z)("navigate_book_preview"),void o("/book/preview",{state:{book:oe,preview:!0}})),children:"Preview"})]})})]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc",children:[(0,O.jsx)("div",{className:"book__data__container__desc__left",children:(0,O.jsxs)("div",{className:"book__data__container__desc__summary",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract",onClick:()=>window.open(`https://mumbai.polygonscan.com/address/${oe.book_address}`,"_blank"),children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract__data",children:[(0,O.jsx)("div",{className:"book__data__container__desc__summary__contract__label typo__color--n700",children:"Contract Address"}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__contract__value typo__color--n500",children:[(oe.book_address||"").slice(0,12),"\u2026",(oe.book_address||"").slice((oe.contract||"").length-10)]})]}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__contract__icon",children:(0,O.jsx)(W.r,{width:24,height:24})})]}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Genres"}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(oe.genres).map((e=>(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Prefered Age Group"}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(oe.age_group).map((e=>(0,O.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})))}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid typo__color--n700",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(L.r,{}),(0,O.jsx)("div",{className:"book__data__container__desc__summary__grid__item__data",children:oe.language})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(U.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Fe," readers"]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(K.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Me," people reading"]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,O.jsx)(Q.r,{}),(0,O.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Math.ceil(qe/60)," minutes"]})]})]})]})}),(0,O.jsxs)("div",{className:"book__data__container__desc__right",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__interacts",children:[(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Likes"}),(0,O.jsx)($.r,{width:24,height:24,className:"book__data__container__desc__interacts__item__icon",stroke:ve?"#ff5722":"currentColor",fill:ve?"#ff5722":"transparent",onClick:()=>{We()?de?(ve?(ye((e=>e-1)),(0,w.Z)("event_book_unlike")):(ye((e=>e+1)),(0,w.Z)("event_book_like")),_()({url:`${B._}/api/book/likes`,method:"POST",data:{bookAddress:oe.book_address,ownerAddress:X,likedState:!ve}}).then((e=>{200===e.status?fe((e=>!e)):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1)))):t((0,P.e1)({show:!0,message:"Only owners can like a book.",type:3})):t((0,P.e1)({show:!0,message:"Please login first.",type:3}))}}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ke||"0"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Reviews"}),(0,O.jsx)(Y.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:Ae||"0"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Pages"}),(0,O.jsx)(I.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:oe.print||"00"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,O.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Sold"}),(0,O.jsx)(M.r,{width:24,height:24,stroke:"currentColor"}),(0,O.jsx)("div",{className:"typo__head--5 typo__color--n600",children:oe.copies||"00"})]})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs",children:[(0,O.jsx)("div",{ref:Ye,className:"book__data__container__desc__tabs__container",children:(()=>{let e=[];return a.forEach((a=>{e.push((0,O.jsxs)("div",{onClick:()=>_e(a.id),id:"BOOK_PAGE_"+a.id,className:a.id===te?"book__data__container__desc__tabs__container__item book__data__container__desc__tabs__container__item--active":"book__data__container__desc__tabs__container__item utils__cursor--pointer",children:[(0,E.fb)(a.icon)&&a.icon,(0,O.jsx)("h5",{className:"typo__head typo__head--6 typo__transform--capital",children:a.label})]},a.id))})),e})()}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data",children:(()=>{switch(te){case"TAB01":return(0,O.jsx)("p",{className:"typo--break-spaces typo__body typo__color--n600",children:oe.synopsis});case"TAB02":const e=e=>{let a=[];return(0,E.vd)(e)&&e.forEach((e=>a.push((0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__head typo__head typo__head--6",children:e.title}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header",children:[(0,O.jsx)(k.Z,{rating:e.rating,size:"small"}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__time typo__color--n500",children:r()(e.reviewed_at).format("D MMM, YYYY")})]}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__body typo__body typo__body--2",children:e.body})]})))),a};return(0,O.jsxs)(i.Fragment,{children:[!(0,E.fb)(we)&&de?(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,O.jsx)(Y.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Review"}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>t(j?(0,g.K4)(g.wW):(0,P.e1)("NOT_LOGGED_IN")),children:"Review"})]}):null,(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews",children:[e(ge),0===(null===ge||void 0===ge?void 0:ge.length)?(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Reviews"}):""]})]});case"TAB03":const a=e=>{let a=[];return e.forEach(((e,s)=>{a.push((0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes__item",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__icon",children:(0,O.jsx)(q.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__body typo__body",children:e.body}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__time typo__cap typo__cap--2",children:r()(e.created_at).format("D MMM, YYYY")||"-"})]},s))})),a};return(0,O.jsxs)(i.Fragment,{children:[(0,E.fb)(Se)||!me&&!de?null:(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,O.jsx)(z.r,{width:32,height:32,stroke:"currentColor"})}),(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Quote"}),(0,O.jsx)(y.Z,{type:"primary",onClick:()=>t(j?(0,g.K4)(g.D4):(0,P.e1)("NOT_LOGGED_IN")),children:"Quote"})]}),(0,O.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes",children:[a(Ze),0===(null===Ze||void 0===Ze?void 0:Ze.length)?(0,O.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Quotes"}):""]})]})}})()})]})]})]})]})]}),(0,O.jsx)(S,{data:oe,onNewBookPurchase:()=>((0,w.Z)("event_book_purchase_new"),se(!0),void((0,E.fb)(X)?(async()=>{try{const e=new l.vU(["function approve(address spender, uint256 amount)"]),a=J.smartAccount.address,s={to:"0xdA5289fCAAF71d52a80A254da614a192b693e977",data:e.encodeFunctionData("approve",[oe.book_address,h.parseUnits(oe.price.toString(),6)])},o=new l.vU(["function safeMint(address to)"]).encodeFunctionData("safeMint",[a]),r={to:oe.book_address,data:o};J.smartAccount.on("txMined",(e=>{const s=e.receipt.logs.filter((e=>e.address===oe.book_address&&4===e.topics.length&&(0,E.vd)(e.topics.filter((a=>a===(0,m.keccak256)((0,u.Y0)("Transfer(address,address,uint256)"))&&(0,E.vd)(e.topics[e.topics.length-1]))))));if((0,E.vd)(s)){const e=parseInt(s[0].topics[s[0].topics.length-1]);_()({url:B._+"/api/book/purchase",method:"POST",data:{ownerAddress:a,bookAddress:oe.book_address,tokenId:e,purchasePrice:oe.price}}).then((e=>{200===e.status?(ce(!0),t((0,g.VG)())):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1))),_()({url:B._+"/api/book/copies",method:"POST",data:{bookAddress:oe.book_address,copies:e}}).then((e=>{200!==e.status&&t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))}))}})),J.smartAccount.on("error",(e=>{se(!1),t((0,P.e1)("ERROR")),console.error({error:e})}));const d=[s,r],c=await J.smartAccount.prepareRefundTransactionBatch({transactions:d}),i=await J.smartAccount.createRefundTransactionBatch({transactions:d,feeQuote:c[1]});await J.smartAccount.sendTransaction({tx:i,gasLimit:{hex:"0x4C4B40",type:"hex"}})}catch(e){se(!1),console.error({error:e}),t((0,P.e1)("ERROR"))}})():t((0,P.e1)({show:!0,message:"Please connect your WEB3 wallet.",type:3})))),onOldBookPurchase:e=>(e=>{(0,w.Z)("event_book_purchase_old"),We()&&(se(!0),p.Z.buyListedCover(e.order_id,e.price,J.smartAccount.signer).then((a=>{_()({url:B._+"/api/book/purchase/secondary",method:"POST",data:{newOwnerAddress:X,previousOwnerAddress:e.previous_owner,bookAddress:e.book_address,tokenId:e.token_id,purchasePrice:e.price,orderId:e.order_id,daScore:e.da_score}}).then((e=>{200===e.status?(t((0,g.VG)()),ce(!0)):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>se(!1)))})).catch((e=>{se(!1)})))})(e)}),(0,O.jsx)(v.Z,{book:oe,userCopy:le,onListHandler:e=>(e=>{(0,w.Z)("event_book_list"),(0,E.fb)(X)&&(se(!0),p.Z.listBookToMarketplace(oe.book_address,le.token_id,e,J.smartAccount.signer).then((a=>{se(!0);const s=parseInt(a.events.filter((e=>"CoverListed"===e.event))[0].args[0]._hex);_()({url:B._+"/api/book/list",method:"POST",data:{ownerAddress:X,bookAddress:oe.book_address,bookPrice:e,bookOrderId:s,bookTokenId:le.token_id}}).then((e=>{200===e.status?(ne(!0),t((0,g.VG)()),t((0,P.e1)({show:!0,message:"Book listed on marketplace.",type:1})),e.data&&(pe(e.data),t((0,g.K4)(g.Sh)))):t((0,P.e1)("NOT200"))})).catch((e=>{t((0,P.e1)("ERROR"))})).finally((()=>{se(!1)}))})).catch((e=>{(0,E.fb)(e.reason)?e.reason.includes("Can't list the cover at this time")?t((0,P.e1)({show:!0,message:"Please wait for some more time before listing the book.",type:3})):e.reason.includes("Listing for this book is disabled")?t((0,P.e1)({show:!0,message:"Listing this book is not allowed right now. Please try again later.",type:3})):e.reason.includes("Seller should own the NFT to list")&&t((0,P.e1)({show:!0,message:"Book is already listed. Please contact us on support@nalnda.com",type:3})):t((0,P.e1)("ERROR"))})).finally((()=>se(!1))))})(e)}),(0,O.jsx)(x.Z,{ReviewForm:Oe,setReviewForm:Te,reviewHandler:()=>{(0,w.Z)("event_book_review"),(0,E.fb)(X)?(0,E.UE)(Oe.body)&&(0,E.UE)(Oe.rating)&&(0,E.UE)(Oe.title)?(se(!0),_()({url:`${B._}/api/book/reviews`,method:"POST",data:{review:{...Oe},bookAddress:oe.book_address,ownerAddress:X}}).then((e=>{200===e.status?(t((0,g.VG)()),Le(),De()):t((0,P.e1)("NOT200"))})).catch((e=>{se(!1),t((0,P.e1)("ERROR"))}))):t((0,P.e1)({show:!0,message:"Please fill the review.",type:3})):t((0,P.e1)({show:!0,message:"Please login first",type:3}))}}),(0,O.jsx)(f.Z,{QuotesForm:Pe,setQuotesForm:Ge,quoteHandler:()=>{(0,w.Z)("event_book_quote"),(0,E.fb)(X)?(0,E.UE)(Pe.quote)?(se(!0),_()({url:`${B._}/api/book/quotes`,method:"POST",data:{quote:{body:Pe.quote},bookAddress:oe.book_address,ownerAddress:X}}).then((e=>{200===e.status?(t((0,g.VG)()),Ke(),ze()):t((0,P.e1)("NOT200"))})).catch((e=>{se(!1),t((0,P.e1)("ERROR"))}))):t((0,P.e1)({show:!0,message:"Please enter the quote.",type:3})):t((0,P.e1)({show:!0,message:"Please login first",type:3}))}}),(0,O.jsx)(C.Z,{bookID:be})]}):null]})]})}}}]);
//# sourceMappingURL=953.5861f5a6.chunk.js.map