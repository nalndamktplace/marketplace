"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[953],{55953:function(e,t,a){a.r(t),a.d(t,{default:function(){return ae}});var s=a(1413),o=a(15861),n=a(29439),_=a(64687),r=a.n(_),c=a(74569),i=a.n(c),d=a(72426),l=a.n(d),u=a(16030),h=a(16871),f=a(72791),m=a(54270),b=a(17303),p=a(6222),k=a(88062),v=a(83374),y=a(88952),x=a(43935),j=a(4254),w=a(75454),N=a(90709),g=a(85807),R=a(46472),A=a(89018),E=a(95899),Z=a(4127),O=a(87928),T=a(9135),S=a(40867),C=a(29316),B=a(80184),P=function(e){var t=e.label,a=e.price;return(0,B.jsxs)("div",{className:"tag__price",children:[t,":\xa0",(0,C.fb)(a)?0===a?"FREE":(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:24,height:24,objectFit:"contain"},alt:"USDC"}),parseFloat(a)]}):"loading..."]})},G=function(e){e.onOldBookPurchase;var t=e.onNewBookPurchase,a=e.data,s=(0,u.I0)(),_=((0,u.v9)((function(e){return e.UserState})),(0,u.v9)((function(e){return e.ModalState}))),c=(0,u.v9)((function(e){return e.BWalletState})),i=(0,f.useState)(!1),d=(0,n.Z)(i,2),l=d[0],h=d[1],m=(0,f.useState)(!1),b=(0,n.Z)(m,2),k=b[0],v=(b[1],(0,f.useState)(null)),y=(0,n.Z)(v,2),x=y[0],j=y[1],N=(0,f.useCallback)((0,o.Z)(r().mark((function e(){var t,a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={chainId:S.ChainId.POLYGON_MUMBAI,eoaAddress:c.smartAccount.address,tokenAddresses:["0xdA5289fCAAF71d52a80A254da614a192b693e977"]},e.next=3,c.smartAccount.getAlltokenBalances(t);case 3:a=e.sent,(s=a.data.filter((function(e){return"0xda5289fcaaf71d52a80a254da614a192b693e977"===e.contract_address}))[0]).balance=p.formatUnits(s.balance,"mwei"),j(s);case 7:case"end":return e.stop()}}),e)}))),[c.smartAccount]);return(0,f.useEffect)((function(){window.document.documentElement.style.overflowY=l?"hidden":"auto"}),[l]),(0,f.useEffect)((function(){s(k?(0,Z.yh)():(0,Z.v3)())}),[k,s]),(0,f.useEffect)((function(){!0===_.show&&_.type===O.m0?((0,E.Z)("modal_view_purchase"),h(!0),N()):h(!1)}),[_,c,N]),(0,B.jsx)(A.Z,{show:l,children:(0,B.jsxs)("div",{className:function(){var e=["purchase purchase__wrapper"];return l?e.push("purchase__wrapper--open"):e.push("purchase__wrapper--close"),e.join(" ")}(),children:[(0,B.jsxs)("div",{className:"purchase__wrapper__header",children:[(0,B.jsx)("div",{className:"purchase__wrapper__header__title typo__head--6 typo__transform--capital",children:"Checkout"}),(0,B.jsx)("div",{className:"purchase__wrapper__header__close-button",children:(0,B.jsx)("div",{onClick:function(){return h(!1)},children:(0,B.jsx)(T.r,{width:20,height:20})})})]}),(0,B.jsxs)("div",{className:"purchase__wrapper__content",children:[(0,B.jsxs)("div",{className:"",children:["Title: ",a.title]}),(0,B.jsx)(P,{label:"price",price:a.price}),(0,B.jsx)(P,{label:"your balance",price:null===x||void 0===x?void 0:x.balance}),(0,B.jsx)(P,{label:"balance after purchase",price:parseFloat((null===x||void 0===x?void 0:x.balance)-a.price).toFixed(6)}),(0,B.jsx)("br",{}),(0,B.jsx)(w.Z,{type:"primary",onClick:function(){return t()},children:"Purchase"})]})]})})},F=a(77107),M=a(40696),I=a(65248),q=a(44643),U=a(37793),Y=a(25897),D=a(23358),L=a(40116),z=a(88465),K=a(33653),W=a(70476),Q=a(7445),V=a(96744),H=a(1692),J=a(14998),X=a(7215),$=a(88079),ee=a(65748),te=a(298),ae=function(e){var t=[{id:"TAB01",label:"Synopsis",icon:(0,B.jsx)(V.r,{})},{id:"TAB02",label:"reviews",icon:(0,B.jsx)(Q.r,{})},{id:"TAB03",label:"quotes",icon:(0,B.jsx)(J.r,{})}],a=(0,h.UO)(),_=(0,u.I0)(),c=(0,h.s0)(),d=(0,U.Z)(),A=(0,te.dD)(),T=A.address,S=A.connect,P=A.provider,ae=(0,u.v9)((function(e){return e.UserState})),se=(0,u.v9)((function(e){return e.BWalletState})),oe=(0,f.useState)(null),ne=(0,n.Z)(oe,2),_e=ne[0],re=ne[1],ce=(0,f.useState)(!1),ie=(0,n.Z)(ce,2),de=ie[0],le=ie[1],ue=(0,f.useState)("TAB01"),he=(0,n.Z)(ue,2),fe=he[0],me=he[1],be=(0,f.useState)(null),pe=(0,n.Z)(be,2),ke=pe[0],ve=pe[1],ye=(0,f.useState)(null),xe=(0,n.Z)(ye,2),je=xe[0],we=xe[1],Ne=(0,f.useState)(null),ge=(0,n.Z)(Ne,2),Re=ge[0],Ae=ge[1],Ee=(0,f.useState)(null),Ze=(0,n.Z)(Ee,2),Oe=Ze[0],Te=Ze[1],Se=(0,f.useState)(null),Ce=(0,n.Z)(Se,2),Be=Ce[0],Pe=Ce[1],Ge=(0,f.useState)(null),Fe=(0,n.Z)(Ge,2),Me=Fe[0],Ie=Fe[1],qe=(0,f.useState)(0),Ue=(0,n.Z)(qe,2),Ye=Ue[0],De=Ue[1],Le=(0,f.useState)(!1),ze=(0,n.Z)(Le,2),Ke=ze[0],We=ze[1],Qe=(0,f.useState)(0),Ve=(0,n.Z)(Qe,2),He=Ve[0],Je=Ve[1],Xe=(0,f.useState)(null),$e=(0,n.Z)(Xe,2),et=$e[0],tt=$e[1],at=(0,f.useState)([]),st=(0,n.Z)(at,2),ot=st[0],nt=st[1],_t=(0,f.useState)(0),rt=(0,n.Z)(_t,2),ct=rt[0],it=rt[1],dt=(0,f.useState)({title:"",body:"",rating:0}),lt=(0,n.Z)(dt,2),ut=lt[0],ht=lt[1],ft=(0,f.useState)(null),mt=(0,n.Z)(ft,2),bt=mt[0],pt=mt[1],kt=(0,f.useState)([]),vt=(0,n.Z)(kt,2),yt=vt[0],xt=vt[1],jt=(0,f.useState)({quote:""}),wt=(0,n.Z)(jt,2),Nt=wt[0],gt=wt[1],Rt=(0,f.useState)(0),At=(0,n.Z)(Rt,2),Et=At[0],Zt=At[1],Ot=(0,f.useState)(0),Tt=(0,n.Z)(Ot,2),St=Tt[0],Ct=Tt[1],Bt=(0,f.useState)(0),Pt=(0,n.Z)(Bt,2),Gt=Pt[0],Ft=Pt[1],Mt=(0,f.useRef)();(0,f.useEffect)((function(){(0,E.Z)("page_view_book")}),[]),(0,f.useEffect)((function(){"TAB01"===fe?(0,E.Z)("tab_view_book_synopsis"):"TAB02"===fe?(0,E.Z)("tab_view_book_reviews"):(0,E.Z)("tab_view_book_quotes")}),[fe]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&Ae(1===ke.listed)}),[ke]);var It=(0,f.useCallback)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/book/reviews"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status?(nt(e.data.reviews),Je(e.data.rating),it(e.data.total)):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),qt=(0,f.useCallback)((function(){(0,C.fb)(ke)&&(0,C.fb)(_e)&&(le(!0),i()({url:"".concat(I._,"/api/book/reviewed"),method:"GET",params:{bookAddress:ke.book_address,ownerAddress:_e}}).then((function(e){200===e.status&&(0,C.UE)(e.data)&&tt(e.data)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_e,_]),Ut=(0,f.useCallback)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/book/quotes"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status?xt(e.data):204===e.status||_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),Yt=(0,f.useCallback)((function(){(0,C.fb)(ke)&&(0,C.fb)(_e)&&(le(!0),i()({url:"".concat(I._,"/api/book/quoted"),method:"GET",params:{bookAddress:ke.book_address,ownerAddress:_e}}).then((function(e){200===e.status&&(0,C.UE)(e.data)&&pt(e.data)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_e,_]);(0,f.useEffect)((function(){It()}),[It]),(0,f.useEffect)((function(){qt()}),[qt]),(0,f.useEffect)((function(){Ut()}),[Ut]),(0,f.useEffect)((function(){Yt()}),[Yt]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/book/likes"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status?De(e.data.likes):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(0,C.fb)(_e)&&(le(!0),i()({url:"".concat(I._,"/api/book/liked"),method:"GET",params:{bookAddress:ke.book_address,ownerAddress:_e}}).then((function(e){200===e.status&&We(e.data.liked)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_e,_]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/reader/total-reader-count"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status&&Zt(e.data.total_readers)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/reader/count"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status&&Ct(e.data.reader_count)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(le(!0),i()({url:"".concat(I._,"/api/reader/total-read-time"),method:"GET",params:{bookAddress:ke.book_address}}).then((function(e){200===e.status&&Ft(e.data.total_read_time)})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}),[ke,_]),(0,f.useEffect)((function(){le(!0),(0,C.fb)(se.smartAccount)&&re(se.smartAccount.address),le(!1)}),[se]),(0,f.useEffect)((function(){(0,C.fb)(et)&&ht({title:et.title,body:et.body,rating:et.rating})}),[et]),(0,f.useEffect)((function(){var e=a.bookID;i()({url:"".concat(I._,"/api/book"),method:"GET",params:{id:e}}).then((function(e){ve(e.data[0])}))}),[a]),(0,f.useEffect)((function(){if((0,C.fb)(_e)&&(0,C.fb)(ke)){le(!0);var e=ke;e.new_owner===_e?we(!0):we(!1),e.publisher_address===_e?Pe(!0):Pe(!1),i()({url:I._+"/api/book/owner",method:"GET",params:{ownerAddress:_e,bookAddress:e.book_address}}).then((function(e){200===e.status&&we(!0)})).catch((function(e){})).finally((function(){return le(!1)}))}}),[ke,a,_,_e]),(0,f.useEffect)((function(){(0,C.fb)(ke)&&(0,C.fb)(Be)&&(0,C.fb)(je)&&le(!1)}),[ke,Be,je]),(0,f.useEffect)((function(){_(de?(0,Z.yh)():(0,Z.v3)())}),[de,_]),(0,f.useEffect)((function(){var e=document.getElementById("BOOK_PAGE_"+fe);(0,C.fb)(e)&&(0,C.fb)(Mt.current)&&Mt.current.style.setProperty("--marker-x",e.offsetLeft)}),[fe]),(0,f.useEffect)((function(){je&&i()({url:"".concat(I._,"/api/user/book"),method:"GET",headers:{"user-id":ae.user.uid,address:se.smartAccount.address,authorization:"Bearer ".concat(ae.tokens.acsTkn.tkn)},params:{walletAddress:se.smartAccount.address,bookAddress:ke.book_address}}).then((function(e){200===e.status?(Te(e.data),Ae(e.data.listed)):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))}))}),[je,ae,se,_,ke]);var Dt=function(){var e=(0,o.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){if((0,C.fb)(se.smartAccount))return re(se.smartAccount.address),!0;T||Dt(),(0,M.Z)(P,_)},zt=function(){var e=(0,o.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,E.Z)("event_book_read"),le(!0);try{i()({url:"".concat(I._,"/api/verify/mobile"),method:"POST",headers:{address:se.smartAccount.address,"user-id":ae.user.uid,authorization:"Bearer ".concat(ae.tokens.acsTkn.tkn)},data:{bookAddress:ke.book_address,ownerAddress:se.smartAccount.address}}).then((function(e){200===e.status&&((0,E.Z)("navigate_book_reader"),c("/library/reader",{state:{book:(0,s.Z)((0,s.Z)({},ke),{},{url:"".concat(e.data.base,"?token=").concat(e.data.token,"&cid=").concat(e.data.cid,"&fileName=").concat(e.data.fileName)})}}))}))}catch(t){le(!1)}case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(m.q,{children:(0,B.jsx)("meta",{name:"Book's Page",content:"Buy & Read the book you like"})}),(0,B.jsxs)(y.Z,{children:[(0,B.jsx)("div",{className:"book__bg",children:(0,B.jsx)("img",{src:Y.Z,alt:"background",loading:"lazy"})}),(0,C.fb)(ke)?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("div",{className:"book__data",children:[(0,B.jsx)("div",{className:"book__data__background"}),(0,B.jsxs)("div",{className:"book__data__container",children:[(0,B.jsxs)("div",{children:[(0,B.jsx)("div",{className:"book__data__container__cover",children:(0,B.jsx)("img",{className:"book__data__container__cover__image",src:ke.cover_display_url?ke.cover_display_url:ke.cover_public_url?ke.cover_public_url:ke.cover,alt:ke.name})}),(0,B.jsxs)("div",{className:"book__data__container__meta",children:[(0,B.jsx)("h3",{className:"typo__color--n700 typo__head typo__head--3 typo__transform--capital",children:ke.title}),(0,B.jsx)("h5",{className:"typo__color--n500 typo__head typo__head--6 typo__transform--upper",children:ke.author}),je||Be?null:(0,B.jsx)("div",{className:"book__data__container__meta__price typo-head--6 typo__act typo__color--success",children:0===ke.price?"FREE":(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",ke.price]})}),(0,B.jsxs)("div",{className:"book__data__container__meta__rating",children:[(0,B.jsx)("div",{className:"book__data__container__meta__rating__stars",children:(0,B.jsx)(j.Z,{size:"small",rating:He})}),(0,B.jsxs)("div",{className:"book__data__container__meta__rating__count typo__body",children:[ct," reviews"]})]}),(0,B.jsx)("div",{className:"book__data__container__meta__cta",children:Re?(0,B.jsx)(w.Z,{type:"primary",size:"lg",onClick:function(){return(0,E.Z)("event_book_unlist"),void((0,C.fb)(_e)&&(le(!0),i()({url:I._+"/api/user/book/listed",method:"GET",headers:{"user-id":ae.user.uid,authorization:"Bearer ".concat(ae.tokens.acsTkn.tkn)},params:{ownerAddress:_e,tokenId:Oe.token_id,bookAddress:ke.book_address}}).then((function(e){if(200===e.status){le(!0);var t=e.data.order_id;x.Z.unlistBookFromMarketplace(t,se.smartAccount.signer).then((function(e){le(!0),i()({url:I._+"/api/book/unlist",method:"POST",data:{ownerAddress:_e,bookAddress:ke.book_address}}).then((function(e){200===e.status?(Ae(!1),_((0,O.VG)()),_((0,q.e1)({show:!0,message:"Book unlisted from marketplace.",type:1}))):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){le(!1)}))})).catch((function(e){le(!1),(0,C.fb)(e.reason)?e.reason.includes("NFT not yet listed / already sold")&&_((0,q.e1)({show:!0,message:"eBook already sold or not listed.",type:3})):_((0,q.e1)("ERROR"))}))}else _((0,q.e1)("NOT200"))})).catch((function(e){le(!1),_((0,q.e1)("ERROR"))}))))},children:"Unlist"}):Be?(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(w.Z,{type:"primary",size:"lg",onClick:function(){return zt()},children:"Read"})}):je?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(w.Z,{type:"primary",size:"lg",onClick:function(){return zt()},children:"Read"}),(0,B.jsx)(w.Z,{onClick:function(){return _((0,O.K4)(O.gG)),void(l()(ke.secondary_sales_from).isSame(l()())||l()(ke.secondary_sales_from).isBefore(l()())?_((0,O.K4)(O.gG)):l()(ke.secondary_sales_from).isAfter(l()())&&_((0,q.e1)({show:!0,message:"Secondary Sales will open only after ".concat(l()(ke.secondary_sales_from).format("D MMM, YYYY"),"."),type:2})))},children:"List"})]}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(w.Z,{type:"primary",size:"lg",onClick:function(){return _(d?(0,O.K4)(O.m0):(0,q.e1)("NOT_LOGGED_IN"))},children:"Buy Now"}),(0,B.jsx)(w.Z,{onClick:function(){return(0,E.Z)("navigate_book_preview"),void c("/book/preview",{state:{book:ke,preview:!0}})},children:"Preview"})]})})]})]}),(0,B.jsxs)("div",{className:"book__data__container__desc",children:[(0,B.jsx)("div",{className:"book__data__container__desc__left",children:(0,B.jsxs)("div",{className:"book__data__container__desc__summary",children:[(0,B.jsxs)("div",{className:"book__data__container__desc__summary__contract",onClick:function(){return window.open("https://mumbai.polygonscan.com/address/".concat(ke.book_address),"_blank")},children:[(0,B.jsxs)("div",{className:"book__data__container__desc__summary__contract__data",children:[(0,B.jsx)("div",{className:"book__data__container__desc__summary__contract__label typo__color--n700",children:"Contract Address"}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__contract__value typo__color--n500",children:[(ke.book_address||"").slice(0,12),"\u2026",(ke.book_address||"").slice((ke.contract||"").length-10)]})]}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__contract__icon",children:(0,B.jsx)($.r,{width:24,height:24})})]}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Genres"}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ke.genres).map((function(e){return(0,B.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})}))}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__head typo__color--n700",children:"Prefered Age Group"}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__chips typo__transform--capital",children:JSON.parse(ke.age_group).map((function(e){return(0,B.jsx)("div",{className:"book__data__container__desc__summary__chips__item",children:e})}))}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid typo__color--n700",children:[(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,B.jsx)(H.r,{}),(0,B.jsx)("div",{className:"book__data__container__desc__summary__grid__item__data",children:ke.language})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,B.jsx)(W.r,{}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Et," readers"]})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,B.jsx)(X.r,{}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[St," people reading"]})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item",children:[(0,B.jsx)(ee.r,{}),(0,B.jsxs)("div",{className:"book__data__container__desc__summary__grid__item__data",children:[Math.ceil(Gt/60)," minutes"]})]})]})]})}),(0,B.jsxs)("div",{className:"book__data__container__desc__right",children:[(0,B.jsxs)("div",{className:"book__data__container__desc__interacts",children:[(0,B.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,B.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Likes"}),(0,B.jsx)(D.r,{width:24,height:24,className:"book__data__container__desc__interacts__item__icon",stroke:Ke?"#ff5722":"currentColor",fill:Ke?"#ff5722":"transparent",onClick:function(){Lt()?je?(Ke?(De((function(e){return e-1})),(0,E.Z)("event_book_unlike")):(De((function(e){return e+1})),(0,E.Z)("event_book_like")),i()({url:"".concat(I._,"/api/book/likes"),method:"POST",data:{bookAddress:ke.book_address,ownerAddress:_e,likedState:!Ke}}).then((function(e){200===e.status?We((function(e){return!e})):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)}))):_((0,q.e1)({show:!0,message:"Only owners can like a book.",type:3})):_((0,q.e1)({show:!0,message:"Please login first.",type:3}))}}),(0,B.jsx)("div",{className:"typo__head--5 typo__color--n600",children:Ye||"0"})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,B.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Reviews"}),(0,B.jsx)(Q.r,{width:24,height:24,stroke:"currentColor"}),(0,B.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ct||"0"})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,B.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Pages"}),(0,B.jsx)(z.r,{width:24,height:24,stroke:"currentColor"}),(0,B.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ke.print||"00"})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__interacts__item",children:[(0,B.jsx)("div",{className:"typo__subtitle typo__color--n500",children:"Sold"}),(0,B.jsx)(L.r,{width:24,height:24,stroke:"currentColor"}),(0,B.jsx)("div",{className:"typo__head--5 typo__color--n600",children:ke.copies||"00"})]})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__tabs",children:[(0,B.jsx)("div",{ref:Mt,className:"book__data__container__desc__tabs__container",children:function(){var e=[];return t.forEach((function(t){e.push((0,B.jsxs)("div",{onClick:function(){return me(t.id)},id:"BOOK_PAGE_"+t.id,className:t.id===fe?"book__data__container__desc__tabs__container__item book__data__container__desc__tabs__container__item--active":"book__data__container__desc__tabs__container__item utils__cursor--pointer",children:[(0,C.fb)(t.icon)&&t.icon,(0,B.jsx)("h5",{className:"typo__head typo__head--6 typo__transform--capital",children:t.label})]},t.id))})),e}()}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data",children:function(){switch(fe){case"TAB01":return(0,B.jsx)("p",{className:"typo--break-spaces typo__body typo__color--n600",children:ke.synopsis});case"TAB02":return(0,B.jsxs)(f.Fragment,{children:[!(0,C.fb)(et)&&je?(0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,B.jsx)(Q.r,{width:32,height:32,stroke:"currentColor"})}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Review"}),(0,B.jsx)(w.Z,{type:"primary",onClick:function(){return _(d?(0,O.K4)(O.wW):(0,q.e1)("NOT_LOGGED_IN"))},children:"Review"})]}):null,(0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews",children:[function(e){var t=[];return(0,C.vd)(e)&&e.forEach((function(e){return t.push((0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item",children:[(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__head typo__head typo__head--6",children:e.title}),(0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header",children:[(0,B.jsx)(j.Z,{rating:e.rating,size:"small"}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__header__time typo__color--n500",children:l()(e.reviewed_at).format("D MMM, YYYY")})]}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__reviews__item__body typo__body typo__body--2",children:e.body})]}))})),t}(ot),0===(null===ot||void 0===ot?void 0:ot.length)?(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Reviews"}):""]})]});case"TAB03":return(0,B.jsxs)(f.Fragment,{children:[(0,C.fb)(bt)||!Be&&!je?null:(0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__action",children:[(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__action__icon",children:(0,B.jsx)(J.r,{width:32,height:32,stroke:"currentColor"})}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__action__label typo__head--6",children:"Write a Quote"}),(0,B.jsx)(w.Z,{type:"primary",onClick:function(){return _(d?(0,O.K4)(O.D4):(0,q.e1)("NOT_LOGGED_IN"))},children:"Quote"})]}),(0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes",children:[function(e){var t=[];return e.forEach((function(e,a){t.push((0,B.jsxs)("div",{className:"book__data__container__desc__tabs__data__quotes__item",children:[(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__icon",children:(0,B.jsx)(K.r,{width:32,height:32,stroke:"currentColor"})}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__body typo__body",children:e.body}),(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__quotes__item__time typo__cap typo__cap--2",children:l()(e.created_at).format("D MMM, YYYY")||"-"})]},a))})),t}(yt),0===(null===yt||void 0===yt?void 0:yt.length)?(0,B.jsx)("div",{className:"book__data__container__desc__tabs__data__empty",children:"No Quotes"}):""]})]})}}()})]})]})]})]})]}),(0,B.jsx)(G,{data:ke,onNewBookPurchase:function(){return function(){var e=function(){var e=(0,o.Z)(r().mark((function e(){var t,a,s,o,n,c,d,l,u,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new b.vU(["function approve(address spender, uint256 amount)"]),a=se.smartAccount.address,s=t.encodeFunctionData("approve",[ke.book_address,p.parseUnits(ke.price.toString(),6)]),o={to:"0xdA5289fCAAF71d52a80A254da614a192b693e977",data:s},n=new b.vU(["function safeMint(address to)"]),c=n.encodeFunctionData("safeMint",[a]),d={to:ke.book_address,data:c},se.smartAccount.on("txMined",(function(e){var t=e.receipt.logs.filter((function(e){return e.address===ke.book_address&&4===e.topics.length&&(0,C.vd)(e.topics.filter((function(t){return t===(0,k.keccak256)((0,v.Y0)("Transfer(address,address,uint256)"))&&(0,C.vd)(e.topics[e.topics.length-1])})))}));if((0,C.vd)(t)){var s=parseInt(t[0].topics[t[0].topics.length-1]);i()({url:I._+"/api/book/purchase",method:"POST",data:{ownerAddress:a,bookAddress:ke.book_address,tokenId:s,purchasePrice:ke.price}}).then((function(e){200===e.status?(we(!0),_((0,O.VG)())):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})),i()({url:I._+"/api/book/copies",method:"POST",data:{bookAddress:ke.book_address,copies:s}}).then((function(e){200!==e.status&&_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))}))}})),se.smartAccount.on("error",(function(e){le(!1),_((0,q.e1)("ERROR")),console.error({error:e})})),l=[o,d],e.next=13,se.smartAccount.prepareRefundTransactionBatch({transactions:l});case 13:return u=e.sent,e.next=16,se.smartAccount.createRefundTransactionBatch({transactions:l,feeQuote:u[1]});case 16:return h=e.sent,e.next=19,se.smartAccount.sendTransaction({tx:h,gasLimit:{hex:"0x4C4B40",type:"hex"}});case 19:e.next=26;break;case 21:e.prev=21,e.t0=e.catch(0),le(!1),console.error({error:e.t0}),_((0,q.e1)("ERROR"));case 26:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(){return e.apply(this,arguments)}}();(0,E.Z)("event_book_purchase_new"),le(!0),(0,C.fb)(_e)?e():_((0,q.e1)({show:!0,message:"Please connect your WEB3 wallet.",type:3}))}()},onOldBookPurchase:function(e){return function(e){(0,E.Z)("event_book_purchase_old"),Lt()&&(le(!0),x.Z.buyListedCover(e.order_id,e.price,se.smartAccount.signer).then((function(t){i()({url:I._+"/api/book/purchase/secondary",method:"POST",data:{newOwnerAddress:_e,previousOwnerAddress:e.previous_owner,bookAddress:e.book_address,tokenId:e.token_id,purchasePrice:e.price,orderId:e.order_id,daScore:e.da_score}}).then((function(e){200===e.status?(_((0,O.VG)()),we(!0)):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)}))})).catch((function(e){le(!1)})))}(e)}}),(0,B.jsx)(N.Z,{book:ke,userCopy:Oe,onListHandler:function(e){return function(e){(0,E.Z)("event_book_list"),(0,C.fb)(_e)&&(le(!0),x.Z.listBookToMarketplace(ke.book_address,Oe.token_id,e,se.smartAccount.signer).then((function(t){le(!0);var a=parseInt(t.events.filter((function(e){return"CoverListed"===e.event}))[0].args[0]._hex);i()({url:I._+"/api/book/list",method:"POST",data:{ownerAddress:_e,bookAddress:ke.book_address,bookPrice:e,bookOrderId:a,bookTokenId:Oe.token_id}}).then((function(e){200===e.status?(Ae(!0),_((0,O.VG)()),_((0,q.e1)({show:!0,message:"Book listed on marketplace.",type:1})),e.data&&(Ie(e.data),_((0,O.K4)(O.Sh)))):_((0,q.e1)("NOT200"))})).catch((function(e){_((0,q.e1)("ERROR"))})).finally((function(){le(!1)}))})).catch((function(e){(0,C.fb)(e.reason)?e.reason.includes("Can't list the cover at this time")?_((0,q.e1)({show:!0,message:"Please wait for some more time before listing the book.",type:3})):e.reason.includes("Listing for this book is disabled")?_((0,q.e1)({show:!0,message:"Listing this book is not allowed right now. Please try again later.",type:3})):e.reason.includes("Seller should own the NFT to list")&&_((0,q.e1)({show:!0,message:"Book is already listed. Please contact us on support@nalnda.com",type:3})):_((0,q.e1)("ERROR"))})).finally((function(){return le(!1)})))}(e)}}),(0,B.jsx)(R.Z,{ReviewForm:ut,setReviewForm:ht,reviewHandler:function(){(0,E.Z)("event_book_review"),(0,C.fb)(_e)?(0,C.UE)(ut.body)&&(0,C.UE)(ut.rating)&&(0,C.UE)(ut.title)?(le(!0),i()({url:"".concat(I._,"/api/book/reviews"),method:"POST",data:{review:(0,s.Z)({},ut),bookAddress:ke.book_address,ownerAddress:_e}}).then((function(e){200===e.status?(_((0,O.VG)()),qt(),It()):_((0,q.e1)("NOT200"))})).catch((function(e){le(!1),_((0,q.e1)("ERROR"))}))):_((0,q.e1)({show:!0,message:"Please fill the review.",type:3})):_((0,q.e1)({show:!0,message:"Please login first",type:3}))}}),(0,B.jsx)(g.Z,{QuotesForm:Nt,setQuotesForm:gt,quoteHandler:function(){(0,E.Z)("event_book_quote"),(0,C.fb)(_e)?(0,C.UE)(Nt.quote)?(le(!0),i()({url:"".concat(I._,"/api/book/quotes"),method:"POST",data:{quote:{body:Nt.quote},bookAddress:ke.book_address,ownerAddress:_e}}).then((function(e){200===e.status?(_((0,O.VG)()),Yt(),Ut()):_((0,q.e1)("NOT200"))})).catch((function(e){le(!1),_((0,q.e1)("ERROR"))}))):_((0,q.e1)({show:!0,message:"Please enter the quote.",type:3})):_((0,q.e1)({show:!0,message:"Please login first",type:3}))}}),(0,B.jsx)(F.Z,{bookID:Me})]}):null]})]})}}}]);
//# sourceMappingURL=953.260874f0.chunk.js.map