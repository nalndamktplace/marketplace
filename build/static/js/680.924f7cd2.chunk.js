"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[680],{91680:(e,a,s)=>{s.r(a),s.d(a,{default:()=>S});var t=s(74569),r=s.n(t),l=s(16871),o=s(72791),_=s(16030),c=s(54270),n=s(44643),i=s(29316),d=s(4127),h=s(65248),p=s(50639),u=s(88952),m=s(43935),x=s(75454),f=s(56759),y=s(40354),b=s(87928),v=s(89018),j=s(9135),k=s(15054),g=s(80184);const N=e=>{let{title:a="",open:s=!1,toggleModal:t,children:r,cancellable:l}=e;const c=(0,_.I0)();(0,o.useEffect)((()=>{window.document.documentElement.style.overflowY=s?"hidden":"auto"}),[s]);return(0,g.jsx)(v.Z,{show:s,hideOnClick:!0,children:(0,g.jsxs)("div",{className:(()=>{let e=["modal_search__wrapper"];return s?e.push("modal__wrapper--open"):e.push("modal__wrapper--close"),e.join(" ")})(),children:[(0,g.jsxs)("div",{className:"modal_search__header",children:[(0,g.jsx)("div",{className:"modal__wrapper__header__title typo__head--6",children:a}),(0,g.jsx)("div",{className:"modal__wrapper__header__close-button",children:l?(0,g.jsx)(x.Z,{type:"icon",className:"modal_search__wrapper__close-icon",onClick:()=>c((0,b.VG)()),children:(0,g.jsx)(j.r,{})}):null})]}),(0,g.jsx)("div",{className:"modal_search__content",children:r})]})})},w=()=>{const e=(0,_.I0)(),a=(0,l.s0)(),s=(0,_.v9)((e=>e.ModalState)),[t,c]=(0,o.useState)(!1),[p,u]=(0,o.useState)(!1),[m,x]=(0,o.useState)([]),[f,y]=(0,o.useState)("");(0,o.useEffect)((()=>{f.length>3&&f.length<16&&(c(!0),r()({url:h._+"/api/book/search",method:"GET",params:{query:f}}).then((a=>{200===a.status?x(a.data):e((0,n.e1)("NOT200"))})).catch((a=>{e((0,n.e1)("ERROR"))})).finally((()=>c(!1))))}),[e,f]),(0,o.useEffect)((()=>{!0===s.show&&s.type===b.ni?u(!0):u(!1)}),[s]),(0,o.useEffect)((()=>{e(t?(0,d.yh)():(0,d.v3)())}),[t,e]);return(0,g.jsx)(v.Z,{show:p,children:(0,g.jsxs)(N,{title:"Search",open:p,toggleModal:a=>{!1===a&&e((0,b.VG)())},cancellable:!0,children:[(0,g.jsxs)("div",{className:"modal_search",children:[(0,g.jsx)("input",{value:f,onChange:e=>y(e.target.value),type:"text",placeholder:"Search books and authors",className:"modal_search__input"}),(0,g.jsx)("div",{className:"modal_search__icon",children:(0,g.jsx)(k.r,{width:24,height:24,stroke:"currentColor"})})]}),(0,g.jsx)("div",{className:(()=>{let e=["modal_search__options"];return(0,i.vd)(f)&&f.length>3&&e.push("dropdown__options--open"),e.join(" ")})(),children:(()=>{let e=[];return(0,i.vd)(m)&&m.forEach((s=>{e.push((0,g.jsxs)("div",{onClick:()=>{a("/book",{state:s}),y("")},className:"header__content__search__result",children:[(0,g.jsx)("img",{src:s.cover_public_url?s.cover_public_url:s.cover,alt:s.title+"'s Cover",className:"header__content__search__result__cover",loading:"lazy"}),(0,g.jsxs)("div",{className:"header__content__search__result__info",children:[(0,g.jsx)("div",{className:"header__content__search__result__info__name typo__head typo__subtitle typo__transform--capital",children:s.title}),(0,g.jsx)("div",{className:"header__content__search__result__info__author typo__subtitle typo__subtitle--2 typo__transform--upper",children:s.author}),(0,g.jsx)("div",{className:"index__collection__books__item__data__price typo__act typo__color--success",children:0===s.price?"FREE":(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/59c27d12-e4eb-4f74-7a6e-b33ba6537600/icon48",style:{width:20,height:20,objectFit:"contain"},alt:"USDC"}),"\xa0",s.price]})})]})]},s.id))})),e})()})]})})};var E=s(72808),R=s(95899);const S=()=>{const e=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"}],a=(0,l.s0)(),s=(0,_.I0)(),t=(0,_.v9)((e=>e.BWalletState)),[v,j]=(0,o.useState)([]),[N,S]=(0,o.useState)(null),[O,T]=(0,o.useState)(e),[C,I]=(0,o.useState)(!1),[Z,A]=(0,o.useState)(!1),[F,G]=(0,o.useState)([]),[M,P]=(0,o.useState)(100);(0,o.useEffect)((()=>{(0,R.Z)("page_view_explore")}),[]),(0,o.useEffect)((()=>{s(C?(0,d.yh)():(0,d.v3)())}),[C,s]),(0,o.useEffect)((()=>{I(!0),r()({url:h._+"/api/book",method:"GET"}).then((e=>{200===e.status?G(e.data):s((0,n.e1)("NOT200"))})).catch((e=>{s((0,n.e1)("ERROR"))})).finally((()=>I(!1)))}),[s]),(0,o.useEffect)((()=>{I(!0),(0,i.fb)(t.smartAccount)&&S(t.smartAccount.address),I(!1)}),[t]),(0,o.useEffect)((()=>{let e=F;(0,i.fb)(e)&&(O.forEach((a=>{switch(a.type){case"range":(0,i.fb)(a.value)&&(e=e.filter((e=>e[a.key]<=a.value)));break;case"multiselect":if((0,i.vd)(a.value)){let s=[];a.value.forEach((t=>e.forEach((e=>{e[a.key].indexOf(t)>-1&&s.filter((a=>a.id===e.id)).length<1&&s.push(e)})))),e=s}break;case"select":if("orderby"===a.key)switch(a.value){case"PRICE_L_H":e.sort(((e,a)=>e.price<a.price));break;case"PRICE_H_L":e.sort(((e,a)=>e.price>a.price));break;case"RATING_L_H":e.sort(((e,a)=>e.rating<a.rating));break;case"RATING_H_L":e.sort(((e,a)=>e.rating>a.rating))}}})),j(e))}),[O,F]),(0,o.useEffect)((()=>{if(!(0,i.vd)(F))return;let e=Math.max(...F.map((e=>e.price)));e=10*Math.ceil(e/10),P(e||100)}),[F]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(c.q,{children:(0,g.jsx)("meta",{name:"Explore",content:"Explore exciting books"})}),(0,g.jsxs)(u.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:[(0,g.jsxs)("div",{className:"explore__data",children:[(0,g.jsx)("div",{className:"explore__data__filter-panel-container","data-filter-open":Z,children:(0,g.jsx)(y.Z,{maxPrice:M,setFiltersPanelOpen:A,config:p.j,defaults:e,filters:O,setFilters:T})}),(0,g.jsxs)("div",{className:"explore__data__books","data-filter-open":Z,children:[(0,g.jsxs)("div",{className:"explore__data__books__header",children:[(0,g.jsxs)("div",{className:"explore__data__books__header__filter",children:[(0,g.jsx)(x.Z,{type:"icon",onClick:()=>A((e=>!e)),children:(0,g.jsx)(E.r,{fill:Z?"currentColor":"transparent"})}),(0,g.jsxs)("div",{className:"typo__body typo__color--n500",children:["Found ",(0,g.jsx)("span",{className:"typo__color--n700",style:{fontWeight:"500"},children:v.length})," results"]})]}),window.innerWidth<600?(0,g.jsx)("div",{className:"explore__data__books__header__layout",children:(0,g.jsx)(x.Z,{className:"account__data__books__header__layout__button typo__act",onClick:()=>{s((0,b.K4)(b.ni))},children:(0,g.jsx)(k.r,{})})}):null]}),(0,g.jsx)("div",{className:"explore__data__books__wrapper","data-layout":window.innerWidth<600?"LIST":"GRID",children:(0,i.fb)(v)&&v.length>0?(()=>{let e=[];return v.forEach((l=>{e.push((0,g.jsx)(f.Z,{layout:window.innerWidth<600?"LIST":"GRID",book:l,onBuy:()=>(e=>{(0,R.Z)("event_explore_purchase_new"),I(!0),m.Z.purchaseNft(N,e.book_address,e.price.toString(),t.smartAccount.signer).then((a=>{s((0,n.e1)({show:!0,message:"Book purchased.",type:1}));const t=Number(a.events.filter((e=>"Transfer(address,address,uint256)"===e.eventSignature))[0].args[2]._hex);r()({url:h._+"/api/book/purchase",method:"POST",data:{ownerAddress:N,bookAddress:e.book_address,tokenId:t}}).then((e=>{200!==e.status&&s((0,n.e1)("NOT200"))})).catch((e=>{s((0,n.e1)("ERROR"))})).finally((()=>I(!1))),r()({url:h._+"/api/book/copies",method:"POST",data:{bookAddress:e.book_address,copies:t}}).then((e=>{200!==e.status&&s((0,n.e1)("NOT200"))})).catch((e=>{s((0,n.e1)("ERROR"))}))})).catch((e=>{I(!1),4001===e.code?s((0,n.e1)({show:!0,message:"Transaction denied by user.",type:3})):s((0,n.e1)("ERROR"))}))})(l),onOpen:()=>(e=>{(0,R.Z)("navigate_explore_book"),a(`/book/${e.id}`)})(l)},l.id))})),e})():(0,g.jsxs)("div",{className:"explore__data__books__wrapper__empty",children:[(0,g.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"explore__data__books__wrapper__image",loading:"lazy"}),(0,g.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]}),(0,g.jsx)(w,{})]})]})}}}]);
//# sourceMappingURL=680.924f7cd2.chunk.js.map