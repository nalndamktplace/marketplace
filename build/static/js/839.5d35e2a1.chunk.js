"use strict";(self.webpackChunkmarketplace=self.webpackChunkmarketplace||[]).push([[839],{9839:function(e,t,a){a.r(t);var n=a(1413),r=a(5861),s=a(2982),c=a(885),o=a(7757),i=a.n(o),u=a(4569),l=a.n(u),_=a(6030),d=a(6871),f=a(2791),h=a(2043),p=a(6026),b=a(4643),k=a(9316),v=a(4127),y=a(8979),m=a(5454),g=a(354),w=a(5248),x=a(639),Z=a(6759),j=a(3930),N=a(5602),E=a(906),R=a(5899),S=a(184);t.default=function(e){var t=[{key:"price",value:null,type:"range"},{key:"genres",value:[],type:"multiselect"},{key:"age_group",value:[],type:"multiselect"},{key:"orderby",value:null,type:"select"},{key:"decayscore",value:null,type:"range"}],a=(0,d.TH)(),o=(0,d.s0)(),u=(0,_.I0)(),T=(0,_.v9)((function(e){return e.UserState})),C=(0,_.v9)((function(e){return e.WalletState})),O=(0,f.useState)([]),I=(0,c.Z)(O,2),L=I[0],A=I[1],G=(0,f.useState)([]),P=(0,c.Z)(G,2),H=P[0],D=P[1],M=(0,f.useState)(t),W=(0,c.Z)(M,2),z=W[0],B=W[1],F=(0,f.useState)(!1),U=(0,c.Z)(F,2),q=U[0],J=U[1],K=(0,f.useState)(0),V=(0,c.Z)(K,2),Y=V[0],Q=V[1],X=(0,f.useState)(null),$=(0,c.Z)(X,2),ee=$[0],te=$[1],ae=(0,f.useState)(!1),ne=(0,c.Z)(ae,2),re=ne[0],se=ne[1],ce=(0,f.useState)(window.innerWidth<600?"LIST":"GRID"),oe=(0,c.Z)(ce,2),ie=oe[0],ue=oe[1],le=(0,f.useState)(100),_e=(0,c.Z)(le,2),de=_e[0],fe=_e[1];(0,f.useEffect)((function(){(0,R.Z)("page_view_account")}),[]),(0,f.useEffect)((function(){0===Y?(0,R.Z)("tab_view_account_owned"):(0,R.Z)("tab_view_account_published")}),[Y]);var he=(0,f.useCallback)((function(){h.Z.connectWallet().then((function(e){u((0,p.kH)({wallet:e.wallet,provider:e.provider,signer:e.signer,address:e.address}))})).catch((function(e){u((0,b.e1)({show:!0,message:"Error while connecting to wallet",type:4}))})).finally((function(){return J(!1)}))}),[u]);(0,f.useEffect)((function(){(0,R.Z)("event_library_filter");var e=H;(0,k.fb)(e)&&(z.forEach((function(t){switch(t.type){case"range":(0,k.fb)(t.value)&&(e=e.filter((function(e){return e[t.key]<=t.value})));break;case"multiselect":if((0,k.vd)(t.value)){var a=[];t.value.forEach((function(n){return e.forEach((function(e){e[t.key].indexOf(n)>-1&&a.filter((function(t){return t.id===e.id})).length<1&&a.push(e)}))})),e=a}break;case"select":if("orderby"===t.key)switch(t.value){case"PRICE_L_H":e.sort((function(e,t){return e.price<t.price}));break;case"PRICE_H_L":e.sort((function(e,t){return e.price>t.price}));break;case"RATING_L_H":e.sort((function(e,t){return e.rating<t.rating}));break;case"RATING_H_L":e.sort((function(e,t){return e.rating>t.rating}))}}})),A(e))}),[z,H]),(0,f.useEffect)((function(){if((0,k.fb)(a.state)){var e=a.state.tab;Q("published"===e?1:0)}}),[a]),(0,f.useEffect)((function(){J(!0),(0,k.fb)(C.wallet.provider)?te(C.wallet.address):he(),J(!1)}),[C,he]),(0,f.useEffect)((function(){u(q?(0,v.yh)():(0,v.v3)())}),[q,u]),(0,f.useEffect)((function(){(0,k.Pc)(T)&&(J(!0),0===Y?l()({url:w._+"/api/user/books/owned",method:"GET",headers:{"user-id":T.user.uid,authorization:"Bearer ".concat(T.tokens.acsTkn.tkn)},params:{userAddress:ee}}).then((function(e){200===e.status?D(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return J(!1)})):1===Y&&l()({url:w._+"/api/user/books/published",method:"GET",headers:{"user-id":T.user.uid,authorization:"Bearer ".concat(T.tokens.acsTkn.tkn)},params:{userAddress:ee}}).then((function(e){200===e.status?D(e.data):u((0,b.e1)("NOT200"))})).catch((function(e){u((0,b.e1)("ERROR"))})).finally((function(){return J(!1)})))}),[Y,ee,u,T]),(0,f.useEffect)((function(){if((0,k.vd)(H)){var e=Math.max.apply(Math,(0,s.Z)(H.map((function(e){return e.price}))));e=10*Math.ceil(e/10),fe(e||100)}}),[H]);var pe=function(){var e=(0,r.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:J(!0);try{l()({url:"".concat(w._,"/api/verify"),method:"GET",params:{bookAddress:t.book_address,ownerAddress:ee}}).then((function(e){if(200===e.status){var a=e.data;h.Z.signMessage(C.wallet.signer,JSON.stringify(a)).then((function(e){!0===e.isValid?l()({url:w._+"/api/verify",method:"POST",data:{accountAddress:ee,bookAddress:t.book_address,signedData:e.signedData,cid:t.book.slice(t.book.lastIndexOf("/")+1)}}).then((function(e){200===e.status?((0,R.Z)("navigate_book_reader"),o("/library/reader",{state:{book:(0,n.Z)((0,n.Z)({},t),{},{submarineURL:e.data.url}),preview:!1}})):u((0,b.e1)({show:!0,message:"Error",type:4}))})).catch((function(e){})).finally((function(){return J(!1)})):u((0,b.e1)({show:!0,message:"Could not verify the authenticity of the signature.",type:3}))}))}else u((0,b.e1)("NOT200"))}))}catch(a){J(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,S.jsx)(y.Z,{noFooter:!0,showRibbion:!1,noPadding:!0,fluid:!0,containerClass:"explore",children:(0,S.jsxs)("div",{className:"account__data",children:[(0,S.jsx)("div",{className:"account__data__filter-panel-container","data-filter-open":re,children:(0,S.jsx)(g.Z,{maxPrice:de,setFiltersPanelOpen:se,config:x.K,defaults:t,filters:z,setFilters:B})}),(0,S.jsxs)("div",{className:"account__data__books","data-filter-open":re,children:[(0,S.jsxs)("div",{className:"account__data__books__header",children:[(0,S.jsxs)("div",{className:"account__data__books__header__filter",children:[(0,S.jsx)(m.Z,{type:"icon",onClick:function(){return se((function(e){return!e}))},children:(0,S.jsx)(j.r,{fill:re?"currentColor":"transparent"})}),(0,S.jsxs)("div",{className:"account__data__books__header__filter__tabs",children:[(0,S.jsx)("div",{onClick:function(){return Q(0)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":0===Y,children:"Library"}),(0,S.jsx)("div",{onClick:function(){return Q(1)},className:"account__data__books__header__filter__tabs__item typo__head--6","data-state":1===Y,children:"Published"})]})]}),(0,S.jsxs)("div",{className:"account__data__books__header__layout",children:[(0,S.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return ue("LIST")},children:[(0,S.jsx)(E.r,{}),(0,S.jsx)("span",{children:"List"})]}),(0,S.jsxs)(m.Z,{className:"account__data__books__header__layout__button",onClick:function(){return ue("GRID")},children:[(0,S.jsx)(N.r,{}),(0,S.jsx)("span",{children:"GRID"})]})]})]}),(0,S.jsx)("div",{className:"account__data__books__wrapper","data-layout":ie,children:(0,k.fb)(L)&&L.length>0?function(){var e=[];return L.forEach((function(t){e.push((0,S.jsx)(Z.Z,{state:t.publisher_address===ee?"publisher":"owned",layout:ie,book:t,onRead:function(){return pe(t)},onOpen:function(){return function(e){(0,R.Z)("navigate_account_book"),o("/book",{state:e})}(t)}},t.id))})),e}():(0,S.jsxs)("div",{className:"account__data__books__wrapper__empty",children:[(0,S.jsx)("img",{src:"https://imagedelivery.net/yOWneHxM1h9mu46Te3Yjwg/fb06196e-29ca-4c59-9460-6fdbd43fa700/square240",alt:"books shelf",className:"account__data__books__wrapper__image",loading:"lazy"}),(0,S.jsx)("h4",{className:"typo__head typo__head--4",children:"No eBooks yet"})]})})]})]})})}}}]);
//# sourceMappingURL=839.5d35e2a1.chunk.js.map